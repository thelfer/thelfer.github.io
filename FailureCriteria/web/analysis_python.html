<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-EN" xml:lang="en-EN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Analysis of simulation’s results exported in VTK with python and MGIS</title>
        <meta name="author" content="Jérémy Hure, Thomas Helfer" />
            <meta name="date" content="2026-03-11" />
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <style type="text/css">code{white-space: pre;}</style>
            <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {  background-color: #f8f8f8; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ef2929; } /* Alert */
      code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #204a87; } /* Attribute */
      code span.bn { color: #0000cf; } /* BaseN */
      code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4e9a06; } /* Char */
      code span.cn { color: #8f5902; } /* Constant */
      code span.co { color: #8f5902; font-style: italic; } /* Comment */
      code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
      code span.dt { color: #204a87; } /* DataType */
      code span.dv { color: #0000cf; } /* DecVal */
      code span.er { color: #a40000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #0000cf; } /* Float */
      code span.fu { color: #204a87; font-weight: bold; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
      code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
      code span.ot { color: #8f5902; } /* Other */
      code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
      code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
      code span.ss { color: #4e9a06; } /* SpecialString */
      code span.st { color: #4e9a06; } /* String */
      code span.va { color: #000000; } /* Variable */
      code span.vs { color: #4e9a06; } /* VerbatimString */
      code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
            <link rel="stylesheet" href="css/normalize.css"/>
    <link rel="stylesheet" href="css/main.css"/>
        <script
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
        type="text/javascript"></script>
          </head>
  <body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
        <header>
      <ul id="nav">
	    <li><a href="index.html">Overview</a></li>
        <li><a>Documentation</a>
      	  <ul>
           <li><a href="install.html">Installation guide</a></li>
            <li><a>Tutorials</a>
                <ul>
                <li><a href="analysis_python.html">Analysis of simulation's results exported in VTK with python and MGIS</a></li>
                </ul>
            </li>
           <li><a href="contributing.html">Contributing</a></li>
           </ul>
        </li>
        <li><a>Getting Help</a>
      	  <ul>
	        <li><a href="https://github.com/thelfer/FailureCriteria/discussions">Forum</a></li>
	        <li><a href="mailto:tfel-contact@cea.fr">Contact</a></li>
	      </ul>
       </li>
        <li><a>About</a>
      	  <ul>
	        <li><a href="contributors.html">Contributors</a></li>
	      </ul>
       </li>
      </ul><br>
    </header>

<div id="header">
<h1 class="title">Analysis of simulation’s results exported in VTK with
python and MGIS</h1>
<h2 class="author">Jérémy Hure, Thomas Helfer</h2>
<h3 class="date">03/11/2026</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#description-of-the-test-case"
id="toc-description-of-the-test-case">Description of the test case</a>
<ul>
<li><a href="#description-of-the-rice-tracey-failure-criterion"
id="toc-description-of-the-rice-tracey-failure-criterion">Description of
the Rice-Tracey failure criterion</a>
<ul>
<li><a href="#description-of-the-mfront-implementation"
id="toc-description-of-the-mfront-implementation">Description of the
<code>MFront</code> implementation</a></li>
<li><a href="#material-properties" id="toc-material-properties">Material
properties</a></li>
<li><a href="#external-state-variables"
id="toc-external-state-variables">External state variables</a></li>
<li><a href="#internal-state-variables"
id="toc-internal-state-variables">Internal state variables</a></li>
</ul></li>
<li><a href="#description-of-the-results-to-be-analysed"
id="toc-description-of-the-results-to-be-analysed">Description of the
results to be analysed</a></li>
</ul></li>
<li><a href="#implementation-in-python"
id="toc-implementation-in-python">Implementation in
<code>python</code></a>
<ul>
<li><a href="#importing-python-modules"
id="toc-importing-python-modules">Importing <code>python</code>
modules</a></li>
<li><a href="#main-parameters-defining-the-post-processing"
id="toc-main-parameters-defining-the-post-processing">Main parameters
defining the post-processing</a></li>
<li><a href="#creation-of-the-vtk-reader-and-listing-results-files"
id="toc-creation-of-the-vtk-reader-and-listing-results-files">Creation
of the VTK reader and listing results files</a></li>
<li><a href="#creation-of-res-array"
id="toc-creation-of-res-array">Creation of <code>res</code>
array</a></li>
<li><a href="#loading-the-post-processing"
id="toc-loading-the-post-processing">Loading the
post-processing</a></li>
<li><a href="#creation-of-the-material-data-manager"
id="toc-creation-of-the-material-data-manager">Creation of the material
data manager</a></li>
<li><a href="#initialization-of-the-material-properties"
id="toc-initialization-of-the-material-properties">Initialization of the
material properties</a></li>
<li><a href="#integration-of-the-post-processing-over-all-time-steps"
id="toc-integration-of-the-post-processing-over-all-time-steps">Integration
of the post-processing over all time steps</a></li>
<li><a href="#saving-the-results" id="toc-saving-the-results">Saving the
results</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>
<p>This tutorial shows how to use the failure criteria provided by the
<code>FailureCriteria</code> project to analyse the results of a
simulation exported in <code>VTK</code> with the failure criterion
proposed by Rice and Tracey <span class="citation"
data-cites="rice_ductile_1969">[<a href="#ref-rice_ductile_1969"
role="doc-biblioref">1</a>]</span> using <code>python</code> and
<code>MGIS</code>.</p>
<blockquote>
<p><strong>Generation of the VTK file</strong></p>
<p>The <code>VTK</code> files analysed in this tutorial have been
generated from the following <a
href="https://www-cast3m.cea.fr"><code>Cast3M</code> simulation</a>:</p>
<ul>
<li><a href="castem/test1.dgibi"><code>test1.dgibi</code></a></li>
<li><a href="mfront/test1.mfront"><code>test1.mfront</code></a></li>
</ul>
<p>The <code>MFront</code> file can be compiled as follows:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mfront</span> <span class="at">--obuild</span> <span class="at">--interface</span><span class="op">=</span>castem21 test1.mfront</span></code></pre></div>
<p>The <code>Cast3M</code> script can be run as follows:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">castem24</span> test1.dgibi</span></code></pre></div>
</blockquote>
<p>The tutorial requires the following files to be run:</p>
<ul>
<li><a href="python/test1.py"><code>test1.py</code></a></li>
<li><a
href="https://raw.githubusercontent.com/thelfer/FailureCriteria/refs/heads/master/src/DuctileDamageIndicator_RiceTracey1969.mfront"><code>DuctileDamageIndicator_RiceTracey1969.mfront</code></a>.
This file is automatically compiled by the <code>FailureCriteria</code>
project.</li>
</ul>
<p>This tutorial can be easily adapted to many situations, the key being
the fact that <code>VTK</code> data can be exposed as
<code>NumPy</code>’s arrays and that <code>NumPy</code>’s arrays are
directly usable with <code>MGIS</code></p>
<h1 id="description-of-the-test-case">Description of the test case</h1>
<h2 id="description-of-the-rice-tracey-failure-criterion">Description of
the Rice-Tracey failure criterion</h2>
<p>The Rice-Tracey failure criterion computes a damage indicator <span
class="math inline">\(d\)</span> as follows: <span
class="math display">\[
d_{i} = \int_{0}^{t}\frac{\dot{p}\,\mathrm{d}t}{D_{1} \, \exp\left(D_{2}
\, T_{\sigma}\right)}
\]</span> where:</p>
<ul>
<li><span class="math inline">\(\dot{p}\)</span> is the equivalent
strain rate,</li>
<li><span class="math inline">\(T_{\sigma}\)</span> is the stress
triaxiality, ratio of the hydrostatic pressure and von Mises
stress,</li>
<li><span class="math inline">\(D_{1}\)</span> and <span
class="math inline">\(D_{2}\)</span> are material properties.</li>
</ul>
<h3 id="description-of-the-mfront-implementation">Description of the
<code>MFront</code> implementation</h3>
<p>The Rice-Tracey failure criterion is implemented in the file <a
href="https://raw.githubusercontent.com/thelfer/FailureCriteria/refs/heads/master/src/DuctileDamageIndicator_RiceTracey1969.mfront"><code>DuctileDamageIndicator_RiceTracey1969.mfront</code></a>.</p>
<h3 id="material-properties">Material properties</h3>
<p>The implementation declares two material properties that will have to
be defined in the post-processing script:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront-query <span class="at">--material-properties</span> src/DuctileDamageIndicator_RiceTracey1969.mfront </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> D1</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> D2</span></code></pre></div>
<h3 id="external-state-variables">External state variables</h3>
<p>The implementation declares two external state variables that will
have to be extracted from the results of the simulation in the
post-processing script:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront-query <span class="at">--external-state-variables</span> src/DuctileDamageIndicator_RiceTracey1969.mfront </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> EquivalentPlasticStrain <span class="er">(</span><span class="ex">p</span><span class="kw">)</span><span class="bu">:</span> the equivalent plastic strain</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Stress <span class="er">(</span><span class="ex">sig</span><span class="kw">)</span><span class="bu">:</span> the stress tensor</span></code></pre></div>
<h3 id="internal-state-variables">Internal state variables</h3>
<p>The implementation compute an unique state result, named
<code>DamageIndicator</code>:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront-query <span class="at">--persistent-variables</span> src/DuctileDamageIndicator_RiceTracey1969.mfront </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> DamageIndicator <span class="er">(</span><span class="ex">di</span><span class="kw">)</span></span></code></pre></div>
<h2 id="description-of-the-results-to-be-analysed">Description of the
results to be analysed</h2>
<p>For each time step, a <code>vtu</code> file has been generated. In
our example, the names of those files matches the pattern
<code>test1.XXXX.vtu</code> where <code>XXXX</code> denotes the time
step number. Those <code>vtu</code> files contains a certain number of
data that will be used for the post-processing.</p>
<p>The <code>VTK</code> files contains two fields, stored in two point
data: the Cauchy stress field, named <code>SIG</code> and the equivalent
plastic strain field named <code>P</code>. Two remarks can be made:</p>
<ul>
<li>Those names differ from names of the external state variables
expected by the <code>MFront</code> implementation of the failure
criterion.</li>
<li>The Cauchy stress field exported by <code>Cast3M</code> is stored in
a 6 components, but the conventions used by <code>Cast3M</code> differ
from the one used by <code>MFront</code> (see <a
href="https://thelfer.github.io/tfel/web/tensors.html">this page</a> for
details). Extra diagonal components must be multiplied by a factor <span
class="math inline">\(\sqrt(2\)</span> before passing the values to
<code>MGIS</code>.</li>
</ul>
<h1 id="implementation-in-python">Implementation in
<code>python</code></h1>
<p>The main implementation follows the following main steps:</p>
<ol type="1">
<li>Create a <code>VTK</code> reader and list all the <code>vtu</code>
files,</li>
<li>Load the post-processing as an <code>MGIS</code>’s model,</li>
<li>Create a <code>MaterialDataManager</code> to store the internal
state variables of the post-processing and integrating the
post-processing over each time steps,</li>
<li>Initialize the material properties used by the post-processing</li>
<li>Create a <code>NumPy</code> array named <code>res</code> to store
the maximum value of the damage indicator over all integration points
for all time steps.</li>
<li>Iterate over all the results files, extract the external state
variables used by the post-processing, convert the stress field to match
<code>MFront</code>’s conventions, and integrate the post-processing to
compute the damage indicator. The <code>res</code> array is then
updated. On demand, the damage indicator is saved in a dedicated
<code>vtu</code> file.</li>
<li>The <code>res</code> array is saved in a <code>txt</code> file.</li>
</ol>
<h2 id="importing-python-modules">Importing <code>python</code>
modules</h2>
<p>The following <code>python</code> modules will be useful:</p>
<ul>
<li>the standard <code>os</code> and <code>glob</code> modules. The
first is used to see if a file exists while the second allows to list
all the <code>vtu</code> files in the current directory.</li>
<li>The <code>numpy</code> module is used for array manipulation and
data transfer from <code>vtk</code> to <code>MGIS</code>.</li>
<li>The <code>vtk</code> module is used to read the <code>vtu</code>
files and optionally write the damage indicator on output. The
<code>vtk_to_numpy</code> function is imported from the
<code>vtk.util.numpy_support</code> modules as well as the
<code>dataset_adapter</code> class from
<code>vtk.numpy_interface</code></li>
<li>Finally the <code>mgis.behaviour</code> and <code>mgis.model</code>
are imported.</li>
</ul>
<p>All those modules are imported as follows:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> vtk</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> vtk.util.numpy_support <span class="im">import</span> vtk_to_numpy</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> vtk.numpy_interface <span class="im">import</span> dataset_adapter <span class="im">as</span> dsa</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mgis.behaviour <span class="im">as</span> mgis_bv</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mgis.model</span></code></pre></div>
<h2 id="main-parameters-defining-the-post-processing">Main parameters
defining the post-processing</h2>
<p>In order to highlight the main end-user parameters of the
post-processing script, four dictionaries are defined.</p>
<p>The <code>model</code> dictionary describes the failure criterion to
be used:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;LibraryPath&quot;</span>: <span class="st">&quot;libFailureCriteriaModels-generic.so&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Law&quot;</span>: <span class="st">&quot;DuctileDamageIndicator_RiceTracey1969&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Hypothesis&quot;</span>: <span class="st">&quot;Tridimensional&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>The values indicated in the <code>model</code> dictionary are
consistent with an installation using the <code>FailureCriteria</code>
project. This means that
<code>libFailureCriteriaModels-generic.so</code> shall be installed in a
repository listed by the <code>LD_LIBRARY_PATH</code> variable (or in a
system-wide directory, which is not recommended).</p>
</blockquote>
<p>The values of the material properties <code>D1</code> and
<code>D2</code> are stored in the <code>material_properties</code>
dictorionary.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>material_properties <span class="op">=</span> {<span class="st">&quot;D1&quot;</span>: <span class="dv">1</span>, <span class="st">&quot;D2&quot;</span>: <span class="fl">1.5</span>}</span></code></pre></div>
<p>The <code>output</code> dictionary indicates the name of the state
variable to be post-processed, and some parameters related to
<code>VTK</code> output.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> {<span class="st">&quot;OutputData&quot;</span>: <span class="st">&quot;DamageIndicator&quot;</span>, <span class="st">&quot;VtkOutput&quot;</span>: <span class="st">&quot;true&quot;</span>, <span class="st">&quot;VtkFormat&quot;</span>: <span class="st">&quot;ascii&quot;</span>}</span></code></pre></div>
<p>Finally, the <code>data</code> dictionary contains information about
the <code>VTK</code> files to be post-processed:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;PrefixFiles&quot;</span>: <span class="st">&quot;Results&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Components&quot;</span>: {<span class="st">&quot;Stress&quot;</span>: <span class="st">&quot;SIG&quot;</span>, <span class="st">&quot;EquivalentPlasticStrain&quot;</span>: <span class="st">&quot;P&quot;</span>},</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;StressNotation&quot;</span>: <span class="st">&quot;Mandel&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Timestep&quot;</span>: <span class="dv">1</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>Components</code> entry maps the name of the
<code>VTK</code> data set to the name of the external state variable
expected by the model.</p>
<p>The <code>StressNotation</code> entry indicates the king of the
transformation to be applied to the stress field to match
<code>MFront</code>’s conventions.</p>
<p>The <code>Timestep</code> entry provides the value of the time step.
This value is required but has no impact of the results of the
post-processing.</p>
<h2 id="creation-of-the-vtk-reader-and-listing-results-files">Creation
of the VTK reader and listing results files</h2>
<p>The following line constructs the reader used to parse the
<code>vtu</code> files</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> vtk.vtkXMLUnstructuredGridReader()</span></code></pre></div>
<p>The following lines gather the names of all the <code>vtu</code>
files:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">sorted</span>(glob.glob(data[<span class="st">&quot;PrefixFiles&quot;</span>] <span class="op">+</span> <span class="st">&quot;*vtu&quot;</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> f:</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="st">&quot;vtu files not found&quot;</span>)</span></code></pre></div>
<h2 id="creation-of-res-array">Creation of <code>res</code> array</h2>
<p>The following line create an array that will contains the maximum of
the damage indicator for each time step:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> np.zeros([<span class="bu">len</span>(f), <span class="dv">1</span>])</span></code></pre></div>
<h2 id="loading-the-post-processing">Loading the post-processing</h2>
<p>The following line create a suitable hypothesis variable:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">match</span> model[<span class="st">&quot;Hypothesis&quot;</span>]:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&quot;Tridimensional&quot;</span>:</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> mgis_bv.Hypothesis.Tridimensional</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&quot;GeneralisedPlaneStrain&quot;</span>:</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> mgis_bv.Hypothesis.GeneralisedPlaneStrain</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&quot;PlaneStrain&quot;</span>:</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> mgis_bv.Hypothesis.PlaneStrain</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&quot;Axisymmetrical&quot;</span>:</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> mgis_bv.Hypothesis.Axisymmetrical</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">&quot;AxisymmetricalGeneralisedPlaneStrain&quot;</span>:</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> mgis_bv.Hypothesis.AxisymmetricalGeneralisedPlaneStrain</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> _:</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Bad hypothesis&quot;</span>)</span></code></pre></div>
<p>The following lines loads the post-processing:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(model[<span class="st">&quot;LibraryPath&quot;</span>]):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="st">&quot;Library file not found&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>mm <span class="op">=</span> mgis.model.load(model[<span class="st">&quot;LibraryPath&quot;</span>], model[<span class="st">&quot;Law&quot;</span>], h)</span></code></pre></div>
<p>We then get the offset of the damage indicator:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>o <span class="op">=</span> mgis_bv.getVariableOffset(mm.isvs, output[<span class="st">&quot;OutputData&quot;</span>], h)</span></code></pre></div>
<p>The user may refer to the <a
href="https://thelfer.github.io/mgis/web/bindings-cxx.html"><code>MGIS</code>
documentation</a> for more details.</p>
<h2 id="creation-of-the-material-data-manager">Creation of the material
data manager</h2>
<p>In order to create a <code>MaterialDataManager</code>, an
<code>MGIS</code> data structure for all the integration points to be
post-processed, the first <code>vtu</code> file is read to get the
number of integration points:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>r.SetFileName(f[<span class="dv">0</span>])</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>r.Update()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> mgis_bv.MaterialDataManager(mm, r.GetOutput().GetNumberOfPoints())</span></code></pre></div>
<p>The user may refer to the <a
href="https://thelfer.github.io/mgis/web/bindings-cxx.html"><code>MGIS</code>
documentation</a> for more details.</p>
<h2 id="initialization-of-the-material-properties">Initialization of the
material properties</h2>
<p>The following line assigns the material properties to the material
state:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pname, pval <span class="kw">in</span> material_properties.items():</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    mgis.behaviour.setMaterialProperty(m.s0, pname, pval)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    mgis.behaviour.setMaterialProperty(m.s1, pname, pval)</span></code></pre></div>
<h2
id="integration-of-the-post-processing-over-all-time-steps">Integration
of the post-processing over all time steps</h2>
<p>The following line begins the loop over all time steps:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ifile, <span class="bu">file</span> <span class="kw">in</span> <span class="bu">enumerate</span>(f):</span></code></pre></div>
<p>For each time step, the data are read from the associated
<code>vtu</code> file:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>    r.SetFileName(<span class="bu">file</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    r.Update()</span></code></pre></div>
<p>We then extract the data required by the post-processing. A special
care is taken when converting the stress or when treating the first time
step to initialize the initial state properly:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cm, cvtk <span class="kw">in</span> data[<span class="st">&quot;Components&quot;</span>].items():</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get data</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> r.GetOutput().GetPointData().GetArray(cvtk)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert to numpy</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> vtk_to_numpy(d)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># MFront type stress components</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (cm <span class="op">==</span> <span class="st">&quot;Stress&quot;</span>) <span class="kw">and</span> (</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">not</span> (model[<span class="st">&quot;Hypothesis&quot;</span>] <span class="op">==</span> <span class="st">&quot;AxisymmetricalGeneralisedPlaneStrain&quot;</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (data[<span class="st">&quot;StressNotation&quot;</span>] <span class="op">==</span> <span class="st">&quot;Voigt&quot;</span>) <span class="kw">or</span> (</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                data[<span class="st">&quot;StressNotation&quot;</span>] <span class="op">==</span> <span class="st">&quot;ReverseVoigt&quot;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                d[:, <span class="dv">3</span>:] <span class="op">*=</span> np.sqrt(<span class="dv">2</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (model[<span class="st">&quot;Hypothesis&quot;</span>] <span class="op">==</span> <span class="st">&quot;Tridimensional&quot;</span>) <span class="kw">and</span> (</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                (data[<span class="st">&quot;StressNotation&quot;</span>] <span class="op">==</span> <span class="st">&quot;Voigt&quot;</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> (data[<span class="st">&quot;StressNotation&quot;</span>] <span class="op">==</span> <span class="st">&quot;Mandel&quot;</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                d[:, [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]] <span class="op">=</span> d[:, [<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">3</span>]]</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># first iteration: set initial values (m.s0) equal to zero</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ifile <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            mgis_bv.setExternalStateVariable(</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                m.s0,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                cm,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span> <span class="op">*</span> d.reshape(d.size),</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                mgis_bv.MaterialStateManagerStorageMode.LocalStorage,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set end of step values (m.s1)</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        mgis_bv.setExternalStateVariable(</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>            m.s1,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>            cm,</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>            d.reshape(d.size),</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>            mgis_bv.MaterialStateManagerStorageMode.LocalStorage,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p>The post-processing is then called as follows:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>    mgis_bv.integrate(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>        m,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        mgis_bv.IntegrationType.IntegrationWithoutTangentOperator,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">&quot;Timestep&quot;</span>],</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        m.n,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>We then extract the damage indicator at the end of the time step and
compute its maximum value over all integration points:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> m.s1.internal_state_variables[:, o]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    res[ifile] <span class="op">=</span> np.<span class="bu">max</span>(d)</span></code></pre></div>
<p>If requested, the damage indicator is saved in a dedicated
<code>vtu</code> file:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Output vtu with damage value</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> output[<span class="st">&quot;VtkOutput&quot;</span>]:</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set mesh and writer</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        meshNew <span class="op">=</span> dsa.WrapDataObject(r.GetOutput())</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        meshNew.PointData.append(d, output[<span class="st">&quot;OutputData&quot;</span>])</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> vtk.vtkXMLUnstructuredGridWriter()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set output file name</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        w.SetFileName(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">&quot;PrefixFiles&quot;</span>] <span class="op">+</span> <span class="st">&quot;_post&quot;</span> <span class="op">+</span> <span class="bu">file</span>.split(data[<span class="st">&quot;PrefixFiles&quot;</span>])[<span class="dv">1</span>]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        w.SetInputData(meshNew.VTKObject)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output[<span class="st">&quot;VtkFormat&quot;</span>] <span class="op">==</span> <span class="st">&quot;ascii&quot;</span>:</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>            w.SetDataModeToAscii()</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        w.Write()</span></code></pre></div>
<h2 id="saving-the-results">Saving the results</h2>
<p>Finally, the <code>res</code> array is saved in a <code>txt</code>
file:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>np.savetxt(data[<span class="st">&quot;PrefixFiles&quot;</span>] <span class="op">+</span> <span class="st">&quot;_post.txt&quot;</span>, res)</span></code></pre></div>
<h1 class="unnumbered" id="references">References</h1>
<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-rice_ductile_1969" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div
class="csl-right-inline"><span class="smallcaps">Rice</span>, J. R. and
<span class="smallcaps">Tracey</span>, D. M. On the ductile enlargement
of voids in triaxial stress fields∗. <em>Journal of the Mechanics and
Physics of Solids</em>. June 1969. Vol. 17, no. 3, p. 201–217. DOI <a
href="https://doi.org/10.1016/0022-5096(69)90033-7">10.1016/0022-5096(69)90033-7</a>.
Available from: <a
href="https://linkinghub.elsevier.com/retrieve/pii/0022509669900337">https://linkinghub.elsevier.com/retrieve/pii/0022509669900337</a></div>
</div>
</div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-62273823-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
