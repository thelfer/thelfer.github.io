<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Calling behaviours inside behaviours using the @BehaviourVariable keyword</title>
        <meta name="author" content="Thomas Helfer, Antoine Martin" />
            <meta name="date" content="2025-08-01" />
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <style type="text/css">code{white-space: pre;}</style>
            <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {  background-color: #f8f8f8; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ef2929; } /* Alert */
      code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #204a87; } /* Attribute */
      code span.bn { color: #0000cf; } /* BaseN */
      code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4e9a06; } /* Char */
      code span.cn { color: #8f5902; } /* Constant */
      code span.co { color: #8f5902; font-style: italic; } /* Comment */
      code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
      code span.dt { color: #204a87; } /* DataType */
      code span.dv { color: #0000cf; } /* DecVal */
      code span.er { color: #a40000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #0000cf; } /* Float */
      code span.fu { color: #204a87; font-weight: bold; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
      code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
      code span.ot { color: #8f5902; } /* Other */
      code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
      code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
      code span.ss { color: #4e9a06; } /* SpecialString */
      code span.st { color: #4e9a06; } /* String */
      code span.va { color: #000000; } /* Variable */
      code span.vs { color: #4e9a06; } /* VerbatimString */
      code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
            <link rel="stylesheet" href="css/normalize.css"/>
    <link rel="stylesheet" href="css/main.css"/>
        <script
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
        type="text/javascript"></script>
          </head>
  <body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
        <header>
      <ul id="nav">
	<li><a href="news.html">News</a></li>
	<li><a href="index.html">Overview</a>
	  <ul>
	    <li><a>Domain specific languages</a>
	      <ul>
		<li><a href="material-properties.html">Material properties</a></li>
		<li><a href="behaviours.html">Mechanical behaviours</a></li>
		<li><a href="models.html">Models</a></li>
	      </ul>
            </li>
	    <li><a href="interfaces.html">Available interfaces</a></li>
	    <li><a href="associated-projects.html">Associated projects</a></li>
     	    <li><a>Tools</a>
	      <ul>
	        <li><a href="mfront-doc.html">mfront-doc</a></li>
	        <li><a href="mtest.html">mtest</a></li>
	        <li><a href="mfm.html">mfm</a></li>
	        <li><a href="mfm-test-generator.html">mfm-test-generator</a></li>
	        <li><a href="tfel-check.html">tfel-check</a></li>
	      </ul>
	    </li>
	  </ul>
	</li>
	<li><a>Getting started</a>
	  <ul>
	    <li><a href="https://github.com/thelfer/tfel/">Github repository</a></li>
	    <li><a href="https://github.com/thelfer/tfel/releases">Download</a></li>
	    <li><a href="release-notes.html">Release notes</a>
	      <ul>
		<li><a>Versions 2.0.x</a>
                  <ul>
                    <li><a href="release-notes.html">Versions prior to 2.0.5</a></li>
	 	    <li><a href="release-notes-2.0.5.html">Version 2.0.5</a></li>
                  </ul>
		</li>
		<li><a>Versions 3.0.x</a>
                  <ul>
		    <li><a href="release-notes-3.0.html">Version 3.0.0</a></li>
		    <li><a href="release-notes-3.0.1.html">Version 3.0.1</a></li>
		    <li><a href="release-notes-3.0.2.html">Version 3.0.2</a></li>
		    <li><a href="release-notes-3.0.3.html">Version 3.0.3</a></li>
		    <li><a href="release-notes-3.0.4.html">Version 3.0.4</a></li>
		    <li><a href="release-notes-3.0.5.html">Version 3.0.5</a></li>
		    <li><a href="release-notes-3.0.6.html">Version 3.0.6</a></li>
		    <li><a href="release-notes-3.0.7.html">Version 3.0.7</a></li>
		    <li><a href="release-notes-3.0.8.html">Version 3.0.8</a></li>
		    <li><a href="release-notes-3.0.9.html">Version 3.0.9</a></li>
		    <li><a href="release-notes-3.0.10.html">Version 3.0.10</a></li>
		    <li><a href="release-notes-3.0.11.html">Version 3.0.11</a></li>
		    <li><a href="release-notes-3.0.12.html">Version 3.0.12</a></li>
		    <li><a href="release-notes-3.0.13.html">Version 3.0.13</a></li>
		    <li><a href="release-notes-3.0.14.html">Version 3.0.14</a></li>
		    <li><a href="release-notes-3.0.15.html">Version 3.0.15</a></li>
		    <li><a href="release-notes-3.0.16.html">Version 3.0.16</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.1.x</a>
		  <ul>
		    <li><a href="release-notes-3.1.html">Version 3.1.0</a></li>
		    <li><a href="release-notes-3.1.1.html">Version 3.1.1</a></li>
		    <li><a href="release-notes-3.1.2.html">Version 3.1.2</a></li>
		    <li><a href="release-notes-3.1.3.html">Version 3.1.3</a></li>
		    <li><a href="release-notes-3.1.4.html">Version 3.1.4</a></li>
		    <li><a href="release-notes-3.1.5.html">Version 3.1.5</a></li>
		    <li><a href="release-notes-3.1.6.html">Version 3.1.6</a></li>
		    <li><a href="release-notes-3.1.7.html">Version 3.1.7</a></li>
		    <li><a href="release-notes-3.1.8.html">Version 3.1.8</a></li>
		    <li><a href="release-notes-3.1.9.html">Version 3.1.9</a></li>
		    <li><a href="release-notes-3.1.10.html">Version 3.1.10</a></li>
		    <li><a href="release-notes-3.1.11.html">Version 3.1.11</a></li>
		    <li><a href="release-notes-3.1.12.html">Version 3.1.12</a></li>
		    <li><a href="release-notes-3.1.13.html">Version 3.1.13</a></li>
		    <li><a href="release-notes-3.1.14.html">Version 3.1.14</a></li>
		    <li><a href="release-notes-3.1.15.html">Version 3.1.15</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.2.x</a>
		  <ul>
		    <li><a href="release-notes-3.2.html">Version 3.2.0</a></li>
		    <li><a href="release-notes-3.2.1.html">Version 3.2.1</a></li>
		    <li><a href="release-notes-3.2.2.html">Version 3.2.2</a></li>
		    <li><a href="release-notes-3.2.3.html">Version 3.2.3</a></li>
		    <li><a href="release-notes-3.2.4.html">Version 3.2.4</a></li>
		    <li><a href="release-notes-3.2.5.html">Version 3.2.5</a></li>
		    <li><a href="release-notes-3.2.6.html">Version 3.2.6</a></li>
		    <li><a href="release-notes-3.2.7.html">Version 3.2.7</a></li>
		    <li><a href="release-notes-3.2.8.html">Version 3.2.8</a></li>
		    <li><a href="release-notes-3.2.9.html">Version 3.2.9</a></li>
		    <li><a href="release-notes-3.2.10.html">Version 3.2.10</a></li>
		    <li><a href="release-notes-3.2.11.html">Version 3.2.11</a></li>
		    <li><a href="release-notes-3.2.12.html">Version 3.2.12</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.3.x</a>
		  <ul>
		    <li><a href="release-notes-3.3.html">Version 3.3.0</a></li>
		    <li><a href="release-notes-3.3.1.html">Version 3.3.1</a></li>
		    <li><a href="release-notes-3.3.1.html">Version 3.3.2</a></li>
		    <li><a href="release-notes-3.3.2.html">Version 3.3.2</a></li>
		    <li><a href="release-notes-3.3.3.html">Version 3.3.3</a></li>
		    <li><a href="release-notes-3.3.4.html">Version 3.3.4</a></li>
		    <li><a href="release-notes-3.3.5.html">Version 3.3.5</a></li>
		    <li><a href="release-notes-3.3.6.html">Version 3.3.6</a></li>
		    <li><a href="release-notes-3.3.7.html">Version 3.3.7</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.4.x</a>
		  <ul>
		    <li><a href="release-notes-3.4.html">Version 3.4.0</a></li>
		    <li><a href="release-notes-3.4.1.html">Version 3.4.1</a></li>
		    <li><a href="release-notes-3.4.2.html">Version 3.4.2</a></li>
		    <li><a href="release-notes-3.4.3.html">Version 3.4.3</a></li>
		    <li><a href="release-notes-3.4.4.html">Version 3.4.4</a></li>
		    <li><a href="release-notes-3.4.5.html">Version 3.4.5</a></li>
		    <li><a href="release-notes-3.4.6.html">Version 3.4.6</a></li>
		    <li><a href="release-notes-3.4.7.html">Version 3.4.7</a></li>
		    <li><a href="release-notes-3.4.8.html">Version 3.4.8</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.0.x</a>
		  <ul>
		    <li><a href="release-notes-4.0.html">Version 4.0.0</a></li>
		    <li><a href="release-notes-4.0.1.html">Version 4.0.1</a></li>
		    <li><a href="release-notes-4.0.2.html">Version 4.0.2</a></li>
		    <li><a href="release-notes-4.0.3.html">Version 4.0.3</a></li>
		    <li><a href="release-notes-4.0.4.html">Version 4.0.4</a></li>
		    <li><a href="release-notes-4.0.5.html">Version 4.0.5</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.1.x</a>
		  <ul>
		    <li><a href="release-notes-4.1.html">Version 4.1.0</a></li>
		    <li><a href="release-notes-4.1.1.html">Version 4.1.1</a></li>
		    <li><a href="release-notes-4.1.2.html">Version 4.1.2</a></li>
		    <li><a href="release-notes-4.1.3.html">Version 4.1.3</a></li>
		    <li><a href="release-notes-4.1.4.html">Version 4.1.4</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.2.x</a>
		  <ul>
		    <li><a href="release-notes-4.2.html">Version 4.2.0</a></li>
		    <li><a href="release-notes-4.2.1.html">Version 4.2.1</a></li>
		    <li><a href="release-notes-4.2.2.html">Version 4.2.2</a></li>
		    <li><a href="release-notes-4.2.3.html">Version 4.2.3</a></li>
		  </ul>
		</li>
		<li><a>Versions 5.0.x</a>
		  <ul>
		    <li><a href="release-notes-5.0.html">Version 5.0.0</a></li>
		    <li><a href="release-notes-5.0.1.html">Version 5.0.1</a></li>
		    <li><a href="release-notes-5.0.2.html">Version 5.0.2</a></li>
		  </ul>
		</li>
		<li><a>Versions 5.1.x</a>
		  <ul>
		    <li><a href="release-notes-5.1.html">Version 5.1.0</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a href="coverity-scan.html">Coverity scan</a></li>
	    <li><a href="install.html">Installation</a></li>
	  </ul>
	</li>
	<li><a>Documentation</a>
	  <ul>
	    <li><a href="documentations.html">General documentation</a></li>
	    <li><a href="gallery.html">Gallery</a></li>
<!--	    
	    <li><a href="http://tfel.sourceforge.net/doxygen/index.html">Doxygen documentation</a></li>
-->
	    <li><a>Behaviours</a>
	      <ul>
		<li><a href="tutorial.html">Tutorial</a></li>
		<li><a href="implicit-dsl.html">The Implicit DSL</a></li>
		<li><a href="benchmark.html">Benchmark</a></li>
		<li><a href="parameters.html">Parameters</a></li>
		<li><a href="BehaviourBricks.html">Behaviour bricks</a></li>
		<li><a href="interfaces.html">Solver interfaces</a>
		  <ul>
		    <li><a href="castem.html">Cast3M</a></li>
		    <li><a href="amitex.html">AMITEX_FFTP</a></li>
		    <li><a href="aster.html">Code-Aster</a></li>
    		    <li><a href="abaqus.html">Abaqus</a></li>
		    <li><a href="zmat.html">ZeBuLoN</a></li>
   		    <li><a href="calculix.html">CalculiX</a></li>
		    <!-- <li><a >TMFFT</a></li> -->
		    <li><a href="cyrano.html">Cyrano</a></li>
   		    <li><a href="generic-material-property-interface.html">Generic interface for material properties</a></li>
   		    <li><a href="generic-behaviours-interface.html">Generic interface for behaviours</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a>TFEL libraries</a>
	      <ul>
		<li><a href="libraries_usage.html">Usage of the TFEL libraries in C++</a></li>
		<li><a href="tfel-math.html">TFEL/Math</a></li>
		<li><a href="tfel-material.html">TFEL/Material</a></li>
	      </ul>
	    </li>
	    <li><a>Python modules</a>
	      <ul>
		<li><a href="tfel-python.html">TFEL modules</a></li>
		<li><a href="mfront-python.html">mfront module</a></li>
		<li><a href="mtest-python.html">mtest module</a></li>
	      </ul>
	    </li>
	    <li><a>MFront keywords</a>
	      <ul>
	        <li><a href="Default-keywords.html">Default</a></li>
	        <li><a href="DefaultCZM-keywords.html">DefaultCZM</a></li>
	        <li><a href="DefaultFiniteStrain-keywords.html">DefaultFiniteStrain</a></li>
	        <li><a href="DefaultGenericBehaviour-keywords.html">DefaultGenericBehaviour</a></li>
	        <li><a href="DefaultModel-keywords.html">DefaultModel</a></li>
	        <li><a href="Implicit-keywords.html">Implicit</a></li>
	        <li><a href="ImplicitCZM-keywords.html">ImplicitCZM</a></li>
	        <li><a href="ImplicitFiniteStrain-keywords.html">ImplicitFiniteStrain</a></li>
	        <li><a href="ImplicitGenericBehaviour-keywords.html">ImplicitGenericBehaviour</a></li>
	        <li><a href="ImplicitModel-keywords.html">ImplicitModel</a></li>
	        <li><a href="ImplicitII-keywords.html">ImplicitII</a></li>
	        <li><a href="IsotropicMisesCreep-keywords.html">IsotropicMisesCreep</a></li>
	        <li><a href="IsotropicMisesPlasticFlow-keywords.html">IsotropicMisesPlasticFlow</a></li>
	        <li><a href="IsotropicPlasticMisesFlow-keywords.html">IsotropicPlasticMisesFlow</a></li>
	        <li><a href="IsotropicStrainHardeningMisesCreep-keywords.html">IsotropicStrainHardeningMisesCreep</a></li>
	        <li><a href="MaterialLaw-keywords.html">MaterialLaw</a></li>
	        <li><a href="MaterialProperty-keywords.html">MaterialProperty</a></li>
	        <li><a href="Model-keywords.html">Model</a></li>
	        <li><a href="MultipleIsotropicMisesFlows-keywords.html">MultipleIsotropicMisesFlows</a></li>
	        <li><a href="RungeKutta-keywords.html">RungeKutta</a></li>
	        <li><a href="RungeKuttaFiniteStrain-keywords.html">RungeKuttaFiniteStrain</a></li>
	        <li><a href="RungeKuttaGenericBehaviour-keywords.html">RungeKuttaGenericBehaviour</a></li>
	        <li><a href="RungeKuttaModel-keywords.html">RungeKuttaModel</a></li>
	      </ul>
	    </li>
	    <li><a href="MTest-keywords.html">MTest keywords</a></li>
	    <li><a href="physical-constants.html">Physical constants</a></li>
	    <li><a href="glossary.html">Glossary</a></li>
	    <li><a href="publications.html">Publications</a></li>
	    <li><a href="faq.html">FAQ</a></li>
	    <li><a href="about.html">About</a></li>
	  </ul>
	</li>
	<li><a>Contributing</a>
	  <ul>
	    <li><a href="https://github.com/thelfer/tfel">Access to sources</a></li>
	    <li><a href="contributing.html">Contributing guidelines</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Report bugs</a></li>
	  </ul>
	</li>
	<li><a>Getting Help</a>
	  <ul>
	    <li><a href="search.html">Search on this site</a></li>
	    <li><a href="https://github.com/thelfer/tfel/discussions">Forum</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Bug report</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Feature request</a></li>
	    <li><a href="mailto:tfel-contact@cea.fr">Contact</a></li>
	  </ul>
	</li>
      </ul>
    </header>
<div id="header">
<h1 class="title">Calling behaviours inside behaviours using the
<code>@BehaviourVariable</code> keyword</h1>
<h2 class="author">Thomas Helfer, Antoine Martin</h2>
<h3 class="date">08/01/2025</h3>
</div>
<p>Calling other behaviours from a behaviour is useful in many
situations and allows, for instance, to</p>
<ul>
<li>write a macroscopic behaviour that calls microscopic behaviours
inside an homogeneization scheme.</li>
<li>implement a simple switch from one behaviour to another based on
some criteria in a wrapper behaviour. This technique is often used in
nuclear fuel performance codes since the behaviour of materials are
described by distinct constitutive equations in normal and off-normal
operating conditions.</li>
<li>calling complex models based on any of the following DSLs:
<code>DefaultModel</code>, <code>RungeKuttaModel</code>,
<code>ImplicitModel</code>.</li>
</ul>
<p>This document describes a solution based on so-called behaviour
variables (i.e. variables that are in fact behaviours) which are
introduced by the <code>@BehaviourVariable</code> keyword.</p>
<h2 id="example-of-usage">Example of usage</h2>
<h3 id="declaration">Declaration</h3>
<p>The following snippet declares a variable named <code>b1</code>
associated with a behaviour <code>Plasticity</code> defined in the file
<code>BehaviourVariablePlasticity.mfront</code>.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>BehaviourVariable b1 <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  file<span class="op">:</span> <span class="st">&quot;Plasticity.mfront&quot;</span><span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  variables_suffix<span class="op">:</span> <span class="st">&quot;1&quot;</span><span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  external_names_prefix<span class="op">:</span> <span class="st">&quot;FirstPhase&quot;</span><span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  store_gradients<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  store_thermodynamic_forces<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  shared_external_state_variables<span class="op">:</span> <span class="op">{</span><span class="st">&quot;.+&quot;</span><span class="op">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>This example illustrates the complexity of the declaration of a
behaviour variable. The main reason for this complexity is due to the
fact that the calling behaviour is responsible for declaring and
managing the variables associated with <code>b1</code> (material
properties, internal state variables, external state variable), etc.</p>
<p>In particular, the behaviour variable and the calling behaviour may
share some variables (material properties, external state
variables).</p>
<p>In this example, since no material property is declared as shared,
the calling behaviour will create one material property for each
material property declared in the behaviour <code>Plasticity</code> (see
the <code>shared_material_properties</code> option below for details on
how to declare shared material properties). To avoid conflicts, the
names and external names of this new material properties are modified
using the options <code>variables_prefix</code>,
<code>variables_suffix</code>, <code>external_names_prefix</code> or
<code>external_names_suffix</code>.</p>
<p>To illustrate this, let us assume that the behaviour defined in
<code>Plasticity.mfront</code> defines the following state
variables:</p>
<ul>
<li><code>eel</code>, with the glossary name
<code>ElasticStrain</code></li>
<li><code>p</code>, with the glossary name
<code>EquivalentPlastictStrain</code></li>
</ul>
<p>This can be verified by using <a
href="mfront-query.html"><code>mfront-query</code></a>:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront-query <span class="at">--unicode-output</span><span class="op">=</span>false <span class="at">--state-variables</span> Plasticity.mfront</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> ElasticStrain <span class="er">(</span><span class="ex">eel</span><span class="kw">)</span><span class="bu">:</span> The elastic strain</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> EquivalentPlasticStrain <span class="er">(</span><span class="ex">p</span><span class="kw">)</span><span class="bu">:</span> the equivalent plastic strain</span></code></pre></div>
<p>Those state variables are automatically declared as auxiliary state
variables by the calling behaviour, but their names is changed, as
follows:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront-query <span class="at">--unicode-output</span><span class="op">=</span>false <span class="at">--auxiliary-state-variables</span> MacroscopicBehaviour.mfront </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> FirstPhaseStrain <span class="er">(</span><span class="ex">eto1</span><span class="kw">)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> FirstPhaseStress <span class="er">(</span><span class="ex">sig1</span><span class="kw">)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> FirstPhaseElasticStrain <span class="er">(</span><span class="ex">eel1</span><span class="kw">)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> FirstPhaseEquivalentPlasticStrain <span class="er">(</span><span class="ex">p1</span><span class="kw">)</span></span></code></pre></div>
<p>This output only indicates that, due to the
<code>store_gradients</code> and <code>store_thermodynamic_forces</code>
options, the strain and stress of the behaviour are also declared as
auxiliary state variables</p>
<p>Finally, the last option,
<code>shared_external_state_variables</code>, states that all external
state variables are shared with the calling behaviour. As a result, the
macroscopic behaviour declares the same state variable as the behaviour
defined in <code>Plasticity.mfront</code>:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront-query <span class="at">--unicode-output</span><span class="op">=</span>false <span class="at">--external-state-variables</span> tests.mfront </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Temperature <span class="er">(</span><span class="ex">T</span><span class="kw">)</span><span class="bu">:</span> the temperature</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront-query <span class="at">--unicode-output</span><span class="op">=</span>false <span class="at">--external-state-variables</span> MacroscopicBehaviour.mfront </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Temperature <span class="er">(</span><span class="ex">T</span><span class="kw">)</span><span class="bu">:</span> the temperature</span></code></pre></div>
<h3 id="integration-of-a-behaviour-variable">Integration of a behaviour
variable</h3>
<p>A behaviour variable can be integrated using the
<code>integrate</code> method as follows:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="kw">auto</span> r <span class="op">=</span> b1<span class="op">.</span>integrate<span class="op">(</span>smflag<span class="op">,</span> smt<span class="op">);</span></span></code></pre></div>
<p>where <code>smflag</code> and <code>smt</code> are parameters
associated with the computation of the consistent tangent operator (see
below).</p>
<h3 id="retrieveing-the-tangent-operator">Retrieveing the tangent
operator</h3>
<p>The tangent operator can be retrieved using the
<code>getTangentOperator</code> method as follows:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Dt <span class="op">=</span> b1<span class="op">.</span>getTangentOperator<span class="op">();</span></span></code></pre></div>
<h2 id="options-of-the-behaviourvariable-keyword">Options of the
<code>@BehaviourVariable</code> keyword</h2>
<ul>
<li><code>file</code>: name of the <code>MFront</code> file in which the
behaviour is defined. This entry is required.</li>
<li><code>variables_prefix</code>: prefix added in front of the variable
names associated with the behaviour variable in the calling behaviour.
The prefix is added to variables that are not shared with the calling
behaviour.</li>
<li><code>variables_suffix</code>: suffix added at the end of the names
of variables that are not shared with the calling behaviour.</li>
<li><code>external_names_prefix</code>: prefix added to external names
of variables that are not shared with the calling behaviour.</li>
<li><code>external_names_suffix</code>: suffix added to external names
of variables that are not shared with the calling behaviour.</li>
<li><code>store_gradients</code>: flag stating if the gradients of the
behaviour variable must be stored in a dedicated auxiliary state
variable. This flag is <code>true</code> by default.</li>
<li><code>store_thermodynamic_forces</code>: flag stating if the
thermodynamic forces of the behaviour variable must be stored in a
dedicated auxiliary state variable. This flag is <code>true</code> by
default.</li>
<li><code>shared_material_properties</code>: list of regular expressions
used to select shared material properties. This list is empty by
default.</li>
<li><code>shared_external_state_variables</code>: list of regular
expressions used to select shared external state variables. This list is
empty by default.</li>
<li><code>automatically_save_associated_auxiliary_state_variables</code>:
flag stating if the persistent variables, gradients (if
<code>stored_gradients</code> is true) or thermodynamic forces (if
<code>stored_thermodynamic_forces</code> is true) of the behaviour
variable shall automatically be saved in the
<code>updateAuxiliaryStateVariables</code> method of the calling
behaviour. This flag is <code>true</code> by default.</li>
</ul>
<h2
id="treatment-of-the-gradients-or-thermodynamic-variables-of-the-behaviour-variable">Treatment
of the gradients or thermodynamic variables of the behaviour
variable</h2>
<p>Setting the <code>store_gradients</code> option to <code>true</code>,
which is the default value, has the following effects:</p>
<ul>
<li>an associated auxiliary state variable is automatically declared by
the calling behaviour for each gradient of the behaviour variable. These
auxiliary state variables are obtained by applying the transformation
rules on names and external names.</li>
<li>the <code>initialize/reset</code> methods associated with this
behaviour variable (see bellow) will automatically initialize the
gradients using the associated auxiliary state variables. Note that the
<code>initialize</code> method associated with this behaviour variable
is automatically called by the main <code>initialize</code> method of
the calling behaviour (which is always called).</li>
<li>the <code>updateAuxiliaryStateVariables</code> method associated
with this behaviour variable (see bellow) stores the values of the
gradients at the end of the time step in the associated auxiliary state
variables. Note that if the
<code>automatically_save_associated_auxiliary_state_variables</code>
option is set to true, the <code>updateAuxiliaryStateVariables</code>
method associated with this behaviour variable is called inside the main
<code>updateAuxiliaryStateVariables</code> method of the calling
behaviour.</li>
</ul>
<p>If the <code>store_gradients</code> option to <code>false</code>, the
calling behaviour is responsible for setting the gradients at the
beginning of the time step and either their increments or their values
at the end of the time step, depending on the case.</p>
<p>The <code>store_thermodynamic_forces</code> option has a similar role
for thermodynamic forces.</p>
<h3 id="note-on-orthotropic-behaviours">Note on orthotropic
behaviours</h3>
<p>If the called behaviour is orthotropic, the gradients and
thermodynamic forces must be defined in the material frame associated
with the behaviour variable. The calling behaviour is responsible for
making the appropriate rotations.</p>
<h3 id="note-on-the-strain-measures">Note on the strain measures</h3>
<p>If the called behaviour is based on a strain measure, then the
calling behaviour is responsible for consistently initializing the
strain at the beginning of the time step (in particular if
<code>store_gradients</code> is set to <code>false</code>), the
thermodynamic forces (in particular if
<code>store_thermodynamic_forces</code> is set to <code>false</code>)
and the strain increment.</p>
<h3 id="note-on-stress-free-strains">Note on stress free strains</h3>
<p>Strain based Behaviours requires special care if the called behaviour
declares stress free expansions (volumetric swelling, thermal expansion,
etc.). In the case, the called behaviour exposes a method called
<code>computeStressFreeStrain</code> that shall only be called
<strong>after</strong> the initialization of the behaviour. This method
returns a pair containing the stress free strains at the beginning of
the time step and at the end of the time step.</p>
<p>Assuming that the calling behaviour wants to assign a total strain
increment <code>deto_b1</code>, the method
<code>computeStressFreeStrain</code> can be used as follows:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// assuming that the behaviour is able to compute the thermal strains</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="kw">auto</span> <span class="op">[</span>eth_bts<span class="op">,</span> eth_ets<span class="op">]</span> <span class="op">=</span> b1<span class="op">.</span>computeStressFreeStrain<span class="op">();</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>b1<span class="op">.</span>deto <span class="op">=</span> deto_b1 <span class="op">-</span> eth_ets <span class="op">+</span> eth_bts<span class="op">;</span></span></code></pre></div>
<p>Note that these stress free strains are:</p>
<ul>
<li>defined consistently with the strain measure used,</li>
<li>defined in the material frame associated with the behaviour
variable.</li>
</ul>
<h2
id="treatment-of-the-persistent-variables-of-the-behaviour-variable">Treatment
of the persistent variables of the behaviour variable</h2>
<p>A behaviour variable may declares persistent variables, i.e. state
variables or auxiliary state variables. Those persistent variables are
automatically declared as auxiliary state variables by the calling
behaviour. The transformation rules on the names and external names are
applied to define those new variables (see the
<code>variables_prefix</code>, <code>variables_suffix</code>,
<code>external_names_prefix</code> or <code>external_names_suffix</code>
options).</p>
<p>The persistent variables of the behaviour variable are automatically
initialized by copying the values of the associated auxiliary state
variables of the calling behaviour.</p>
<p>If the
<code>automatically_save_associated_auxiliary_state_variables</code>
option is set to true, the persistent variables of the behaviour
variable are automatically saved in the associated auxiliary state
variables at the beginning of the
<code>updateAuxiliaryStateVariables</code> method of the calling
behaviour.</p>
<h2
id="treatment-of-the-material-properties-and-external-state-variables-of-the-behaviour-variable">Treatment
of the material properties and external state variables of the behaviour
variable</h2>
<p>When a material property (or an external state variable) of the
behaviour variable is declared as shared (see the
<code>shared_material_properties</code> and
<code>shared_external_state_variables</code>), the calling behaviour
will check if a matching material property (or an external state
variable) is declared. If not, it will declare exactly the same material
property (or external state variable), i.e. the transformation rules on
the names and external names are <strong>not</strong> applied.</p>
<p>When a material property (or an external state variable) of the
behaviour variable is <strong>not</strong> declared as shared (the
default), a new material property (or an external state variable) is
automatically declaring applying the transformation rules on names.</p>
<h2 id="access-to-the-variables-of-the-behaviour-variable">Access to the
variables of the behaviour variable</h2>
<p>The calling behaviour has access to all the variables of the
behaviour variable (material properties, parameters, external state
variables, gradients, local variables, etc..).</p>
<h2 id="initialization-of-the-behaviour-variable">Initialization of the
behaviour variable</h2>
<p>A specialized version of the <code>initialize</code> method which
takes the behaviour variable as its only argument is automatically
defined and can be called as follows:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>initialize<span class="op">(</span>b1<span class="op">);</span></span></code></pre></div>
<p>This method initializes:</p>
<ul>
<li>the persistent variables of the behaviour variable to the values of
the associated auxiliary state variables, and does the same thing for
gradients and thermodynamic forces depending on the values of the
<code>store_gradients</code> and <code>store_thermodynamic_forces</code>
options.</li>
<li>the time increment with the value of the time increment of the
calling behaviour.</li>
</ul>
<p>This method is automatically called by the main
<code>initialize</code> method of the calling behaviour (which is always
called) after initializing the material properties, external state
variables, persistent variables of the behaviour variables.</p>
<h2
id="reinitializing-and-resetting-a-behaviour-variable">Reinitializing
and resetting a behaviour variable</h2>
<p>The <code>initialize</code> method associated with a behaviour
variable can be called several times. This might be useful to integrate
this behaviour variable several times.</p>
<p>However, this does not guarantee that calling the integration of the
behaviour variable will lead to the same result as some internal
variables may have evolved.</p>
<p>In particular, the increment of the integration variables will not
zeroed. Not zeroing those increment may accelerate the integration when
the behaviour integration is called multiple times as the solution of
the previous call may be a good estimate for the new resolution.</p>
<p>To initialize the behaviour and zero the increment of the integration
variables , one may call the <code>reset</code> method instead:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>reset<span class="op">(</span>b1<span class="op">);</span> <span class="co">// calls initialize and zeros integration variable increments</span></span></code></pre></div>
<blockquote>
<p>Note that even the <code>reset</code> method does not absolutely
guarantee that calling the integration of the behaviour variable will
lead to the same result as some internal variables may have evolved.
This will probably be the case assuming that the implementation of the
called behaviour does not make any strange things internally.</p>
</blockquote>
<h2 id="integration">Integration</h2>
<p>The <code>integrate</code> method performs the integration of the
behaviour variable.</p>
<p>Note that this method must be called after having the gradients at
the beginning of the time step (see also the
<code>store_gradients</code> option for details), the thermodynamic
forces at the beginning of the time step (see also the
<code>store_thermodynamic_forces</code> option for details), and either
the gradients at the end of the time step or their increments depending
on the case.</p>
<p>The <code>integrate</code> method takes two arguments:</p>
<ul>
<li><p>one value of the enumeration <code>SMFlag</code> defined in the
<code>TangentOperatorTraits</code> class associated with the behaviour.
The class <code>TangentOperatorTraits</code> is templated by the
behaviour type:</p>
<ul>
<li>If the behaviour type is not
<code>MechanicalBehaviourBase::STANDARDFINITESTRAINBEHAVIOUR</code>,
then the enumeration <code>SMFlag</code> only contains one value
<code>STANDARDTANGENTOPERATOR</code>;</li>
<li>If the behaviour type is
<code>MechanicalBehaviourBase::STANDARDFINITESTRAINBEHAVIOUR</code>,
then the values of the enumeration <code>SMFlag</code> are described in
the <code>FiniteStrainBehaviourTangentOperatorBase</code> class.</li>
</ul></li>
<li><p>one value of the enumeration <code>SMType</code> defined in the
class <code>MechanicalBehaviourBase</code> which is a base class of all
behaviours generated by <code>MFront</code> (even non mechanical
behaviours). This enumeration defines the following values:</p>
<ul>
<li><code>ELASTIC</code>,</li>
<li><code>SECANTOPERATOR</code>,</li>
<li><code>TANGENTOPERATOR</code>,</li>
<li><code>CONSISTENTTANGENTOPERATOR</code>,</li>
<li><code>NOSTIFFNESSREQUESTED</code></li>
</ul></li>
</ul>
<p>Here is an example on how to call the integrate method of a behaviour
variable which is not a standard finite strain behaviour:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> b1_smflag <span class="op">=</span> TangentOperatorTraits<span class="op">&lt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    MechanicalBehaviourBase<span class="op">::</span>STANDARDSTRAINBASEDBEHAVIOUR<span class="op">&gt;::</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    STANDARDTANGENTOPERATOR<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="kw">auto</span> r <span class="op">=</span> b1<span class="op">.</span>integrate<span class="op">(</span>b1_smflag<span class="op">,</span> CONSISTENTTANGENTOPERATOR<span class="op">);</span></span></code></pre></div>
<p>The <code>integrate</code> method returns
<code>IntegrationResult</code> object which is implicitly convertible to
a boolean. This boolean is <code>true</code> if the integration
succeeded.</p>
<h2 id="retrieving-the-tangent-operator">Retrieving the tangent
operator</h2>
<p>The tangent operator computed by the <code>integrate</code> method
can be retrieved using the <code>getTangentOperator</code> method. If
the <code>integrate</code> method did not compute the tangent operator
(i.e. if the value <code>NOSTIFFNESSREQUESTED</code> was passed as the
second argument), the result is undefined.</p>
<h3 id="note-on-orthotropic-behaviours-1">Note on orthotropic
behaviours</h3>
<p>If the called behaviour is orthotropic, the tangent operator is
defined in the material frame associated with the behaviour variable.
The calling behaviour is responsible for making the appropriate
rotations.</p>
<h3 id="note-on-the-strain-measures-1">Note on the strain measures</h3>
<p>If the called behaviour is based on a strain measure, the tangent
operator relates the dual stress and the strain measure. The calling
behaviour is responsible for making the appropriate conversions, if
required.</p>
<h2
id="updating-the-auxiliary-state-variables-associated-with-a-behaviour-variable">Updating
the auxiliary state variables associated with a behaviour variable</h2>
<p>As stated in the previous paragraph, the
<code>automatically_save_associated_auxiliary_state_variables</code>
option controls if the auxiliary state variables associated with a
behaviour variable are automatically saved.</p>
<p>If this option is <code>false</code>, the author of the calling
behaviour is responsible for updating those state variables by hand.
This task can be deleguated to a specialized version of the
<code>updateAuxiliaryStateVariables</code> method which takes the
behaviour variable as its only argument, as follows:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>updateAuxiliaryStateVariables<span class="op">(</span>b1<span class="op">);</span></span></code></pre></div>
<p>The last solution is to cherry-pick the variables to be saved by
hand.</p>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-62273823-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
