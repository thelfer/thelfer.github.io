<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>FEniCS and MFront for complex non linear solid mechanics simulation</title>
        <meta name="author" content="Thomas Helfer, Jérémy Bleyer" />
            <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <style type="text/css">code{white-space: pre;}</style>
            <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {  background-color: #f8f8f8; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ef2929; } /* Alert */
      code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #204a87; } /* Attribute */
      code span.bn { color: #0000cf; } /* BaseN */
      code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4e9a06; } /* Char */
      code span.cn { color: #8f5902; } /* Constant */
      code span.co { color: #8f5902; font-style: italic; } /* Comment */
      code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
      code span.dt { color: #204a87; } /* DataType */
      code span.dv { color: #0000cf; } /* DecVal */
      code span.er { color: #a40000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #0000cf; } /* Float */
      code span.fu { color: #204a87; font-weight: bold; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
      code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
      code span.ot { color: #8f5902; } /* Other */
      code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
      code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
      code span.ss { color: #4e9a06; } /* SpecialString */
      code span.st { color: #4e9a06; } /* String */
      code span.va { color: #000000; } /* Variable */
      code span.vs { color: #4e9a06; } /* VerbatimString */
      code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
            <link rel="stylesheet" href="/home/th202608/codes/mgis/master/src/MFrontGenericInterfaceSupport/docs/web/css/main.css" />
        <link rel="stylesheet" href="css/normalize.css"/>
    <link rel="stylesheet" href="css/main.css"/>
        <script
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
        type="text/javascript"></script>
          </head>
  <body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
        <header>
      <ul id="nav">
	<li><a href="index.html">Overview</a></li>
	<li><a>Documentation</a>
	  <ul>
	    <li><a href="https://www.theoj.org/joss-papers/joss.02003/10.21105.joss.02003.pdf"> JOSS paper</a></li>
	    <li><a href="bindings-cxx.html">Description of the C++ library</a></li>
	    <li><a href="install.html">Installation guide</a></li>
	    <!-- <li><a>Bindings</a> -->
	    <!-- 	<ul> -->
	    <!-- 	</ul> -->
	    <!-- </li> -->
	    <li><a href="mgis_fenics.html">mgis.fenics</a>
	      <ul>
		<li><a href="mgis_fenics.html">Overview of mgis.fenics</a></li>
		<li><a href="mgis_fenics_nonlinear_heat_transfer.html">Stationnary non-linear heat transfer</a></li>
		<li><a href="mgis_fenics_nonlinear_heat_transfer_3D.html">Stationnary non-linear heat transfer: 3D problem and performance comparisons</a></li>
		<li><a href="mgis_fenics_heat_equation_phase_change.html">Transient heat equation with phase change</a></li>
		<li><a href="mgis_fenics_monolithic_transient_thermoelasticity.html">Monolithic transient thermoelasticity</a></li>
		<li><a href="mgis_fenics_small_strain_elastoplasticity.html">Small-strain von Mises elastoplasticity</a></li>
		<li><a href="mgis_fenics_finite_strain_elastoplasticity.html">Finite-strain elastoplasticity within the logarithmic strain framework</a></li>
		<li><a href="mgis_fenics_multiphase_model.html">Multiphase model for fiber-reinforced materials</a></li>
		<li><a href="mgis_fenics_phase_field.html">Phase-field approach to brittle fracture</a></li>
	      </ul>
	    </li>
	    <li><a>Release notes</a>
	      <ul>
		<li><a>Version 1.1.x</a>
		  <ul>
		    <li><a href="release-notes-1.1.html">Version 1.1</a></li>
		    <li><a href="release-notes-1.1.1.html">Version 1.1.1</a></li>
		  </ul>
		</li>
		<li><a>Version 1.2.x</a>
		  <ul>
		    <li><a href="release-notes-1.2.html">Version 1.2</a></li>
		    <li><a href="release-notes-1.2.1.html">Version 1.2.1</a></li>
		    <li><a href="release-notes-1.2.2.html">Version 1.2.2</a></li>
		  </ul>
		</li>
		<li><a>Version 2.0.x</a>
		  <ul>
		    <li><a href="release-notes-2.0.html">Version 2.0</a></li>
		    <li><a href="release-notes-2.1.html">Version 2.1</a></li>
		    <li><a href="release-notes-2.2.html">Version 2.2</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a>Specific topics</a>
	      <ul>
		<li><a href="orthotropic-behaviours.html">Support for orthotropic behaviours</a></li>
	      </ul>
	    </li>
	    <li><a href="faq.html">FAQ</a></li>
	    <li><a href="about.html">About</a></li>
	  </ul>
	</li>
	<li><a>Contributing</a>
	  <ul>
	    <li><a href="contributing.html">Contributing guidelines</a></li>
	    <li><a href="https://github.com/thelfer/MFrontGenericInterfaceSupport/issues">Report bugs</a></li>
	  </ul>
	</li>
	<li><a>Getting Help</a>
	  <ul>
	    <li><a href="https://github.com/thelfer/MFrontGenericInterfaceSupport/issues">Forum</a></li>
	    <li><a href="mailto:tfel-contact@cea.fr">Contact</a></li>
	  </ul>
	</li>
      </ul>
    </header>
    <br></br>
<div id="header">
<h1 class="title"><code>FEniCS</code> and <code>MFront</code> for
complex non linear solid mechanics simulation</h1>
<h2 class="author">Thomas Helfer, Jérémy Bleyer</h2>
<h3 class="date">14/05/2019</h3>
</div>
<p>This document is meant to show how <code>FEniCS</code> and
<code>MFront</code> can be combined to build almost arbitrary complex
non linear solid mechanics simulation. As <code>MFront</code> currently
allows the implementation of small and finite strain mechanical
behaviours, the current scope of this coupling is limited to standard
first order theories<a href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>. Generalised behaviours, usable in
monolithic multiphysics simulations and/or higher order mechanical
theories, will be available in the next version<a href="#fn2"
class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a>.</p>
<p><code>FEniCS</code> will handle:</p>
<ul>
<li>The computation of the gradients (the strain in the infinitesimal
strain assumption, the deformation gradient in finite strain).</li>
<li>The assembly of the internal and external forces.</li>
<li>The assembly of the stiffness matrix</li>
</ul>
<p>The <code>MFront</code> behaviour will handle, at each integration
point:</p>
<ul>
<li>The computation of the thermodynamic forces (the Cauchy stress
here).</li>
<li>The update of the internal state variables.</li>
<li>The computation of the consistent tangent operator.</li>
</ul>
<p>The interface with <code>FEniCS</code> will be handled by the
<code>MFrontGenericInterfaceSupport</code> project (<code>MGIS</code>)<a
href="#fn3" class="footnote-ref" id="fnref3"
role="doc-noteref"><sup>3</sup></a>. This project aims at proving tools
(functions, classes, bindings, etc…) to handle behaviours written using
<code>MFront</code> generic interface. Written in <code>C++</code>, it
provides bindings for various languages: <code>C</code>,
<code>python</code>, <code>fortran</code>. This library also provides
the so-called <code>FEniCS</code> bindings briefly described below.</p>
<p>Two approaches are available:</p>
<ul>
<li>The first one will rely on the <code>python</code> bindings. This
approach requires the user to write its own version of the Newton
solver.</li>
<li>The second one, strongly inspired by the
<code>fenics-solid-mechanics</code> project written by Kristian B.
Ølgaard and Garth N. Wells<a href="#fn4" class="footnote-ref"
id="fnref4" role="doc-noteref"><sup>4</sup></a>, will allow the usage of
the standard Newton-Raphson procedure delivered by <code>dolfin</code>.
This approach is the basis of the <code>FEniCS</code> bindings.</li>
</ul>
<p>Each approach has its strengths and weaknesses:</p>
<ul>
<li>The first approach is very flexible can be easily used to describe a
large number of situations. It is however probably be less efficient
numerically. In particular, the consistent tangent operator is stored at
each integration point, which can be a memory bottleneck for large
simulations.</li>
<li>The second approach is currently limited to <span
class="math inline">\(3D\)</span> simulations written in
<code>C++</code> and small strain behaviours<a href="#fn5"
class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.
The computation of the gradients and the construction of inner forces
and the consistent tangent operator are handled at element level: this
explain why only a limited range of behaviours are currently supported.
This approach also requires to go deep in the very gory details of
<code>FEniCS</code> internals which are far from trivial and, to the
authors opinion, currently insufficiently described for new comers in
the source code and the <code>doxygen</code> documentation.</li>
</ul>
<p>This document will focus on the coupling at the <code>python</code>
level</p>
<h1
id="rapid-description-of-useful-classes-and-functions-introduced-by-the-mgis-project">Rapid
description of useful classes and functions introduced by the
<code>MGIS</code> project</h1>
<p>In this paper, a limited number of classes and functions of the
<code>MGIS</code> project will be considered:</p>
<ul>
<li>the <code>Behaviour</code> class handles all the information about a
specific <code>MFront</code> behaviour. It is created by the
<code>load</code> function which takes the path to a library, the name
of a behaviour and a modelling hypothesis.</li>
<li>the <code>MaterialDataManager</code> class handles a bunch of
integration points. It is instantiated using an instance of the
<code>Behaviour</code> class and the number of integration points<a
href="#fn6" class="footnote-ref" id="fnref6"
role="doc-noteref"><sup>6</sup></a>. The
<code>MaterialDataManager</code> contains various interesting members:
<ul>
<li><code>s0</code>: data structure of the
<code>MaterialStateManager</code> type which stands for the material
state at the beginning of the time step.</li>
<li><code>s1</code>: data structure of the
<code>MaterialStateManager</code> type which stands for the material
state at the end of the time step.</li>
<li><code>K</code>: a <code>numpy</code> array containing the consistent
tangent operator at each integration points.</li>
</ul></li>
<li>the <code>MaterialStateManager</code> class describe the state of a
material. The following members will be useful in the following:
<ul>
<li><code>gradients</code>: a numpy array containing the value of the
gradients at each integration points. The number of components of the
gradients at each integration points is given by the
<code>gradients_stride</code> member.</li>
<li><code>thermodynamic_forces</code>:a numpy array containing the value
of the thermodynamic forces at each integration points. The number of
components of the thermodynamic forces at each integration points is
given by the <code>thermodynamic_forces_stride</code> member.</li>
<li><code>internal_state_variables</code>: a numpy array containing the
value of the internal state variables at each integration points. The
number of internal state variables at each integration points is given
by the <code>internal_state_variables_stride</code> member.</li>
</ul></li>
<li>the <code>setMaterialProperty</code> and
<code>setExternalStateVariable</code> functions can be used to set the
value a material property or a state variable respectively.</li>
<li>the <code>update</code> function updates an instance of the
<code>MaterialStateManager</code> by copying the state <code>s1</code>
at the end of the time step in the state <code>s0</code> at the
beginning of the time step.</li>
<li>the <code>revert</code> function reverts an instance of the
<code>MaterialStateManager</code> by copying the state <code>s0</code>
at the beginning of the time step in the state <code>s1</code> at the
end of the time step.</li>
<li>the <code>integrate</code> function triggers the behaviour
integration at each integration points. Various overloads of this
function exist. We will use a version taking as argument a
<code>MaterialStateManager</code>, the time increment and a range of
integration points.</li>
</ul>
<p>Those classes and functions are available in the
<code>mgis.behaviour</code> <code>python</code> module.</p>
<h1 id="application-to-a-small-strain-behaviour">Application to a small
strain behaviour</h1>
<p>This section is extracted from the following tutorial:</p>
<p><a
href="https://comet-fenics.readthedocs.io/en/latest/demo/plasticity_mfront/plasticity_mfront.py.html"
class="uri">https://comet-fenics.readthedocs.io/en/latest/demo/plasticity_mfront/plasticity_mfront.py.html</a></p>
<p>The idea is here to focus on</p>
<h2 id="initialisation-of-a-single-material">Initialisation of a single
material</h2>
<p>Assuming that number of integration points is known and stored in the
<code>ng</code> variable, a possible initialisation of a behaviour and a
material data manager can be:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling hypothesis</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> mgis_bv.Hypothesis.PlaneStrain</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># loading the behaviour        </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> mgis_bv.load(<span class="st">&#39;src/libBehaviour.so&#39;</span>,<span class="st">&#39;IsotropicLinearHardeningPlasticity&#39;</span>,h)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># material data manager</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> mgis_bv.MaterialDataManager(b,ngauss)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> [m.s0, m.s1]:</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    mgis_bv.setMaterialProperty(s, <span class="st">&quot;YoungModulus&quot;</span>, <span class="fl">150e9</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    mgis_bv.setMaterialProperty(s, <span class="st">&quot;PoissonRatio&quot;</span>, <span class="fl">0.3</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    mgis_bv.setMaterialProperty(s, <span class="st">&quot;HardeningSlope&quot;</span>, <span class="fl">150e6</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    mgis_bv.setMaterialProperty(s, <span class="st">&quot;YieldStrength&quot;</span>, <span class="fl">200e6</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    mgis_bv.setExternalStateVariable(s, <span class="st">&quot;Temperature&quot;</span>, <span class="fl">293.15</span>)</span></code></pre></div>
<h2 id="an-example-of-a-newton-raphson-loop-for-a-single-material">An
example of a Newton-Raphson loop for a single material</h2>
<p>The following code shows how a simple Newton-Raphson can be setup in
the case of a single material:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i, t) <span class="kw">in</span> <span class="bu">enumerate</span>(load_steps):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    loading.t <span class="op">=</span> t</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    A, Res <span class="op">=</span> assemble_system(a_Newton, res, bc)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    nRes0 <span class="op">=</span> Res.norm(<span class="st">&quot;l2&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    nRes <span class="op">=</span> nRes0</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    u1.assign(u)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Increment:&quot;</span>, <span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    niter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> nRes<span class="op">/</span>nRes0 <span class="op">&gt;</span> tol <span class="kw">and</span> niter <span class="op">&lt;</span> Nitermax:</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        solve(A, du.vector(), Res, <span class="st">&quot;mumps&quot;</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># current estimate of the displacement at the end of the time step </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        u1.assign(u1<span class="op">+</span>du)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># project the strain on the Quadrature space with `MFront` conventions</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        local_project(eps_MFront(u1), Weps, deps)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># assigning the values in the material data manager</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        m.s1.gradients[:, :] <span class="op">=</span> deps.vector().get_local().reshape((m.n, m.gradients_stride))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># behaviour integration</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        it <span class="op">=</span> mgis_bv.IntegrationType.IntegrationWithConsitentTangentOperator</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        mgis_bv.integrate(m, it, <span class="dv">0</span>, <span class="dv">0</span>, m.n)<span class="op">;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># getting the thermodynamic forces and the consistent tangent operator for FEniCS</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        sig.vector().set_local(m.s1.thermodynamic_forces.flatten())</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        sig.vector().<span class="bu">apply</span>(<span class="st">&quot;insert&quot;</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        Ct.vector().set_local(m.K.flatten())</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        Ct.vector().<span class="bu">apply</span>(<span class="st">&quot;insert&quot;</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># solve Newton system</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        A, Res <span class="op">=</span> assemble_system(a_Newton, res, bc)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        nRes <span class="op">=</span> Res.norm(<span class="st">&quot;l2&quot;</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;    Residual:&quot;</span>, nRes)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        niter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># update for new increment</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    u.assign(u1)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    mgis_bv.update(m)</span></code></pre></div>
<p><code>m</code> is an instance of the <code>MaterialDataManger</code>
class. The key function here is <code>local_project</code> which
computes the current estimate of the strain at the end of the time step
(stored using <code>MFront</code> conventions).</p>
<p>This code also relies on the previous definition of the consistent
tangent operator and the stress tensor, which is standard
<code>FEniCS</code> code:</p>
<pre><code>a_Newton = inner(eps_MFront(v), dot(Ct, eps_MFront(u_)))*dxm
res = -inner(eps(u_), as_3D_tensor(sig))*dxm + F_ext(</code></pre>
<p>This code suffers from the following drawbacks:</p>
<ul>
<li>Integration failures are not handled</li>
<li>Useless copies from <code>FEniCS</code> to <code>MGIS</code> and
back:</li>
</ul>
<h1 id="application-to-finite-strain-behaviours">Application to finite
strain behaviours</h1>
<p>Finite strain behaviours generated by <code>MFront</code> can also be
used quite easily.</p>
<p>The mechanical equilibrium is written in weak-form on the initial
configuration using the first Piola-Kirchhoff stress in the axisymmetric
case:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="op">-</span>inner(grad_MFront(u_), pk1)<span class="op">*</span>x[<span class="dv">0</span>]<span class="op">*</span>dxm</span></code></pre></div>
<p>The stiffness matrix naturally introduces the derivative of the first
Piola-Kirchhoff stress with respect to the deformation gradient, denoted
<code>Ct</code>:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>a_Newton <span class="op">=</span> inner(grad_MFront(v), dot(Ct, grad_MFront(u_)))<span class="op">*</span>x[<span class="dv">0</span>]<span class="op">*</span>dxm</span></code></pre></div>
<p>To tell <code>MFront</code> that we want to use the first
Piola-Kirchhoff stress and compute its derivative, one have to modify
the call to the <code>load</code> function, as follows:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the behaviour</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> mgis_bv.Hypothesis.Axisymmetrical</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>bopts <span class="op">=</span> mgis_bv.FiniteStrainBehaviourOptions()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>bopts.stress_measure <span class="op">=</span> mgis_bv.FiniteStrainBehaviourOptionsStressMeasure.PK1</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>bopts.tangent_operator <span class="op">=</span> mgis_bv.FiniteStrainBehaviourOptionsTangentOperator.DPK1_DF</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> mgis_bv.load(bopts,<span class="st">&#39;src/libBehaviour.so&#39;</span>,<span class="st">&#39;LogarithmicStrainPlasticity&#39;</span>,h)</span></code></pre></div>
<aside id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>Cohesive zone models are not considered here, mostly
because the authors don’t know if it is even possible to introduce them
in <code>FEniCS</code>.<a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Indeed, being able to test this new feature is one of
the main reason why an interface to <code>FEniCS</code> has been
considered.<a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><a
href="https://github.com/thelfer/MFrontGenericInterfaceSupport"
class="uri">https://github.com/thelfer/MFrontGenericInterfaceSupport</a><a
href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p><a
href="https://bitbucket.org/fenics-apps/fenics-solid-mechanics"
class="uri">https://bitbucket.org/fenics-apps/fenics-solid-mechanics</a><a
href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p><span class="math inline">\(2D\)</span> simulations is
theoretically supported, but the authors acknowledges that this is not
currently functional.<a href="#fnref5" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Note that an instance of
<code>MaterialDataManager</code> keeps a reference to the behaviour
which has been used for its initialization: the user must ensure that
this behaviour outlives the instance of the
<code>MaterialDataManager</code>, otherwise memory corruption may
occur.<a href="#fnref6" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>
</body>
</html>
