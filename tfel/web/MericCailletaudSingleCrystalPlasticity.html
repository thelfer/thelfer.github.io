
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-EN" xml:lang="en-EN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>How to implement the Méric-Cailletaud single crystal behaviour</title>
        <meta name="author" content="Thomas Helfer, Alexandre Bourceret, Arnaud Lejeune" />
            <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <style type="text/css">code{white-space: pre;}</style>
            <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {  background-color: #f8f8f8; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ef2929; } /* Alert */
      code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #204a87; } /* Attribute */
      code span.bn { color: #0000cf; } /* BaseN */
      code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4e9a06; } /* Char */
      code span.cn { color: #8f5902; } /* Constant */
      code span.co { color: #8f5902; font-style: italic; } /* Comment */
      code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
      code span.dt { color: #204a87; } /* DataType */
      code span.dv { color: #0000cf; } /* DecVal */
      code span.er { color: #a40000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #0000cf; } /* Float */
      code span.fu { color: #204a87; font-weight: bold; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
      code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
      code span.ot { color: #8f5902; } /* Other */
      code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
      code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
      code span.ss { color: #4e9a06; } /* SpecialString */
      code span.st { color: #4e9a06; } /* String */
      code span.va { color: #000000; } /* Variable */
      code span.vs { color: #4e9a06; } /* VerbatimString */
      code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
            <link rel="stylesheet" href="css/normalize.css"/>
    <link rel="stylesheet" href="css/main.css"/>
        <script
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
        type="text/javascript"></script>
            
        
        
      </head>
  <body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
        <header>
      <ul id="nav">
	<li><a href="news.html">News</a></li>
	<li><a href="index.html">Overview</a>
	  <ul>
	    <li><a>Domain specific languages</a>
	      <ul>
		<li><a href="material-properties.html">Material properties</a></li>
		<li><a href="behaviours.html">Mechanical behaviours</a></li>
		<li><a href="models.html">Models</a></li>
	      </ul>
            </li>
	    <li><a href="interfaces.html">Available interfaces</a></li>
	    <li><a href="associated-projects.html">Associated projects</a></li>
     	    <li><a>Tools</a>
	      <ul>
	        <li><a href="mfront-doc.html">mfront-doc</a></li>
	        <li><a href="mtest.html">mtest</a></li>
	        <li><a href="mfm.html">mfm</a></li>
	        <li><a href="mfm-test-generator.html">mfm-test-generator</a></li>
	        <li><a href="tfel-check.html">tfel-check</a></li>
	      </ul>
	    </li>
	  </ul>
	</li>
	<li><a>Getting started</a>
	  <ul>
	    <li><a href="https://github.com/thelfer/tfel/">Github repository</a></li>
	    <li><a href="https://github.com/thelfer/tfel/releases">Download</a></li>
	    <li><a href="release-notes.html">Release notes</a>
	      <ul>
		<li><a>Versions 2.0.x</a>
                  <ul>
                    <li><a href="release-notes.html">Versions prior to 2.0.5</a></li>
	 	    <li><a href="release-notes-2.0.5.html">Version 2.0.5</a></li>
                  </ul>
		</li>
		<li><a>Versions 3.0.x</a>
                  <ul>
		    <li><a href="release-notes-3.0.html">Version 3.0.0</a></li>
		    <li><a href="release-notes-3.0.1.html">Version 3.0.1</a></li>
		    <li><a href="release-notes-3.0.2.html">Version 3.0.2</a></li>
		    <li><a href="release-notes-3.0.3.html">Version 3.0.3</a></li>
		    <li><a href="release-notes-3.0.4.html">Version 3.0.4</a></li>
		    <li><a href="release-notes-3.0.5.html">Version 3.0.5</a></li>
		    <li><a href="release-notes-3.0.6.html">Version 3.0.6</a></li>
		    <li><a href="release-notes-3.0.7.html">Version 3.0.7</a></li>
		    <li><a href="release-notes-3.0.8.html">Version 3.0.8</a></li>
		    <li><a href="release-notes-3.0.9.html">Version 3.0.9</a></li>
		    <li><a href="release-notes-3.0.10.html">Version 3.0.10</a></li>
		    <li><a href="release-notes-3.0.11.html">Version 3.0.11</a></li>
		    <li><a href="release-notes-3.0.12.html">Version 3.0.12</a></li>
		    <li><a href="release-notes-3.0.13.html">Version 3.0.13</a></li>
		    <li><a href="release-notes-3.0.14.html">Version 3.0.14</a></li>
		    <li><a href="release-notes-3.0.15.html">Version 3.0.15</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.1.x</a>
		  <ul>
		    <li><a href="release-notes-3.1.html">Version 3.1.0</a></li>
		    <li><a href="release-notes-3.1.1.html">Version 3.1.1</a></li>
		    <li><a href="release-notes-3.1.2.html">Version 3.1.2</a></li>
		    <li><a href="release-notes-3.1.3.html">Version 3.1.3</a></li>
		    <li><a href="release-notes-3.1.4.html">Version 3.1.4</a></li>
		    <li><a href="release-notes-3.1.5.html">Version 3.1.5</a></li>
		    <li><a href="release-notes-3.1.6.html">Version 3.1.6</a></li>
		    <li><a href="release-notes-3.1.7.html">Version 3.1.7</a></li>
		    <li><a href="release-notes-3.1.8.html">Version 3.1.8</a></li>
		    <li><a href="release-notes-3.1.9.html">Version 3.1.9</a></li>
		    <li><a href="release-notes-3.1.10.html">Version 3.1.10</a></li>
		    <li><a href="release-notes-3.1.11.html">Version 3.1.11</a></li>
		    <li><a href="release-notes-3.1.12.html">Version 3.1.12</a></li>
		    <li><a href="release-notes-3.1.13.html">Version 3.1.13</a></li>
		    <li><a href="release-notes-3.1.14.html">Version 3.1.14</a></li>
		    <li><a href="release-notes-3.1.15.html">Version 3.1.15</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.2.x</a>
		  <ul>
		    <li><a href="release-notes-3.2.html">Version 3.2.0</a></li>
		    <li><a href="release-notes-3.2.1.html">Version 3.2.1</a></li>
		    <li><a href="release-notes-3.2.2.html">Version 3.2.2</a></li>
		    <li><a href="release-notes-3.2.3.html">Version 3.2.3</a></li>
		    <li><a href="release-notes-3.2.4.html">Version 3.2.4</a></li>
		    <li><a href="release-notes-3.2.5.html">Version 3.2.5</a></li>
		    <li><a href="release-notes-3.2.6.html">Version 3.2.6</a></li>
		    <li><a href="release-notes-3.2.7.html">Version 3.2.7</a></li>
		    <li><a href="release-notes-3.2.8.html">Version 3.2.8</a></li>
		    <li><a href="release-notes-3.2.9.html">Version 3.2.9</a></li>
		    <li><a href="release-notes-3.2.10.html">Version 3.2.10</a></li>
		    <li><a href="release-notes-3.2.11.html">Version 3.2.11</a></li>
		    <li><a href="release-notes-3.2.12.html">Version 3.2.12</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.3.x</a>
		  <ul>
		    <li><a href="release-notes-3.3.html">Version 3.3.0</a></li>
		    <li><a href="release-notes-3.3.1.html">Version 3.3.1</a></li>
		    <li><a href="release-notes-3.3.1.html">Version 3.3.2</a></li>
		    <li><a href="release-notes-3.3.2.html">Version 3.3.2</a></li>
		    <li><a href="release-notes-3.3.3.html">Version 3.3.3</a></li>
		    <li><a href="release-notes-3.3.4.html">Version 3.3.4</a></li>
		    <li><a href="release-notes-3.3.5.html">Version 3.3.5</a></li>
		    <li><a href="release-notes-3.3.6.html">Version 3.3.6</a></li>
		    <li><a href="release-notes-3.3.7.html">Version 3.3.7</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.4.x</a>
		  <ul>
		    <li><a href="release-notes-3.4.html">Version 3.4.0</a></li>
		    <li><a href="release-notes-3.4.1.html">Version 3.4.1</a></li>
		    <li><a href="release-notes-3.4.2.html">Version 3.4.2</a></li>
		    <li><a href="release-notes-3.4.3.html">Version 3.4.3</a></li>
		    <li><a href="release-notes-3.4.4.html">Version 3.4.4</a></li>
		    <li><a href="release-notes-3.4.5.html">Version 3.4.5</a></li>
		    <li><a href="release-notes-3.4.6.html">Version 3.4.6</a></li>
		    <li><a href="release-notes-3.4.7.html">Version 3.4.7</a></li>
		    <li><a href="release-notes-3.4.8.html">Version 3.4.8</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.0.x</a>
		  <ul>
		    <li><a href="release-notes-4.0.html">Version 4.0.0</a></li>
		    <li><a href="release-notes-4.0.1.html">Version 4.0.1</a></li>
		    <li><a href="release-notes-4.0.2.html">Version 4.0.2</a></li>
		    <li><a href="release-notes-4.0.3.html">Version 4.0.3</a></li>
		    <li><a href="release-notes-4.0.4.html">Version 4.0.4</a></li>
		    <li><a href="release-notes-4.0.5.html">Version 4.0.5</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.1.x</a>
		  <ul>
		    <li><a href="release-notes-4.1.html">Version 4.1.0</a></li>
		    <li><a href="release-notes-4.1.1.html">Version 4.1.1</a></li>
		    <li><a href="release-notes-4.1.2.html">Version 4.1.2</a></li>
		    <li><a href="release-notes-4.1.3.html">Version 4.1.3</a></li>
		    <li><a href="release-notes-4.1.4.html">Version 4.1.4</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.2.x</a>
		  <ul>
		    <li><a href="release-notes-4.2.html">Version 4.2.0</a></li>
		    <li><a href="release-notes-4.2.1.html">Version 4.2.1</a></li>
		    <li><a href="release-notes-4.2.2.html">Version 4.2.2</a></li>
		    <li><a href="release-notes-4.2.3.html">Version 4.2.3</a></li>
		  </ul>
		</li>
		<li><a>Versions 5.0.x</a>
		  <ul>
		    <li><a href="release-notes-5.0.html">Version 5.0.0</a></li>
		    <li><a href="release-notes-5.0.1.html">Version 5.0.1</a></li>
		  </ul>
		</li>
		<li><a>Versions 5.1.x</a>
		  <ul>
		    <li><a href="release-notes-5.1.html">Version 5.1.0</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a href="coverity-scan.html">Coverity scan</a></li>
	    <li><a href="install.html">Installation</a></li>
	  </ul>
	</li>
	<li><a>Documentation</a>
	  <ul>
	    <li><a href="documentations.html">General documentation</a></li>
	    <li><a href="gallery.html">Gallery</a></li>
<!--	    
	    <li><a href="http://tfel.sourceforge.net/doxygen/index.html">Doxygen documentation</a></li>
-->
	    <li><a>Behaviours</a>
	      <ul>
		<li><a href="tutorial.html">Tutorial</a></li>
		<li><a href="implicit-dsl.html">The Implicit DSL</a></li>
		<li><a href="benchmark.html">Benchmark</a></li>
		<li><a href="parameters.html">Parameters</a></li>
		<li><a href="BehaviourBricks.html">Behaviour bricks</a></li>
		<li><a href="interfaces.html">Solver interfaces</a>
		  <ul>
		    <li><a href="castem.html">Cast3M</a></li>
		    <li><a href="amitex.html">AMITEX_FFTP</a></li>
		    <li><a href="aster.html">Code-Aster</a></li>
    		    <li><a href="abaqus.html">Abaqus</a></li>
		    <li><a href="zmat.html">ZeBuLoN</a></li>
   		    <li><a href="calculix.html">CalculiX</a></li>
		    <!-- <li><a >TMFFT</a></li> -->
		    <li><a href="cyrano.html">Cyrano</a></li>
   		    <li><a href="generic-material-property-interface.html">Generic interface for material properties</a></li>
   		    <li><a href="generic-behaviours-interface.html">Generic interface for behaviours</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a>TFEL libraries</a>
	      <ul>
		<li><a href="libraries_usage.html">Usage of the TFEL libraries in C++</a></li>
		<li><a href="tfel-math.html">TFEL/Math</a></li>
		<li><a href="tfel-material.html">TFEL/Material</a></li>
	      </ul>
	    </li>
	    <li><a>Python modules</a>
	      <ul>
		<li><a href="tfel-python.html">TFEL modules</a></li>
		<li><a href="mfront-python.html">mfront module</a></li>
		<li><a href="mtest-python.html">mtest module</a></li>
	      </ul>
	    </li>
	    <li><a>MFront keywords</a>
	      <ul>
	        <li><a href="Default-keywords.html">Default</a></li>
	        <li><a href="DefaultCZM-keywords.html">DefaultCZM</a></li>
	        <li><a href="DefaultFiniteStrain-keywords.html">DefaultFiniteStrain</a></li>
	        <li><a href="DefaultGenericBehaviour-keywords.html">DefaultGenericBehaviour</a></li>
	        <li><a href="DefaultModel-keywords.html">DefaultModel</a></li>
	        <li><a href="Implicit-keywords.html">Implicit</a></li>
	        <li><a href="ImplicitCZM-keywords.html">ImplicitCZM</a></li>
	        <li><a href="ImplicitFiniteStrain-keywords.html">ImplicitFiniteStrain</a></li>
	        <li><a href="ImplicitGenericBehaviour-keywords.html">ImplicitGenericBehaviour</a></li>
	        <li><a href="ImplicitModel-keywords.html">ImplicitModel</a></li>
	        <li><a href="ImplicitII-keywords.html">ImplicitII</a></li>
	        <li><a href="IsotropicMisesCreep-keywords.html">IsotropicMisesCreep</a></li>
	        <li><a href="IsotropicMisesPlasticFlow-keywords.html">IsotropicMisesPlasticFlow</a></li>
	        <li><a href="IsotropicPlasticMisesFlow-keywords.html">IsotropicPlasticMisesFlow</a></li>
	        <li><a href="IsotropicStrainHardeningMisesCreep-keywords.html">IsotropicStrainHardeningMisesCreep</a></li>
	        <li><a href="MaterialLaw-keywords.html">MaterialLaw</a></li>
	        <li><a href="MaterialProperty-keywords.html">MaterialProperty</a></li>
	        <li><a href="Model-keywords.html">Model</a></li>
	        <li><a href="MultipleIsotropicMisesFlows-keywords.html">MultipleIsotropicMisesFlows</a></li>
	        <li><a href="RungeKutta-keywords.html">RungeKutta</a></li>
	        <li><a href="RungeKuttaFiniteStrain-keywords.html">RungeKuttaFiniteStrain</a></li>
	        <li><a href="RungeKuttaGenericBehaviour-keywords.html">RungeKuttaGenericBehaviour</a></li>
	        <li><a href="RungeKuttaModel-keywords.html">RungeKuttaModel</a></li>
	      </ul>
	    </li>
	    <li><a href="MTest-keywords.html">MTest keywords</a></li>
	    <li><a href="physical-constants.html">Physical constants</a></li>
	    <li><a href="glossary.html">Glossary</a></li>
	    <li><a href="publications.html">Publications</a></li>
	    <li><a href="faq.html">FAQ</a></li>
	    <li><a href="about.html">About</a></li>
	  </ul>
	</li>
	<li><a>Contributing</a>
	  <ul>
	    <li><a href="https://github.com/thelfer/tfel">Access to sources</a></li>
	    <li><a href="contributing.html">Contributing guidelines</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Report bugs</a></li>
	  </ul>
	</li>
	<li><a>Getting Help</a>
	  <ul>
	    <li><a href="search.html">Search on this site</a></li>
	    <li><a href="https://github.com/thelfer/tfel/discussions">Forum</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Bug report</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Feature request</a></li>
	    <li><a href="mailto:tfel-contact@cea.fr">Contact</a></li>
	  </ul>
	</li>
      </ul>
    </header>
<div id="header">
<h1 class="title">How to implement the Méric-Cailletaud single crystal
behaviour</h1>
<h2 class="author">Thomas Helfer, Alexandre Bourceret, Arnaud
Lejeune</h2>
<h3 class="date">2/10/2020</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#description-of-the-behaviour"
id="toc-description-of-the-behaviour">Description of the behaviour</a>
<ul>
<li><a href="#elastic-behaviour" id="toc-elastic-behaviour">Elastic
behaviour</a></li>
<li><a href="#viscoplastic-behaviour"
id="toc-viscoplastic-behaviour">Viscoplastic behaviour</a></li>
</ul></li>
<li><a href="#sec:integration:algorithm"
id="toc-sec:integration:algorithm">Integration algorithm</a>
<ul>
<li><a href="#implicit-system-by-direct-discretization"
id="toc-implicit-system-by-direct-discretization">Implicit system by
direct discretization</a></li>
<li><a href="#reduction-of-the-number-of-unknowns"
id="toc-reduction-of-the-number-of-unknowns">Reduction of the number of
unknowns</a></li>
</ul></li>
<li><a href="#implementation-using-a-numerical-jacobian"
id="toc-implementation-using-a-numerical-jacobian">Implementation using
a numerical jacobian</a>
<ul>
<li><a href="#choice-of-the-domain-specific-language"
id="toc-choice-of-the-domain-specific-language">Choice of the domain
specific language</a></li>
<li><a href="#metadata" id="toc-metadata">Metadata</a></li>
<li><a href="#supported-modelling-hypothesis"
id="toc-supported-modelling-hypothesis">Supported modelling
hypothesis</a></li>
<li><a href="#material-symmetry" id="toc-material-symmetry">Material
symmetry</a></li>
<li><a href="#numerical-parameters"
id="toc-numerical-parameters">Numerical parameters</a></li>
<li><a href="#implicit-system" id="toc-implicit-system">Implicit
system</a></li>
<li><a href="#auxiliary-state-variables-update"
id="toc-auxiliary-state-variables-update">Auxiliary state variables
update</a></li>
<li><a href="#improving-the-robustness-of-the-newton-raphson-algorithm"
id="toc-improving-the-robustness-of-the-newton-raphson-algorithm">Improving
the robustness of the Newton-Raphson algorithm</a></li>
</ul></li>
<li><a href="#implementation-with-an-analytical-jacobian"
id="toc-implementation-with-an-analytical-jacobian">Implementation with
an analytical jacobian</a>
<ul>
<li><a href="#sec:J" id="toc-sec:J">Jacobian</a></li>
<li><a href="#modification-of-the-previous-implementation"
id="toc-modification-of-the-previous-implementation">Modification of the
previous implementation</a></li>
<li><a href="#benchmarks" id="toc-benchmarks">Benchmarks</a></li>
</ul></li>
<li><a href="#extenstion-to-finite-strain"
id="toc-extenstion-to-finite-strain">Extenstion to finite
strain</a></li>
<li><a href="#applications" id="toc-applications">Applications</a></li>
<li><a href="#usage-in-code_aster" id="toc-usage-in-code_aster">Usage in
<code>code_aster</code></a></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>
<p>This article shows how to implement the Méric-Cailletaud single
crystal viscoplastic behaviour <span class="citation"
data-cites="meric_single_1991">[<a href="#ref-meric_single_1991"
role="doc-biblioref">1</a>]</span> in <code>MFront</code>. Such an
example illustrates:</p>
<ul>
<li>The usage of <code>StandardElasticity</code> brick (see <a
href="BehaviourBricks.html">this page</a>).</li>
<li>The usage of the functionnalities introduces by the
<code>TFELNumodis</code> library, as described <a
href="singlecrystal.html">here</a>. In particular, we will automatically
let <code>MFront</code> generate the slips systems and the interaction
matrix.</li>
<li>The notion of integration variables and auxiliary state
variables.</li>
<li>The FiniteStrainSingleCrystal brick, which is described <a
href="finitestrainsinglecrystal.html">here</a>.</li>
</ul>
<blockquote>
<p><strong>Advices</strong></p>
<p>This kind of behaviour is rather complex and requires lot of care to
get it work properly in any solver. We highly recommend that you follow
these steps when implementing such behaviour:</p>
<ol type="1">
<li>Validate the definition of your material orientation on a simple
orthotropic behaviour.</li>
<li>Validate the definition of the slips systems and the interaction
matrix using <code>mfront-query</code> as advocated on <a
href="singlecrystal.html">this page</a>.</li>
<li>Start validating the behaviour without isotropic hardening nor
kinematic hardening, then add the isotropic hardening and finally the
kinematic hardenings.</li>
<li>Start by using a numerical jacobian, then compute each terms of the
jacobian analytically (see the
<code>@NumericallyComputedJacobianBlocks</code> keyword to compute one
block at a time).</li>
<li>Watch out that most implementation of the Méric-Calletaud uses a
very high value for the stress exponent (typically <span
class="math inline">\(70\)</span> to <span
class="math inline">\(100\)</span>) which may lead to many divergences
of a standard Newton-Raphson algorithm. This issue is discussed at the
end of this document.</li>
</ol>
</blockquote>
<p>The implementations described in this document are available
here:</p>
<ul>
<li><a
href="gallery/viscoplasticity/MericCailletaudSingleCrystalViscoPlasticityNumericalJacobian.mfront"><code>MericCailletaudSingleCrystalViscoPlasticityNumericalJacobian.mfront</code></a>:
the implementation at small strain with a numerical jacobian</li>
<li><a
href="gallery/viscoplasticity/MericCailletaudSingleCrystalViscoPlasticity.mfront"><code>MericCailletaudSingleCrystalViscoPlasticity.mfront</code></a>:
the implementation at small strain with an analytical jacobian</li>
<li><a
href="gallery/finitestrainsinglecrystal/MericCailletaudFiniteStrainSingleCrystalViscoPlasticity.mfront"><code>MericCailletaudFiniteStrainSingleCrystalViscoPlasticity.mfront</code></a>:
the implementation at finite strain with an analytical jacobian.</li>
</ul>
<h1 id="description-of-the-behaviour">Description of the behaviour</h1>
<p>The theoretical frame which allow the monocrystalline model was
introduced in the 70. Monocrystalline behaviour describes the slip of
the crystallographic structure through the slip systems of the
considerated crystal. The crystal completely defines the different
possibilities of displacement of the atoms within the crystallographic
structure. The origin of the sliding planes lies in the contact between
certain atoms of the crystal which generates, under stress, preferential
directions of displacement. The sliding of the atoms along the sliding
planes generates dislocations within the material. As with dislocations,
there are different types of interaction between the sliding systems.
These mechanisms at the microscopic scale largely describe the origins
of the hardening of matter.</p>
<p>The first particularity of a monocrystalline law is in the use of the
Schmid tensor to project the tensors of the stresses in the resolved
shear stress.The Schmid tensor is determined from the normal to the slip
plane and the direction of the slip. The second particularity lies in
the introduction of an interaction matrix which weigths hardening
according to the type of interaction considered. The last particularity
is the introduction of the orientation of the crystal material for the
elastic and the plastic modelization.</p>
<p>The behaviour is described by a standard decomposition of the strain
<span
class="math inline">\(\underline{\varepsilon}^{\mathrm{to}}\)</span> in
an elastic and a viscoplastic component, respectively denoted <span
class="math inline">\(\underline{\varepsilon}^{\mathrm{el}}\)</span> and
<span
class="math inline">\(\underline{\varepsilon}^{\mathrm{vis}}\)</span>:</p>
<p><span class="math display">\[
\underline{\varepsilon}^{\mathrm{to}}=\underline{\varepsilon}^{\mathrm{el}}+\underline{\varepsilon}^{\mathrm{vis}}
\]</span></p>
<h2 id="elastic-behaviour">Elastic behaviour</h2>
<p>The stress <span class="math inline">\(\underline{\sigma}\)</span> is
related to the the elastic strain <span
class="math inline">\(\underline{\varepsilon}^{\mathrm{el}}\)</span> by
a the orthotropic elastic stiffness <span
class="math inline">\(\underline{\underline{\mathbf{D}}}\)</span>:</p>
<p><span class="math display">\[
\underline{\sigma}=
\underline{\underline{\mathbf{D}}}\,\colon\,\underline{\varepsilon}^{\mathrm{el}}
\]</span></p>
<h2 id="viscoplastic-behaviour">Viscoplastic behaviour</h2>
<p>In the crystal frame, the viscoplastic strain rate is the summation
of the slips along each slip systems, as follows:</p>
<p><span class="math display">\[
\underline{\dot{\varepsilon}}^{\mathrm{vis}}=\sum_{i=1}^{N}\dot{\gamma}_{i}\,\underline{m}_{i}
\]</span></p>
<p>where <span
class="math inline">\({\left({\underline{m}}_{i}\right)}_{i\in[1:N]}\)</span>
are the symmetric part of the orientation tensors, defined by:</p>
<p><span class="math display">\[
\underline{m}_{i}={{\displaystyle \frac{\displaystyle 1}{\displaystyle
2}}}\,{\left(\vec{n}_{i}\,\otimes\,\vec{b}_{i}+\vec{b}_{i}\,\otimes\,\vec{n}_{i}\right)}
\]</span></p>
<p>with <span class="math inline">\(\vec{n}_{i}\)</span> and <span
class="math inline">\(\vec{b}_{i}\)</span> being respectively the normal
to the slip plane and the slip direction. <span
class="math inline">\(\vec{n}_{i}\)</span> and <span
class="math inline">\(\vec{b}_{i}\)</span> being orthogonal, the
viscoplastic flow is incompressible <a href="#fn1" class="footnote-ref"
id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>The computation of the dissipated power yields:</p>
<p><span class="math display">\[
\underline{\sigma}\,\colon\,\underline{\dot{\varepsilon}}^{\mathrm{vis}}=
\sum_{i=1}^{N}\dot{\gamma}_{i}\,\underline{\sigma}\,\colon\,\underline{m}_{i}=
\sum_{i=1}^{N}\dot{\gamma}_{i}\,\tau_{i}
\]</span></p>
<p>This equation shows that that the split rate is <span
class="math inline">\(\dot{\gamma}_{i}\)</span> is conjugated to the
resolved shear stress <span
class="math inline">\(\tau_{i}=\underline{\sigma}\,\colon\,\underline{m}_{i}\)</span>.</p>
<p>The Méric-Cailletaud behaviour is a scalar equivalent of the
Norton-Hoff behaviour with isotropic and kinematic hardening along each
slip plane, i.e. the split rate <span
class="math inline">\(\dot{\gamma}_{i}\)</span> is expressed as:</p>
<p><span id="eq:vp"><span class="math display">\[
\left\{
\begin{aligned}
\dot{\gamma}_{i}&amp;=\dot{p}_{i}\,\mathop{sgn}{\left(\tau_{i}-x_{i}\right)}\\
\dot{p}_{i}&amp;=\left\langle{{\displaystyle \frac{\displaystyle
\left|\tau_{i}-x_{i}\right|-R_{i}-\tau_{0}}{\displaystyle
K}}}\right\rangle^n
\end{aligned}
\right.
\qquad{(1)}\]</span></span></p>
<p>where <span
class="math inline">\(p_{i}=\displaystyle\int_{t_{0}}^{t}\left|\dot{\gamma}_{i}\right|\,{{\mathrm{d}}}\,t\)</span>
is the equivalent viscoplastic slip.</p>
<p>The isotropic hardening rule couples the slip every systems as
follows:</p>
<p><span id="eq:R"><span class="math display">\[
R_{i}=Q\,\sum_{j=1}^{N}h_{ij}\,{\left(1-\exp{\left(-b\,p_{j}\right)}\right)}
\qquad{(2)}\]</span></span></p>
<p>where <span class="math inline">\(h\)</span> is the so-called
interaction matrix</p>
<p>The kinematic hardening follows a scalar equivalent of the
Armstrong-Frederick law:</p>
<p><span id="eq:x"><span class="math display">\[
\left\{
\begin{aligned}
x_{i}&amp;=C\,\alpha_{i} \\
\dot{\alpha}_{i}&amp;=\dot{\gamma}_{i}-D\,\alpha_{i}\,\dot{p}_{i}
\end{aligned}
\right.
\qquad{(3)}\]</span></span></p>
<h1 id="sec:integration:algorithm">Integration algorithm</h1>
<p>The behaviour will be integrated using an implicit scheme as
described <a href="implicit-dsl.html">here</a>.</p>
<h2 id="implicit-system-by-direct-discretization">Implicit system by
direct discretization</h2>
<p><em>A priori</em>, The unknowns are the increments of the elastic
strain <span
class="math inline">\(\Delta\,\underline{\varepsilon}^{\mathrm{el}}\)</span>,
of the plastic slips <span
class="math inline">\({\left({\Delta\,\gamma}_{i}\right)}_{i\in[1:N]}\)</span>,
of the equivalent plastic slips <span
class="math inline">\({\left({\Delta\,p}_{i}\right)}_{i\in[1:N]}\)</span>
and of the back-strains <span
class="math inline">\({\left({\Delta\,\alpha}_{i}\right)}_{i\in[1:N]}\)</span>.
After a straightforward discretization, the following system of non
equations are to be solved:</p>
<p><span id="eq:F"><span class="math display">\[
\left\{
\begin{aligned}
f_{\underline{\varepsilon}^{\mathrm{el}}}  &amp;=
\Delta\,\underline{\varepsilon}^{\mathrm{el}}-\Delta\,\underline{\varepsilon}^{\mathrm{to}}+\sum_{i=1}^{N}\Delta\,\gamma_{i}\,\underline{m}_{i}&amp;=0
\\
f_{\gamma_{i}} &amp;=
\Delta\,\gamma_{i}-\Delta\,p_{i}\,\mathop{sgn}{\left({\left.\tau_{i}\right|_{t+\theta\,\Delta\,t}}-{\left.x_{i}\right|_{t+\theta\,\Delta\,t}}\right)}&amp;=0
\\
f_{p_{i}} &amp;= \Delta\,p_{i}-\Delta\,t\,\left\langle{{\displaystyle
\frac{\displaystyle
\left|{\left.\tau_{i}\right|_{t+\theta\,\Delta\,t}}-{\left.x_{i}\right|_{t+\theta\,\Delta\,t}}\right|-{\left.R_{i}\right|_{t+\theta\,\Delta\,t}}-\tau_{0}}{\displaystyle
K}}}\right\rangle^n &amp;=0\\
f_{\alpha_{i}}&amp;=
\Delta\,\alpha_{i}-\Delta\,\gamma_{i}+D\,{\left.\alpha_{i}\right|_{t+\theta\,\Delta\,t}}\,\Delta\,p_{i}&amp;=0
\end{aligned}
\right.
\qquad{(4)}\]</span></span></p>
<p>where :</p>
<ul>
<li><span
class="math inline">\({\left.\tau_{i}\right|_{t+\theta\,\Delta\,t}}={\left.\underline{\sigma}\right|_{t+\theta\,\Delta\,t}}\,\colon\,\underline{m}_{i}\)</span>
with <span
class="math inline">\({\left.\underline{\sigma}\right|_{t+\theta\,\Delta\,t}}=\underline{\underline{\mathbf{D}}}\,\colon\,{\left.\underline{\varepsilon}^{\mathrm{el}}\right|_{t+\theta\,\Delta\,t}}\)</span>
and <span
class="math inline">\({\left.\underline{\varepsilon}^{\mathrm{el}}\right|_{t+\theta\,\Delta\,t}}={\left.\underline{\varepsilon}^{\mathrm{el}}\right|_{t}}+\theta\,\Delta\,\underline{\varepsilon}^{\mathrm{el}}\)</span></li>
<li><span
class="math inline">\({\left.x_{i}\right|_{t+\theta\,\Delta\,t}}=C\,{\left.\alpha_{i}\right|_{t+\theta\,\Delta\,t}}\)</span>
with <span
class="math inline">\({\left.\alpha\right|_{t+\theta\,\Delta\,t}}={\left.\alpha\right|_{t}}+\theta\,\Delta\,\alpha\)</span></li>
<li><span
class="math inline">\(\displaystyle{\left.R_{i}\right|_{t+\theta\,\Delta\,t}}=Q\,\sum_{j=1}^{N}h_{ij}\,{\left(1-\exp{\left(-b\,{\left.p_{j}\right|_{t+\theta\,\Delta\,t}}\right)}\right)}\)</span>
with <span
class="math inline">\({\left.p\right|_{t+\theta\,\Delta\,t}}={\left.p\right|_{t}}+\theta\,\Delta\,p\)</span></li>
</ul>
<p>This number of unknowns of System (4) is egal to <span
class="math inline">\(6+3\,N_{ss}\)</span> where <span
class="math inline">\(N_{ss}\)</span> is the number of slip systems and
<span class="math inline">\(6\)</span> is the number of component of the
elastic strain.</p>
<h2 id="reduction-of-the-number-of-unknowns">Reduction of the number of
unknowns</h2>
<p>We now show how to reduce the size of this system to <span
class="math inline">\(6+N_{ss}\)</span>.</p>
<blockquote>
<p><strong>Notes</strong></p>
<p>Reducing the number of unknowns has two main impacts:</p>
<ul>
<li>The size of the linear system to be solved at each time step is
greatly reduced</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>When using a numerical jacobian, the number of evaluations of the
implicit system is reduced from <span
class="math inline">\(13+12\,N_{ss}\)</span> to <span
class="math inline">\(13+2\,Nss\)</span> per iteration of the Newton
algorithm (finite centered difference). If <span
class="math inline">\(Nss\)</span> is <span
class="math inline">\(12\)</span>, as in our example, the number of
evaluations is thus <span class="math inline">\(37\)</span> rather than
<span class="math inline">\(157\)</span> !</li>
</ul>
</blockquote>
<p>First, the relationship between <span
class="math inline">\(\Delta\,p_{i}\)</span> and <span
class="math inline">\(\Delta\,\gamma_{i}\)</span> is trivial:</p>
<p><span class="math display">\[
\Delta\,p_{i}=\left|\Delta\,\gamma_{i}\right|
\]</span></p>
<p>One may choose one of them and eliminate the other for the system. In
the following, we keep <span
class="math inline">\(\Delta\,\gamma_{i}\)</span>.</p>
<p>It shall be noted that:</p>
<ul>
<li>We only need <span class="math inline">\(\Delta\,\gamma_{i}\)</span>
as an unknown of the implicit system but do not need to save it. In
<code>MFront</code>, such variables are called <em>integration
variables</em> and are declared through the
<code>@IntegrationVariable</code> keyword. Note that one may save the
values of <span class="math inline">\(\Delta\,\gamma_{i}\)</span> only
by changing its declaration from <code>@IntegrationVariable</code> to
<code>@StateVariable</code>, which can be usefull for debugging purposes
or for post-processing: this possibility is the main reason to keep
<span class="math inline">\(\Delta\,\gamma_{i}\)</span> rather than
<span class="math inline">\(\Delta\,p_{i}\)</span>.</li>
<li>We need to keep the save the values of <span
class="math inline">\(p_{i}\)</span> for one step to the other. In
<code>MFront</code>, such variables are called <em>auxiliary state
variables</em> and are declared through the
<code>@AuxiliaryStateVariable</code> keyword.</li>
</ul>
<p>Second, <span class="math inline">\(f_{\alpha_{i}}\)</span> can be
used to express <span class="math inline">\(\Delta\,\alpha_{i}\)</span>
as a function of <span class="math inline">\(\Delta\,p_{i}\)</span> and
<span class="math inline">\(\Delta\,\gamma_{i}\)</span> :</p>
<p><span id="eq:alpha"><span class="math display">\[
\begin{aligned}
\Delta\,\alpha_{i}&amp;=
{{\displaystyle \frac{\displaystyle
\Delta\,\gamma_{i}-D\,{\left.\alpha_{i}\right|_{t}}\,\Delta\,p_{i}}{\displaystyle
1+D\,\theta\,\Delta\,p_{i}}}}=
{{\displaystyle \frac{\displaystyle
\Delta\,\gamma_{i}-D\,{\left.\alpha_{i}\right|_{t}}\,\left|\Delta\,\gamma_{i}\right|}{\displaystyle
1+D\,\theta\,\left|\Delta\,\gamma_{i}\right|}}}\\
&amp;={\left(1-D\,{\left.\alpha_{i}\right|_{t}}\,\mathop{sgn}{\left(\Delta\,\gamma_{i}\right)}\right)}\,{{\displaystyle
\frac{\displaystyle \Delta\,\gamma_{i}}{\displaystyle
1+D\,\theta\,\mathop{sgn}{\left(\Delta\,\gamma_{i}\right)}\,\Delta\,\gamma_{i}}}}
\end{aligned}
\qquad{(5)}\]</span></span></p>
<p>Finally, the implicit system to be solved is:</p>
<p><span id="eq:F2"><span class="math display">\[
\left\{
\begin{aligned}
f_{\underline{\varepsilon}^{\mathrm{el}}}  &amp;=
\Delta\,\underline{\varepsilon}^{\mathrm{el}}-\Delta\,\underline{\varepsilon}^{\mathrm{to}}+\sum_{i=1}^{N}\Delta\,\gamma_{i}\,\underline{m}_{i}&amp;=0
\\
f_{\gamma_{i}}&amp;=\Delta\,\gamma_{i}-\Delta\,t\,v{\left(f\right)}\,\mathop{sgn}{\left(\tau_e\right)}
\end{aligned}
\right.
\qquad{(6)}\]</span></span></p>
<p>with:</p>
<ul>
<li><span
class="math inline">\(v{\left(f\right)}=\left\langle{{\displaystyle
\frac{\displaystyle f}{\displaystyle K}}}\right\rangle^n\)</span></li>
<li><span
class="math inline">\(f=\left|\tau_e\right|-R_{i}-\tau_0\)</span></li>
<li><span
class="math inline">\(\tau_e={\left.\tau_{i}\right|_{t+\theta\,\Delta\,t}}-{\left.x_{i}\right|_{t+\theta\,\Delta\,t}}\)</span></li>
</ul>
<p>The latter notations have been introduced to ease the analytical
computation of the jacobian, see Section 4.1.</p>
<h1 id="implementation-using-a-numerical-jacobian">Implementation using
a numerical jacobian</h1>
<h2 id="choice-of-the-domain-specific-language">Choice of the domain
specific language</h2>
<p>The implementation begins with the choice of the
<code>Implicit</code> domain specific language (dsl):</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>DSL Implicit<span class="op">;</span></span></code></pre></div>
<p>Note that this dsl automatically declares the elastic strain
<code>eel</code> as a state variable.</p>
<h2 id="metadata">Metadata</h2>
<p>The following code declares the name of the behaviour, the names of
the authors, and the date.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Behaviour MericCailletaudSingleCrystalViscoPlasticityNumericalJacobian<span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Author Thomas Helfer<span class="op">,</span> Alexandre Bourceret<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Date <span class="dv">17</span> <span class="op">/</span> <span class="dv">10</span> <span class="op">/</span> <span class="dv">2019</span><span class="op">;</span></span></code></pre></div>
<h2 id="supported-modelling-hypothesis">Supported modelling
hypothesis</h2>
<p>This behaviour is only valid in <span
class="math inline">\(3D\)</span>. The following line restricts the
behaviour to be only usable in <span
class="math inline">\(3D\)</span>:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>ModellingHypothesis Tridimensional<span class="op">;</span></span></code></pre></div>
<h2 id="material-symmetry">Material symmetry</h2>
<p>The behaviour describes an orthotropic material:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>OrthotropicBehaviour<span class="op">;</span></span></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>As the behaviour is only valid in <span
class="math inline">\(3D\)</span>, there is no need to specify any
orthotropic axises convention (see the
<code>@OrthotropicBehaviour</code> keyword for details).</p>
</blockquote>
<h2 id="numerical-parameters">Numerical parameters</h2>
<p>The following lines declare that we want to use a standard
Newton-Raphson algorithm with a numerically evaluated jacobian. The
perturbation value used to evaluate the jacobian is chosen equal to
<span class="math inline">\(10^{-7}\)</span> which is a reasonnable
value.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Algorithm NewtonRaphson_NumericalJacobian<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>PerturbationValueForNumericalJacobianComputation <span class="fl">1.e-7</span><span class="op">;</span></span></code></pre></div>
<p>The stopping criterion is chosen low, to ensure the quality of the
consistent tangent operator (the default value, <span
class="math inline">\(10^{-8}\)</span> is enough to ensure a good
estimation of the state variable evolution, but is not enough to have a
proper estimation of the consistent tangent operator):</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Epsilon <span class="fl">1e-14</span><span class="op">;</span></span></code></pre></div>
<p>We explicit state that a fully implicit integration will be used by
default:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Theta <span class="dv">1</span><span class="op">;</span></span></code></pre></div>
<p>This value can be changed at runtime by modifying the
<code>theta</code> parameter.</p>
<h3 id="usage-of-the-standardelasticity-brick">Usage of the
<code>StandardElasticity</code> brick</h3>
<p>To implement this behaviour, we will use the
<code>StandardElasticity</code> brick which provides:</p>
<ul>
<li>Automatic computation of the stress tensor at various stages of the
behaviour integration.</li>
<li>Automatic computation of the consistent tangent operator.</li>
<li>Automatic support for plane stress and generalized plane stress
modelling hypotheses (The axial strain is defined as an additional state
variable and the associated equation in the implicit system is added to
enforce the plane stess condition).</li>
<li>Automatic addition of the standard terms associated with the elastic
strain state variable.</li>
</ul>
<p>This behaviour brick is fully described <a
href="BehaviourBricks.html">here</a>.</p>
<p>The usage of the <code>StandardElasticity</code> is declared as
follows:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Brick StandardElasticity<span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  young_modulus1 <span class="op">:</span> <span class="dv">208000</span><span class="op">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  young_modulus2 <span class="op">:</span> <span class="dv">208000</span><span class="op">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  young_modulus3 <span class="op">:</span> <span class="dv">208000</span><span class="op">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  poisson_ratio12 <span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  poisson_ratio23 <span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  poisson_ratio13 <span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  shear_modulus12 <span class="op">:</span> <span class="dv">80000</span><span class="op">,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  shear_modulus23 <span class="op">:</span> <span class="dv">80000</span><span class="op">,</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  shear_modulus13 <span class="op">:</span> <span class="dv">80000</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>Here, we chose to declare the elastic material properties as part of
the brick declaration. This pratice has been introduced in
<code>TFEL-3.2</code> with the development of the
<code>StandardElastoViscoPlasticity</code>brick. The material properties
can also be computed using a formula or an external <code>MFront</code>
files.</p>
<p>The elastic material properties can also be introduced by:</p>
<ul>
<li>using the <code>@ComputeStiffnessTensor</code>.</li>
<li>using the <code>@RequireStiffnessTensor</code>, which requires the
calling solver to provide the stiffness tensor. For most interfaces, it
is means that additional material properties are required.</li>
</ul>
</blockquote>
<p>The declaration of the elastic material properties automatically
defines the variables <code>D</code> and <code>D_tdt</code> which
respectively holds the stiffness tensor at the middle of the time step
(at <span class="math inline">\(t+\theta\,\Delta\,t\)</span> and the
stiffness at the end of the time step (at <span
class="math inline">\(t+\Delta\,t\)</span>.</p>
<h3
id="definition-of-the-crystal-structure-the-slip-systems-and-the-interaction-matrix">Definition
of the crystal structure, the slip systems and the interaction
matrix</h3>
<p>The following lines, based on the <code>TFELNumodis</code> library
introduced in <code>TFEL 3.1.0</code> defines the the crystal structure,
the slip systems and the interaction matrix:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>CrystalStructure FCC<span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>SlidingSystem<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">&gt;{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">};</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>InteractionMatrix<span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="fl">0.6</span><span class="op">,</span> <span class="fl">1.8</span><span class="op">,</span> <span class="fl">1.6</span><span class="op">,</span> <span class="fl">12.3</span><span class="op">,</span> <span class="fl">1.6</span><span class="op">};</span></span></code></pre></div>
<p>Those keywords are fully documented on <a
href="singlecrystal.html">this page</a>. We highly recommend that the
user take the time to understandand how they work.</p>
<p>In this particular case, the family
<code>&lt;0, 1, -1&gt;{1, 1, 1}</code> generates <span
class="math inline">\(12\)</span> slips systems by symmetry. The
generated slip systems and their associated indexes can be retrieved by
the <code>mfront-query</code> tool:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront-query MericCailletaudSingleCrystalViscoPlasticityNumericalJacobian.mfront <span class="at">--slip-systems-by-index</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 0: <span class="pp">[</span><span class="ss">0,1,</span><span class="pp">-</span><span class="ss">1</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,1,1</span><span class="kw">)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 1: <span class="pp">[</span><span class="ss">1,0,</span><span class="pp">-</span><span class="ss">1</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,1,1</span><span class="kw">)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 2: <span class="pp">[</span><span class="ss">1,</span><span class="pp">-</span><span class="ss">1,0</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,1,1</span><span class="kw">)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 3: <span class="pp">[</span><span class="ss">0,1,1</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,1,-1</span><span class="kw">)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 4: <span class="pp">[</span><span class="ss">1,0,1</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,1,-1</span><span class="kw">)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 5: <span class="pp">[</span><span class="ss">1,</span><span class="pp">-</span><span class="ss">1,0</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,1,-1</span><span class="kw">)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 6: <span class="pp">[</span><span class="ss">0,1,</span><span class="pp">-</span><span class="ss">1</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,-1,-1</span><span class="kw">)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 7: <span class="pp">[</span><span class="ss">1,0,1</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,-1,-1</span><span class="kw">)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 8: <span class="pp">[</span><span class="ss">1,1,0</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,-1,-1</span><span class="kw">)</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 9: <span class="pp">[</span><span class="ss">0,1,1</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,-1,1</span><span class="kw">)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 10: <span class="pp">[</span><span class="ss">1,0,</span><span class="pp">-</span><span class="ss">1</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,-1,1</span><span class="kw">)</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> 11: <span class="pp">[</span><span class="ss">1,1,0</span><span class="pp">]</span><span class="er">(</span><span class="ex">1,-1,1</span><span class="kw">)</span></span></code></pre></div>
<p>The interation matrix, which is non symmetric, has <span
class="math inline">\(7\)</span> independent coefficients. The precise
structure of this interaction matrix can be retrieved thank to the
<code>mfront-query</code> tool as follows:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront-query MericCailletaudSingleCrystalViscoPlasticityNumericalJacobian.mfront <span class="at">--interaction-matrix</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">0</span> 1 1 2 3 4 5 6 6 2 4 3 <span class="kw">|</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">1</span> 0 1 3 2 4 4 2 3 6 5 6 <span class="kw">|</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">1</span> 1 0 6 6 5 4 3 2 3 4 2 <span class="kw">|</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">2</span> 3 4 0 1 1 2 4 3 5 6 6 <span class="kw">|</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">3</span> 2 4 1 0 1 6 5 6 4 2 3 <span class="kw">|</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">6</span> 6 5 1 1 0 3 4 2 4 3 2 <span class="kw">|</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">5</span> 6 6 2 4 3 0 1 1 2 3 4 <span class="kw">|</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">4</span> 2 3 6 5 6 1 0 1 3 2 4 <span class="kw">|</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">4</span> 3 2 3 4 2 1 1 0 6 6 5 <span class="kw">|</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">2</span> 4 3 5 6 6 2 3 4 0 1 1 <span class="kw">|</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">6</span> 5 6 4 2 3 3 2 4 1 0 1 <span class="kw">|</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">3</span> 4 2 4 3 2 6 6 5 1 1 0 <span class="kw">|</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="ex">with:</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> coefficient <span class="st">&#39;0&#39;</span>: 1</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> coefficient <span class="st">&#39;1&#39;</span>: 1</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> coefficient <span class="st">&#39;2&#39;</span>: 0.6</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> coefficient <span class="st">&#39;3&#39;</span>: 1.8</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> coefficient <span class="st">&#39;4&#39;</span>: 1.6</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> coefficient <span class="st">&#39;5&#39;</span>: 12.3</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> coefficient <span class="st">&#39;6&#39;</span>: 1.6</span></code></pre></div>
<p>Those instructions also automatically defines :</p>
<ul>
<li>an integer constant called <code>Nss</code> which holds the number
of slip systems (<span class="math inline">\(12\)</span> here).</li>
<li>an class which contains the slip systems and the interaction matrix.
The name of this class is the name of the behaviour followed by
<code>SlipSystems</code>. In this example, this class’ name is thus:
<code>MericCailletaudSingleCrystalViscoPlasticityNumericalJacobianSlipSystems</code>.
This class provides the <code>getSlipSystems</code> methods which
returns the unique instance of this class (singleton).</li>
</ul>
<h3 id="material-parameters">Material parameters</h3>
<p>The following block of code defines the various material parameters
used in the constitutive equations associated with the plastic
slips:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter n <span class="op">=</span> <span class="fl">10.0</span><span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter K <span class="op">=</span> <span class="fl">25.</span><span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter tau0 <span class="op">=</span> <span class="fl">66.62</span><span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter Q <span class="op">=</span> <span class="fl">11.43</span><span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter b <span class="op">=</span> <span class="fl">2.1</span><span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter d <span class="op">=</span> <span class="fl">494.0</span><span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter C <span class="op">=</span> <span class="dv">14363</span><span class="op">;</span></span></code></pre></div>
<h3
id="integration-variables-state-variables-and-auxiliary-state-variables">Integration
variables, state variables and auxiliary state variables</h3>
<p>As described earlier (see Section 2), the viscoplastic slips <span
class="math inline">\({\left({\gamma}_{i}\right)}_{i\in[1:N]}\)</span>
are declared as integration variables as follows:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>IntegrationVariable strain g<span class="op">[</span>Nss<span class="op">];</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>g<span class="op">.</span>setEntryName<span class="op">(</span><span class="st">&quot;ViscoplasticSlip&quot;</span><span class="op">);</span></span></code></pre></div>
<p>As discussed before, declaring the viscoplastic slips as state
variables would save their values from one step to the other which can
be convenient for debugging and/or post-processing.</p>
<p>The equivalent viscoplastic slips and the back-strains are declared
as auxiliary state variables:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>AuxiliaryStateVariable strain p<span class="op">[</span>Nss<span class="op">];</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>setEntryName<span class="op">(</span><span class="st">&quot;EquivalentViscoplasticSlip&quot;</span><span class="op">);</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>AuxiliaryStateVariable strain a<span class="op">[</span>Nss<span class="op">];</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>a<span class="op">.</span>setEntryName<span class="op">(</span><span class="st">&quot;BackStrain&quot;</span><span class="op">);</span></span></code></pre></div>
<h2 id="implicit-system">Implicit system</h2>
<p>The <code>@Integrator</code> block allows the definition of the
implicit system. We divided it into three sections:</p>
<ul>
<li>a preamble which retrieves the object containing the slip systems
and the interatction matrix.</li>
<li>a section which precomputes the exponentials appearing in the the
isotropic hardening of each slip systems</li>
<li>a section which updates the implicit equation <code>feel</code>
associated with elasticity and which defines the implicits equations
<code>fg</code> associated with the plastic slips.</li>
</ul>
<h3 id="preamble">Preamble</h3>
<div class="sourceCode" id="cb15"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Integrator <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> <span class="dt">size_type</span> <span class="op">=</span> <span class="dt">unsigned</span> <span class="dt">short</span><span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> <span class="op">&amp;</span>ss <span class="op">=</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>      MericCailletaudSingleCrystalViscoPlasticityNumericalJacobianSlipSystems<span class="op">&lt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>          real<span class="op">&gt;::</span>getSlipSystems<span class="op">();</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> m <span class="op">=</span> ss<span class="op">.</span>him<span class="op">;</span></span></code></pre></div>
<p>The first line defines a type alias: after this
<code>size_type</code> is a short hand for the
<code>unsigned short</code> integer type used as the index type by loops
on the slip systems.</p>
<p>The second line retrieves the uniq instance of the
<code>MericCailletaudSingleCrystalViscoPlasticityNumericalJacobianSlipSystems</code>
class. The <code>const</code> keywords means that this variable is
immutable. The <code>auto</code> keyword means that the type of the
<code>ss</code> variable is deduced by the compiler. The ampersand
character <code>&amp;</code> means that <code>ss</code> is a reference,
i.e. the object returned by the <code>getSlipSystems</code> method is
not copied.</p>
<p>The object referenced by the<code>ss</code> variable contains two
data members:</p>
<ul>
<li><code>ss.him</code> which contains the hardening interaction matrix
defined by the <code>@InteractionMatrix</code> keyword.</li>
<li><code>ss.mus</code> which contains the symmetric parts of the
orientations tensors defined by the <code>@SlidingSystem</code>
keyword.</li>
</ul>
<p>The last line defines <code>m</code> as an immutable reference the
the interaction matrix.</p>
<h3 id="precomputation-of-the-exponentials">Precomputation of the
exponentials</h3>
<p>In order to precompute the exponentials appearing in the isotropic
hardening of each slip systems, we first compute declare an array of
size <code>Nss</code> called <code>exp_bp</code>. We then loop over each
slip systems.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// precomputing the exponentials used to compute the isotropic hardening of</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// each slip systems</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  real exp_bp<span class="op">[</span>Nss<span class="op">];</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">size_type</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">!=</span> Nss<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">const</span> <span class="kw">auto</span> <span class="va">p_</span> <span class="op">=</span> p<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> theta <span class="op">*</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      exp_bp<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> exp<span class="op">(-</span>b <span class="op">*</span> <span class="va">p_</span><span class="op">);</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span></code></pre></div>
<h3 id="definition-of-the-implicit-equations">Definition of the implicit
equations</h3>
<p>Befor defining the implicit equations, it is important to remember a
few conventions of the <code>Implicit</code> DSL and of the
<code>StandardElasticity</code> brick:</p>
<ul>
<li>The implicit equations are initialized by the <code>Implicit</code>
dsl to the current estimate of the increment of the associated
variable.</li>
<li>The implicit equation <code>feel</code> associated with the elastic
strain is initialized to <span
class="math inline">\(\Delta\,\underline{\varepsilon}^{\mathrm{el}}-\Delta\,\underline{\varepsilon}^{\mathrm{to}}\)</span>
by the <code>StandardElasticity</code> brick.</li>
<li>Before each evaluation of the implicit equations, i.e. before each
call to the code declared in the <code>Integrator</code> block, the
stress tensor is automatically computed by the
<code>StandardElasticity</code> brick at <span
class="math inline">\(t+\theta\,\Delta\,t\)</span> using the current
estimate of the elastic increment and the result is stored in the
<code>sig</code> variable.</li>
</ul>
<p>Thus, the evaluation of the implicit equations are mostly a loop over
the slip systems which is meant to update <code>feel</code> and define
the implicit equation for the considered system.</p>
<p>This loop has three main parts:</p>
<ol type="1">
<li>Computing the yield stress by taking into account the contributions
of the other slip systems (see Equation (2)).</li>
<li>Computing the back-strain increment and the back stress using
Equations (5) and (3).</li>
<li>Computing the plastic slip rate using the resolved shear stress (see
Equation (1)).</li>
</ol>
<p>Finally, the implementation of the implicit equations closely mimics
System (6).</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// loop over the slip systems</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">size_type</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">!=</span> Nss<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// isostropic hardening</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> r <span class="op">=</span> tau0<span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_type</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">!=</span> Nss<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      r <span class="op">+=</span> Q <span class="op">*</span> m<span class="op">(</span>i<span class="op">,</span> j<span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="dv">1</span> <span class="op">-</span> exp_bp<span class="op">[</span>j<span class="op">]);</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// back strain increment and kinematic hardening</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> da <span class="op">=</span>  <span class="co">//</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>dg<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> d <span class="op">*</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">]))</span> <span class="op">/</span> <span class="op">(</span><span class="dv">1</span> <span class="op">+</span> theta <span class="op">*</span> d <span class="op">*</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">]));</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> x <span class="op">=</span> C <span class="op">*</span> <span class="op">(</span>a<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> theta <span class="op">*</span> da<span class="op">);</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// resolved shear stress</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> tau <span class="op">=</span> sig <span class="op">|</span> ss<span class="op">.</span>mus<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> f <span class="op">=</span> max<span class="op">(</span>abs<span class="op">(</span>tau <span class="op">-</span> x<span class="op">)</span> <span class="op">-</span> r<span class="op">,</span> stress<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> sgn <span class="op">=</span> tau <span class="op">-</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    fg<span class="op">[</span>i<span class="op">]</span> <span class="op">-=</span> dt <span class="op">*</span> pow<span class="op">(</span>f <span class="op">/</span> K<span class="op">,</span> n<span class="op">)</span> <span class="op">*</span> sgn<span class="op">;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    feel <span class="op">+=</span> dg<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> ss<span class="op">.</span>mus<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="auxiliary-state-variables-update">Auxiliary state variables
update</h2>
<p>Once the Newton-Raphson algorithm converged, one need to update the
auxiliary state variables as follows:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>UpdateAuxiliaryStateVariables <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> <span class="dt">size_type</span> <span class="op">=</span> <span class="dt">unsigned</span> <span class="dt">short</span><span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">size_type</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">!=</span> Nss<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    p<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> da <span class="op">=</span>  <span class="co">//</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>dg<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> d <span class="op">*</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">]))</span> <span class="op">/</span> <span class="op">(</span><span class="dv">1</span> <span class="op">+</span> theta <span class="op">*</span> d <span class="op">*</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">]));</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    a<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> da<span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2
id="improving-the-robustness-of-the-newton-raphson-algorithm">Improving
the robustness of the Newton-Raphson algorithm</h2>
<p>When the Norton exponent <span class="math inline">\(n\)</span> is
reasonnable, the standard Newton-Raphson algorithm works pretty good.
However, in practice, this exponent is usually very high, typically
between <span class="math inline">\(70\)</span> and <span
class="math inline">\(100\)</span> which almost imposes <span
class="math inline">\(f=\left|\tau_e\right|-R_{i}-\tau_0\)</span> to be
equal or lower to <span class="math inline">\(K\)</span>.</p>
<p>One simple trick to handle this condition is to reject Newton steps
that would lead to values of <span class="math inline">\(f\)</span> too
high. This can simply be done by inserting the following test after the
definition of <code>f</code>:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>f <span class="op">&gt;</span> <span class="fl">1.1</span> <span class="op">*</span> K<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h1 id="implementation-with-an-analytical-jacobian">Implementation with
an analytical jacobian</h1>
<p>The implementation of the behaviour with an analytical jacobian is
quite similar.</p>
<h2 id="sec:J">Jacobian</h2>
<p>To solve System (6), one must compute its jacobian <span
class="math inline">\(J\)</span>, which can be decomposed by blocks:</p>
<p><span class="math display">\[
J=
\begin{pmatrix}
{\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{el}}}}{\displaystyle \partial
\Delta\,\underline{\varepsilon}^{\mathrm{el}}}} &amp;
\dots&amp;
{\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{el}}}}{\displaystyle \partial
\Delta\,\gamma_{i}}} &amp;
\dots&amp;
{\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{el}}}}{\displaystyle \partial
\Delta\,\gamma_{j}}} &amp;
\dots \\
\vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\vdots\\
{\displaystyle \frac{\displaystyle \partial
f_{\gamma_{i}}}{\displaystyle \partial
\Delta\,\underline{\varepsilon}^{\mathrm{el}}}} &amp;
\dots&amp;
{\displaystyle \frac{\displaystyle \partial
f_{\gamma_{i}}}{\displaystyle \partial \Delta\,\gamma_{i}}} &amp;
\dots&amp;
{\displaystyle \frac{\displaystyle \partial
f_{\gamma_{i}}}{\displaystyle \partial \Delta\,\gamma_{j}}} &amp;
\dots \\
\vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\vdots\\
{\displaystyle \frac{\displaystyle \partial
f_{\gamma_{j}}}{\displaystyle \partial
\Delta\,\underline{\varepsilon}^{\mathrm{el}}}} &amp;
\dots&amp;
{\displaystyle \frac{\displaystyle \partial
f_{\gamma_{j}}}{\displaystyle \partial \Delta\,\gamma_{i}}} &amp;
\dots&amp;
{\displaystyle \frac{\displaystyle \partial
f_{\gamma_{j}}}{\displaystyle \partial \Delta\,\gamma_{j}}} &amp;
\dots\\
\vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\vdots\\
\end{pmatrix}
\]</span></p>
<p><span class="math inline">\({\displaystyle \frac{\displaystyle
\partial f_{\underline{\varepsilon}^{\mathrm{el}}}}{\displaystyle
\partial \Delta\,\underline{\varepsilon}^{\mathrm{el}}}}\)</span> and
<span class="math inline">\({\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{el}}}}{\displaystyle \partial
\Delta\,\gamma_{i}}}\)</span> are trivial:</p>
<p><span class="math display">\[
\left\{
\begin{aligned}
{\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{el}}}}{\displaystyle \partial
\Delta\,\underline{\varepsilon}^{\mathrm{el}}}}&amp;=\underline{\underline{\mathbf{I}}}\\
{\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{el}}}}{\displaystyle \partial
\Delta\,\gamma_{i}}}&amp;=\underline{m}_{i}\\
{\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{el}}}}{\displaystyle \partial
\Delta\,\gamma_{j}}}&amp;=\underline{m}_{j}\\
\end{aligned}
\right.
\]</span></p>
<p>The other derivatives are tedious to compute, but not really
difficult: <span class="math display">\[
\left\{
\begin{aligned}
{\displaystyle \frac{\displaystyle \partial
f_{\gamma_{i}}}{\displaystyle \partial
\Delta\,\underline{\varepsilon}^{\mathrm{el}}}}
&amp;= -\Delta\,t{\displaystyle \frac{\displaystyle \partial
v}{\displaystyle \partial f}}\,{\displaystyle \frac{\displaystyle
\partial f}{\displaystyle \partial \tau_e}}\,{\displaystyle
\frac{\displaystyle \partial \tau_e}{\displaystyle \partial
{\left.\tau_{i}\right|_{t+\theta\,\Delta\,t}}}}\,{\displaystyle
\frac{\displaystyle \partial
{\left.\tau_{i}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle \partial
{\left.\underline{\sigma}\right|_{t+\theta\,\Delta\,t}}}}\,\colon\,{\displaystyle
\frac{\displaystyle \partial
{\left.\underline{\sigma}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle
\partial
\Delta\,\underline{\varepsilon}^{\mathrm{el}}}}\,\mathop{sgn}{\left(\tau_e\right)}\\
&amp;= -\Delta\,t{\displaystyle \frac{\displaystyle \partial
v}{\displaystyle \partial
f}}\,\theta\,\underline{m}_{i}\,\colon\,\underline{\underline{\mathbf{D}}}\\
{\displaystyle \frac{\displaystyle \partial
f_{\gamma_{i}}}{\displaystyle \partial \Delta\,\gamma_{i}}}
&amp;= 1-\Delta\,t{\displaystyle \frac{\displaystyle \partial
v}{\displaystyle \partial f}}\,
\left[
{\displaystyle \frac{\displaystyle \partial f}{\displaystyle \partial
\tau_e}}\,{\displaystyle \frac{\displaystyle \partial
\tau_e}{\displaystyle \partial
{\left.x_{i}\right|_{t+\theta\,\Delta\,t}}}}\,{\displaystyle
\frac{\displaystyle \partial
{\left.x_{i}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle \partial
{\left.\alpha_{i}\right|_{t+\theta\,\Delta\,t}}}}\,{\displaystyle
\frac{\displaystyle \partial
{\left.\alpha_{i}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle \partial
\Delta\,\alpha_{i}}}\,{\displaystyle \frac{\displaystyle \partial
\Delta\,\alpha_{i}}{\displaystyle \partial \Delta\,\gamma_{i}}}
+
{\displaystyle \frac{\displaystyle \partial f}{\displaystyle \partial
R_{i}}}\,{\displaystyle \frac{\displaystyle \partial
R_{i}}{\displaystyle \partial \Delta\,\gamma_{i}}}
\right]\,\mathop{sgn}{\left(\tau_e\right)}\\
&amp;= 1+\Delta\,t{\displaystyle \frac{\displaystyle \partial
v}{\displaystyle \partial f}}\,
\left[
C\,\theta\,{\displaystyle \frac{\displaystyle \partial
\Delta\,\alpha_{i}}{\displaystyle \partial \Delta\,\gamma_{i}}}
+
\mathop{sgn}{\left(\tau_e\right)}\,{\displaystyle \frac{\displaystyle
\partial R_{i}}{\displaystyle \partial \Delta\,\gamma_{i}}}
\right]\\
{\displaystyle \frac{\displaystyle \partial
f_{\gamma_{i}}}{\displaystyle \partial \Delta\,\gamma_{j}}}
&amp;= \Delta\,t{\displaystyle \frac{\displaystyle \partial
v}{\displaystyle \partial f}}\,{\displaystyle \frac{\displaystyle
\partial R_{i}}{\displaystyle \partial
\Delta\,\gamma_{j}}}\,\mathop{sgn}{\left(\tau_e\right)}
\end{aligned}
\right.
\]</span></p>
<p>with:</p>
<ul>
<li><span class="math inline">\({\displaystyle \frac{\displaystyle
\partial v}{\displaystyle \partial f}}= \left\{ \begin{aligned} 0
&amp;\quad\text{if}\quad&amp;f \leq 0&amp;\\ n \, {{\displaystyle
\frac{\displaystyle v}{\displaystyle f}}}&amp;\quad\text{if}\quad&amp;f
&gt; 0&amp;\\ \end{aligned} \right.\)</span></li>
<li><span class="math inline">\({\displaystyle \frac{\displaystyle
\partial \Delta\,\alpha_{i}}{\displaystyle \partial
\Delta\,\gamma_{i}}}= {{\displaystyle \frac{\displaystyle
1-D\,{\left.\alpha_{i}\right|_{t}}\,\mathop{sgn}{\left(\Delta\,\gamma_{i}\right)}}{\displaystyle
\left(1+D\,\theta\,\mathop{sgn}{\left(\Delta\,\gamma_{i}\right)}\,\Delta\,\gamma_{i}\right)^2}}}\)</span></li>
<li><span class="math inline">\({\displaystyle \frac{\displaystyle
\partial R_{i}}{\displaystyle \partial
\Delta\,\gamma_{j}}}=Q\,h_{ij}\,b\,\exp{\left(-b\,{\left.p_{j}\right|_{t+\theta\,\Delta\,t}}\right)}\,\theta\,\mathop{sgn}{\left(\Delta\,\gamma_{j}\right)}\)</span></li>
<li><span class="math inline">\({\displaystyle \frac{\displaystyle
\partial R_{i}}{\displaystyle \partial
\Delta\,\gamma_{i}}}=Q\,h_{ii}\,b\,\exp{\left(-b\,{\left.p_{i}\right|_{t+\theta\,\Delta\,t}}\right)}\,\theta\,\mathop{sgn}{\left(\Delta\,\gamma_{i}\right)}\)</span></li>
</ul>
<h2 id="modification-of-the-previous-implementation">Modification of the
previous implementation</h2>
<p>From the previous file, one must:</p>
<ul>
<li>change the name of the behaviour.</li>
<li>change the name of the classe containing the slip systems to reflect
the change of name of the behaviour.</li>
<li>change the name of the algorithm (or simply remove the associated
line as the Newton-Raphson algorithm with analytical jacobian is the
default algorithm) and remove the definition of the perturbation
value.</li>
<li>change the implementation of the <code>@Integrator</code> block to
add the computation of the jacobian blocks.</li>
</ul>
<p>Again, it is important to recall the convention of the
<code>Implicit</code> DSL concerning the initialization of the jacobian
is to set it to identity.</p>
<p>The new <code>@Integrator</code> block is now:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Integrator <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> <span class="dt">size_type</span> <span class="op">=</span> <span class="dt">unsigned</span> <span class="dt">short</span><span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> eeps <span class="op">=</span> <span class="fl">1.e-12</span><span class="op">;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> seps <span class="op">=</span> eeps <span class="op">*</span> D<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> ss <span class="op">=</span> <span class="co">//</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>      MericCailletaudSingleCrystalViscoPlasticitySlipSystems<span class="op">&lt;</span>real<span class="op">&gt;::</span>getSlipSystems<span class="op">();</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> m <span class="op">=</span> ss<span class="op">.</span>him<span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  real exp_bp<span class="op">[</span>Nss<span class="op">];</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">size_type</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">!=</span> Nss<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">const</span> <span class="kw">auto</span> <span class="va">p_</span> <span class="op">=</span> p<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> theta <span class="op">*</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>      exp_bp<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> exp<span class="op">(-</span>b <span class="op">*</span> <span class="va">p_</span><span class="op">);</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">size_type</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">!=</span> Nss<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> tau <span class="op">=</span> sig <span class="op">|</span> ss<span class="op">.</span>mus<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> r <span class="op">=</span> tau0<span class="op">;</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_type</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">!=</span> Nss<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>      r <span class="op">+=</span> Q <span class="op">*</span> m<span class="op">(</span>i<span class="op">,</span> j<span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="dv">1</span> <span class="op">-</span> exp_bp<span class="op">[</span>j<span class="op">]);</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> da <span class="op">=</span>  <span class="co">//</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>dg<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> d <span class="op">*</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">]))</span> <span class="op">/</span> <span class="op">(</span><span class="dv">1</span> <span class="op">+</span> theta <span class="op">*</span> d <span class="op">*</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">]));</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> x <span class="op">=</span> C <span class="op">*</span> <span class="op">(</span>a<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> theta <span class="op">*</span> da<span class="op">);</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> f <span class="op">=</span> max<span class="op">(</span>abs<span class="op">(</span>tau <span class="op">-</span> x<span class="op">)</span> <span class="op">-</span> r<span class="op">,</span> stress<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>f <span class="op">&gt;</span> <span class="fl">1.1</span> <span class="op">*</span> K<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> sgn <span class="op">=</span> tau <span class="op">-</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// elasticity</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    feel <span class="op">+=</span> dg<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> ss<span class="op">.</span>mus<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    dfeel_ddg<span class="op">(</span>i<span class="op">)</span> <span class="op">=</span> ss<span class="op">.</span>mus<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// viscoplasticity</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> v <span class="op">=</span> pow<span class="op">(</span>f <span class="op">/</span> K<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> dv <span class="op">=</span> n <span class="op">*</span> v <span class="op">/</span> <span class="op">(</span>max<span class="op">(</span>f<span class="op">,</span> seps<span class="op">));</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    fg<span class="op">[</span>i<span class="op">]</span> <span class="op">-=</span> dt <span class="op">*</span> pow<span class="op">(</span>f <span class="op">/</span> K<span class="op">,</span> n<span class="op">)</span> <span class="op">*</span> sgn<span class="op">;</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    dfg_ddeel<span class="op">(</span>i<span class="op">)</span> <span class="op">=</span> <span class="op">-</span>dt <span class="op">*</span> dv <span class="op">*</span> <span class="op">(</span>ss<span class="op">.</span>mus<span class="op">[</span>i<span class="op">]</span> <span class="op">|</span> D<span class="op">);</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> sgn_gi <span class="op">=</span> dg<span class="op">(</span>i<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> dda_ddg <span class="op">=</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span><span class="dv">1</span> <span class="op">-</span> d <span class="op">*</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> sgn_gi<span class="op">)</span> <span class="op">/</span> <span class="op">(</span>power<span class="op">&lt;</span><span class="dv">2</span><span class="op">&gt;(</span><span class="dv">1</span> <span class="op">+</span> theta <span class="op">*</span> d <span class="op">*</span> abs<span class="op">(</span>dg<span class="op">[</span>i<span class="op">])));</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    dfg_ddg<span class="op">(</span>i<span class="op">,</span> i<span class="op">)</span> <span class="op">+=</span> dt <span class="op">*</span> dv <span class="op">*</span> C <span class="op">*</span> theta <span class="op">*</span> dda_ddg<span class="op">;</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_type</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">!=</span> Nss<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">const</span> <span class="kw">auto</span> sgn_gj <span class="op">=</span> dg<span class="op">(</span>j<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">const</span> <span class="kw">auto</span> dr <span class="op">=</span> Q <span class="op">*</span> m<span class="op">(</span>i<span class="op">,</span> j<span class="op">)</span> <span class="op">*</span> theta <span class="op">*</span> b <span class="op">*</span> exp_bp<span class="op">[</span>j<span class="op">]</span> <span class="op">*</span> sgn_gj<span class="op">;</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>      dfg_ddg<span class="op">(</span>i<span class="op">,</span> j<span class="op">)</span> <span class="op">+=</span> dt <span class="op">*</span> dv <span class="op">*</span> dr <span class="op">*</span> sgn<span class="op">;</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="benchmarks">Benchmarks</h2>
<div id="tbl:analytical_jacobian">
<table>
<caption>Table 1: Results of MericCailletaudSingleCrystalViscoPlasticity
profiling : 8msecs 600musecs 753nsecs</caption>
<colgroup>
<col style="width: 48%" />
<col style="width: 51%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: center;">Integrator</td>
<td style="text-align: center;">8msecs 82musecs 148nsecs (8082148
ns)</td>
</tr>
<tr class="even">
<td
style="text-align: center;">Integrator::ComputeThermodynamicForces</td>
<td style="text-align: center;">512musecs 422nsecs (512422 ns)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Integrator::ComputeFdF</td>
<td style="text-align: center;">2msecs 177musecs 565nsecs (2177565
ns)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Integrator::TinyMatrixSolve</td>
<td style="text-align: center;">3msecs 846musecs 171nsecs (3846171
ns)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ComputeFinalThermodynamicForces</td>
<td style="text-align: center;">25musecs 395nsecs (25395 ns)</td>
</tr>
<tr class="even">
<td style="text-align: center;">ComputeTangentOperator</td>
<td style="text-align: center;">334musecs 361nsecs (334361 ns)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">UpdateAuxiliaryStateVariables</td>
<td style="text-align: center;">23musecs 852nsecs (23852 ns)</td>
</tr>
</tbody>
</table>
</div>
<div id="tbl:numerical_jacobian">
<table>
<caption>Table 2: Results of
MericCailletaudSingleCrystalViscoPlasticityNumericalJacobian profiling :
69msecs 631musecs 952nsecs</caption>
<colgroup>
<col style="width: 48%" />
<col style="width: 51%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: center;">Integrator</td>
<td style="text-align: center;">69msecs 277musecs 664nsecs (69277664
ns)</td>
</tr>
<tr class="even">
<td
style="text-align: center;">Integrator::ComputeThermodynamicForces</td>
<td style="text-align: center;">12msecs 83musecs 980nsecs (12083980
ns)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Integrator::ComputeFdF</td>
<td style="text-align: center;">30msecs 512musecs 471nsecs (30512471
ns)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Integrator::TinyMatrixSolve</td>
<td style="text-align: center;">2msecs 538musecs 618nsecs (2538618
ns)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ComputeFinalThermodynamicForces</td>
<td style="text-align: center;">16musecs 989nsecs (16989 ns)</td>
</tr>
<tr class="even">
<td style="text-align: center;">ComputeTangentOperator</td>
<td style="text-align: center;">225musecs 267nsecs (225267 ns)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">UpdateAuxiliaryStateVariables</td>
<td style="text-align: center;">15musecs 801nsecs (15801 ns)</td>
</tr>
</tbody>
</table>
</div>
<h1 id="extenstion-to-finite-strain">Extenstion to finite strain</h1>
<p>To extend the implementation to finite strain, we will use the
<code>FiniteStrainSingleCrystal</code> brick which is described <a
href="finitestrainsinglecrystal.html">here</a>.</p>
<p>In pratice, thanks to this brick, only a very limited number of
changes are required:</p>
<ul>
<li><p>The name of DSL must changed to
<code>ImplicitFiniteStrainDSL</code>.</p></li>
<li><p>The <code>StandardElasticity</code> brick must be changed in
<code>FiniteStrainSingleCrystal</code>.</p></li>
<li><p>The declaration of the the plastic slips must be removed, they
are declared as state variables by the brick.</p></li>
<li><p>The declaration of the variable <code>ss</code> must be removed
as it is automatically declared by the brick.</p></li>
<li><p>The definition of the resolved shear stress must be changed
to:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="kw">auto</span> tau <span class="op">=</span> M <span class="op">|</span> ss<span class="op">.</span>mu<span class="op">[</span>i<span class="op">];</span></span></code></pre></div>
<p>where <code>M</code> is the (unsymmetric) Mandel stress tensor and
<code>ss.mu</code> are an array that contains the (unsymmetric)
orientation tensors. <code>M</code> is automatically computed by the
<code>FiniteStrainSingleCrystal</code> brick.</p></li>
<li><p>The update of the implicit equation associated with the elastic
strain must be removed. This is handled by the
<code>FiniteStrainSingleCrystal</code> brick.</p></li>
<li><p>The derivative of the implicit equations associated with the
plastic slips with respect the the elastic strain must be changed as
follows:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dfg_ddeel<span class="op">(</span>i<span class="op">)</span> <span class="op">=</span> <span class="op">-</span>dt <span class="op">*</span> dv <span class="op">*</span> theta <span class="op">*</span> <span class="op">(</span>ss<span class="op">.</span>mu<span class="op">[</span>i<span class="op">]</span> <span class="op">|</span> dM_ddeel<span class="op">);</span></span></code></pre></div>
<p>where <code>dM_ddeel</code> stands for the derivative of the Mandel
stress with respect to the elastic strain. <code>dM_ddeel</code> is
automatically computed by the brick.</p></li>
</ul>
<h1 id="applications">Applications</h1>
<figure id="fig:single_crystal:Berkovich_indentation">
<img src="img/MericCailletaudFiniteStrainResidualTopography.png"
style="width:75.0%"
alt="Simulated residual topography after a Berkovich indentation test in a single crystal. The values are normalized by the residual indentation depth h_{r}" />
<figcaption>Figure 1: Simulated residual topography after a Berkovich
indentation test in a single crystal. The values are normalized by the
residual indentation depth <span
class="math inline">\(h_{r}\)</span></figcaption>
</figure>
<p>This study has been conducted as part of the the PhD thesis of
A.Bourceret (FEMTO) supervised by A.Lejeune, Y.Gaillard and F.Richard
(FEMTO). It deals with the modelling of a Berkovich nanoindentation test
on a copper sample which is described by the Meric-Cailletaud single
crystal law at finite strain.</p>
<p>The imposed displacement of the berkovich indenter to a maximum value
of <span class="math inline">\(500\,nm\)</span>. For this simulation the
material parameters identified copper by Méric et al were used <span
class="citation" data-cites="meric_single_1991">[<a
href="#ref-meric_single_1991" role="doc-biblioref">1</a>]</span>.</p>
<p>The finite element model based contains <span
class="math inline">\(4.10^4\)</span> elements for the geometric
description of the copper sample and the Berkovich indenter. This model
is treated by the Ansys finite element solver. The results of this
simulation are reported on Figure 1 which represents the simulated
residual topography.</p>
<h1 id="usage-in-code_aster">Usage in <code>code_aster</code></h1>
<p>Based on this tutorial, Nicolò Grilli (University of Bristol)
published a series of three videos showing in details how to make single
and polycrystal simulations with <code>MFront</code> and
<code>code_aster</code>:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=GXVZwzprhBI"
class="uri">https://www.youtube.com/watch?v=GXVZwzprhBI</a></li>
<li><a href="https://www.youtube.com/watch?v=evNhkEcntaU"
class="uri">https://www.youtube.com/watch?v=evNhkEcntaU</a></li>
<li><a href="https://www.youtube.com/watch?v=OAnJmMTGhE4"
class="uri">https://www.youtube.com/watch?v=OAnJmMTGhE4</a></li>
</ul>
<p>The series adresses several advanced topics regarding the interface
between code_ater and MFront:</p>
<ul>
<li>handling orthotropy,</li>
<li>postprocessing of the internal state variables,</li>
<li>etc…</li>
</ul>
<p>which can be very handy for a lot of users.</p>
<h1 class="unnumbered" id="references">References</h1>
<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-meric_single_1991" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div
class="csl-right-inline"><span class="smallcaps">Méric</span>, L. and
<span class="smallcaps">Cailletaud</span>, Georges. Single crystal
modelling for structural calculations. <em>Journal of Engineering
Material and Technology</em>. January 1991. Vol. 113, p. 171–182. </div>
</div>
</div>
<aside id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>The trace of <span
class="math inline">\(\underline{m}_{i}\)</span> is proportional to
<span class="math inline">\(\vec{n}_{i}\,\cdot\,\vec{b}_{i}\)</span><a
href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-62273823-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
