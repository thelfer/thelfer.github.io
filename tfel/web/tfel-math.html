

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-EN" xml:lang="en-EN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Overview of some features of the TFEL/Math library</title>
        <meta name="author" content="Thomas Helfer" />
            <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <style type="text/css">code{white-space: pre;}</style>
            <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {  background-color: #f8f8f8; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ef2929; } /* Alert */
      code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #204a87; } /* Attribute */
      code span.bn { color: #0000cf; } /* BaseN */
      code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4e9a06; } /* Char */
      code span.cn { color: #8f5902; } /* Constant */
      code span.co { color: #8f5902; font-style: italic; } /* Comment */
      code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
      code span.dt { color: #204a87; } /* DataType */
      code span.dv { color: #0000cf; } /* DecVal */
      code span.er { color: #a40000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #0000cf; } /* Float */
      code span.fu { color: #204a87; font-weight: bold; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
      code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
      code span.ot { color: #8f5902; } /* Other */
      code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
      code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
      code span.ss { color: #4e9a06; } /* SpecialString */
      code span.st { color: #4e9a06; } /* String */
      code span.va { color: #000000; } /* Variable */
      code span.vs { color: #4e9a06; } /* VerbatimString */
      code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
            <link rel="stylesheet" href="css/normalize.css"/>
    <link rel="stylesheet" href="css/main.css"/>
        <script
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
        type="text/javascript"></script>
            
      </head>
  <body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
        <header>
      <ul id="nav">
	<li><a href="news.html">News</a></li>
	<li><a href="index.html">Overview</a>
	  <ul>
	    <li><a>Domain specific languages</a>
	      <ul>
		<li><a href="material-properties.html">Material properties</a></li>
		<li><a href="behaviours.html">Mechanical behaviours</a></li>
		<li><a href="models.html">Models</a></li>
	      </ul>
            </li>
	    <li><a href="interfaces.html">Available interfaces</a></li>
	    <li><a href="associated-projects.html">Associated projects</a></li>
     	    <li><a>Tools</a>
	      <ul>
	        <li><a href="mfront-doc.html">mfront-doc</a></li>
	        <li><a href="mtest.html">mtest</a></li>
	        <ul>
	        <li><a href="mtest-nonlinear-constraints.html">Nonlinear constraints</a></li>
	        </ul>
	        <li><a href="mfm.html">mfm</a></li>
	        <li><a href="mfm-test-generator.html">mfm-test-generator</a></li>
	        <li><a href="tfel-check.html">tfel-check</a></li>
	      </ul>
	    </li>
	  </ul>
	</li>
	<li><a>Getting started</a>
	  <ul>
	    <li><a href="https://github.com/thelfer/tfel/">Github repository</a></li>
	    <li><a href="https://github.com/thelfer/tfel/releases">Download</a></li>
	    <li><a href="release-notes.html">Release notes</a>
	      <ul>
		<li><a>Versions 2.0.x</a>
                  <ul>
                    <li><a href="release-notes.html">Versions prior to 2.0.5</a></li>
	 	    <li><a href="release-notes-2.0.5.html">Version 2.0.5</a></li>
                  </ul>
		</li>
		<li><a>Versions 3.0.x</a>
                  <ul>
		    <li><a href="release-notes-3.0.html">Version 3.0.0</a></li>
		    <li><a href="release-notes-3.0.1.html">Version 3.0.1</a></li>
		    <li><a href="release-notes-3.0.2.html">Version 3.0.2</a></li>
		    <li><a href="release-notes-3.0.3.html">Version 3.0.3</a></li>
		    <li><a href="release-notes-3.0.4.html">Version 3.0.4</a></li>
		    <li><a href="release-notes-3.0.5.html">Version 3.0.5</a></li>
		    <li><a href="release-notes-3.0.6.html">Version 3.0.6</a></li>
		    <li><a href="release-notes-3.0.7.html">Version 3.0.7</a></li>
		    <li><a href="release-notes-3.0.8.html">Version 3.0.8</a></li>
		    <li><a href="release-notes-3.0.9.html">Version 3.0.9</a></li>
		    <li><a href="release-notes-3.0.10.html">Version 3.0.10</a></li>
		    <li><a href="release-notes-3.0.11.html">Version 3.0.11</a></li>
		    <li><a href="release-notes-3.0.12.html">Version 3.0.12</a></li>
		    <li><a href="release-notes-3.0.13.html">Version 3.0.13</a></li>
		    <li><a href="release-notes-3.0.14.html">Version 3.0.14</a></li>
		    <li><a href="release-notes-3.0.15.html">Version 3.0.15</a></li>
		    <li><a href="release-notes-3.0.16.html">Version 3.0.16</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.1.x</a>
		  <ul>
		    <li><a href="release-notes-3.1.html">Version 3.1.0</a></li>
		    <li><a href="release-notes-3.1.1.html">Version 3.1.1</a></li>
		    <li><a href="release-notes-3.1.2.html">Version 3.1.2</a></li>
		    <li><a href="release-notes-3.1.3.html">Version 3.1.3</a></li>
		    <li><a href="release-notes-3.1.4.html">Version 3.1.4</a></li>
		    <li><a href="release-notes-3.1.5.html">Version 3.1.5</a></li>
		    <li><a href="release-notes-3.1.6.html">Version 3.1.6</a></li>
		    <li><a href="release-notes-3.1.7.html">Version 3.1.7</a></li>
		    <li><a href="release-notes-3.1.8.html">Version 3.1.8</a></li>
		    <li><a href="release-notes-3.1.9.html">Version 3.1.9</a></li>
		    <li><a href="release-notes-3.1.10.html">Version 3.1.10</a></li>
		    <li><a href="release-notes-3.1.11.html">Version 3.1.11</a></li>
		    <li><a href="release-notes-3.1.12.html">Version 3.1.12</a></li>
		    <li><a href="release-notes-3.1.13.html">Version 3.1.13</a></li>
		    <li><a href="release-notes-3.1.14.html">Version 3.1.14</a></li>
		    <li><a href="release-notes-3.1.15.html">Version 3.1.15</a></li>
		    <li><a href="release-notes-3.1.16.html">Version 3.1.16</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.2.x</a>
		  <ul>
		    <li><a href="release-notes-3.2.html">Version 3.2.0</a></li>
		    <li><a href="release-notes-3.2.1.html">Version 3.2.1</a></li>
		    <li><a href="release-notes-3.2.2.html">Version 3.2.2</a></li>
		    <li><a href="release-notes-3.2.3.html">Version 3.2.3</a></li>
		    <li><a href="release-notes-3.2.4.html">Version 3.2.4</a></li>
		    <li><a href="release-notes-3.2.5.html">Version 3.2.5</a></li>
		    <li><a href="release-notes-3.2.6.html">Version 3.2.6</a></li>
		    <li><a href="release-notes-3.2.7.html">Version 3.2.7</a></li>
		    <li><a href="release-notes-3.2.8.html">Version 3.2.8</a></li>
		    <li><a href="release-notes-3.2.9.html">Version 3.2.9</a></li>
		    <li><a href="release-notes-3.2.10.html">Version 3.2.10</a></li>
		    <li><a href="release-notes-3.2.11.html">Version 3.2.11</a></li>
		    <li><a href="release-notes-3.2.12.html">Version 3.2.12</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.3.x</a>
		  <ul>
		    <li><a href="release-notes-3.3.html">Version 3.3.0</a></li>
		    <li><a href="release-notes-3.3.1.html">Version 3.3.1</a></li>
		    <li><a href="release-notes-3.3.1.html">Version 3.3.2</a></li>
		    <li><a href="release-notes-3.3.2.html">Version 3.3.2</a></li>
		    <li><a href="release-notes-3.3.3.html">Version 3.3.3</a></li>
		    <li><a href="release-notes-3.3.4.html">Version 3.3.4</a></li>
		    <li><a href="release-notes-3.3.5.html">Version 3.3.5</a></li>
		    <li><a href="release-notes-3.3.6.html">Version 3.3.6</a></li>
		    <li><a href="release-notes-3.3.7.html">Version 3.3.7</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.4.x</a>
		  <ul>
		    <li><a href="release-notes-3.4.html">Version 3.4.0</a></li>
		    <li><a href="release-notes-3.4.1.html">Version 3.4.1</a></li>
		    <li><a href="release-notes-3.4.2.html">Version 3.4.2</a></li>
		    <li><a href="release-notes-3.4.3.html">Version 3.4.3</a></li>
		    <li><a href="release-notes-3.4.4.html">Version 3.4.4</a></li>
		    <li><a href="release-notes-3.4.5.html">Version 3.4.5</a></li>
		    <li><a href="release-notes-3.4.6.html">Version 3.4.6</a></li>
		    <li><a href="release-notes-3.4.7.html">Version 3.4.7</a></li>
		    <li><a href="release-notes-3.4.8.html">Version 3.4.8</a></li>
		    <li><a href="release-notes-3.4.9.html">Version 3.4.9</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.0.x</a>
		  <ul>
		    <li><a href="release-notes-4.0.html">Version 4.0.0</a></li>
		    <li><a href="release-notes-4.0.1.html">Version 4.0.1</a></li>
		    <li><a href="release-notes-4.0.2.html">Version 4.0.2</a></li>
		    <li><a href="release-notes-4.0.3.html">Version 4.0.3</a></li>
		    <li><a href="release-notes-4.0.4.html">Version 4.0.4</a></li>
		    <li><a href="release-notes-4.0.5.html">Version 4.0.5</a></li>
		    <li><a href="release-notes-4.0.6.html">Version 4.0.6</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.1.x</a>
		  <ul>
		    <li><a href="release-notes-4.1.html">Version 4.1.0</a></li>
		    <li><a href="release-notes-4.1.1.html">Version 4.1.1</a></li>
		    <li><a href="release-notes-4.1.2.html">Version 4.1.2</a></li>
		    <li><a href="release-notes-4.1.3.html">Version 4.1.3</a></li>
		    <li><a href="release-notes-4.1.4.html">Version 4.1.4</a></li>
		    <li><a href="release-notes-4.1.5.html">Version 4.1.5</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.2.x</a>
		  <ul>
		    <li><a href="release-notes-4.2.html">Version 4.2.0</a></li>
		    <li><a href="release-notes-4.2.1.html">Version 4.2.1</a></li>
		    <li><a href="release-notes-4.2.2.html">Version 4.2.2</a></li>
		    <li><a href="release-notes-4.2.3.html">Version 4.2.3</a></li>
		  </ul>
		</li>
		<li><a>Versions 5.0.x</a>
		  <ul>
		    <li><a href="release-notes-5.0.html">Version 5.0.0</a></li>
		    <li><a href="release-notes-5.0.1.html">Version 5.0.1</a></li>
		    <li><a href="release-notes-5.0.2.html">Version 5.0.2</a></li>
		  </ul>
		</li>
		<li><a>Versions 5.1.x</a>
		  <ul>
		    <li><a href="release-notes-5.1.html">Version 5.1.0</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a href="coverity-scan.html">Coverity scan</a></li>
	    <li><a href="install.html">Installation</a></li>
	  </ul>
	</li>
	<li><a>Documentation</a>
	  <ul>
	    <li><a href="documentations.html">General documentation</a></li>
	    <li><a href="gallery.html">Gallery</a></li>
<!--	    
	    <li><a href="http://tfel.sourceforge.net/doxygen/index.html">Doxygen documentation</a></li>
-->
	    <li><a>Behaviours</a>
	      <ul>
		<li><a href="tutorial.html">Tutorial</a></li>
		<li><a href="implicit-dsl.html">The Implicit DSL</a></li>
		<li><a href="benchmark.html">Benchmark</a></li>
		<li><a href="parameters.html">Parameters</a></li>
		<li><a href="BehaviourBricks.html">Behaviour bricks</a></li>
		<li><a href="interfaces.html">Solver interfaces</a>
		  <ul>
		    <li><a href="castem.html">Cast3M</a></li>
		    <li><a href="amitex.html">AMITEX_FFTP</a></li>
		    <li><a href="aster.html">Code-Aster</a></li>
    		    <li><a href="abaqus.html">Abaqus</a></li>
		    <li><a href="zmat.html">ZeBuLoN</a></li>
   		    <li><a href="calculix.html">CalculiX</a></li>
		    <!-- <li><a >TMFFT</a></li> -->
		    <li><a href="cyrano.html">Cyrano</a></li>
   		    <li><a href="generic-material-property-interface.html">Generic interface for material properties</a></li>
   		    <li><a href="generic-behaviours-interface.html">Generic interface for behaviours</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a>TFEL libraries</a>
	      <ul>
		<li><a href="libraries_usage.html">Usage of the TFEL libraries in C++</a></li>
		<li><a href="tfel-math.html">TFEL/Math</a></li>
		<li><a href="tfel-material.html">TFEL/Material</a></li>
		<li><a href="tfel-mfront-database.html">TFELMFrontDatabase</a></li>
	      </ul>
	    </li>
	    <li><a>Python modules</a>
	      <ul>
		<li><a href="tfel-python.html">TFEL modules</a></li>
		<li><a href="mfront-python.html">mfront module</a></li>
		<li><a href="mtest-python.html">mtest module</a></li>
	      </ul>
	    </li>
	    <li><a>MFront keywords</a>
	      <ul>
	        <li><a href="Default-keywords.html">Default</a></li>
	        <li><a href="DefaultCZM-keywords.html">DefaultCZM</a></li>
	        <li><a href="DefaultFiniteStrain-keywords.html">DefaultFiniteStrain</a></li>
	        <li><a href="DefaultGenericBehaviour-keywords.html">DefaultGenericBehaviour</a></li>
	        <li><a href="DefaultModel-keywords.html">DefaultModel</a></li>
	        <li><a href="Implicit-keywords.html">Implicit</a></li>
	        <li><a href="ImplicitCZM-keywords.html">ImplicitCZM</a></li>
	        <li><a href="ImplicitFiniteStrain-keywords.html">ImplicitFiniteStrain</a></li>
	        <li><a href="ImplicitGenericBehaviour-keywords.html">ImplicitGenericBehaviour</a></li>
	        <li><a href="ImplicitModel-keywords.html">ImplicitModel</a></li>
	        <li><a href="ImplicitII-keywords.html">ImplicitII</a></li>
	        <li><a href="IsotropicMisesCreep-keywords.html">IsotropicMisesCreep</a></li>
	        <li><a href="IsotropicMisesPlasticFlow-keywords.html">IsotropicMisesPlasticFlow</a></li>
	        <li><a href="IsotropicPlasticMisesFlow-keywords.html">IsotropicPlasticMisesFlow</a></li>
	        <li><a href="IsotropicStrainHardeningMisesCreep-keywords.html">IsotropicStrainHardeningMisesCreep</a></li>
	        <li><a href="MaterialLaw-keywords.html">MaterialLaw</a></li>
	        <li><a href="MaterialProperty-keywords.html">MaterialProperty</a></li>
	        <li><a href="Model-keywords.html">Model</a></li>
	        <li><a href="MultipleIsotropicMisesFlows-keywords.html">MultipleIsotropicMisesFlows</a></li>
	        <li><a href="RungeKutta-keywords.html">RungeKutta</a></li>
	        <li><a href="RungeKuttaFiniteStrain-keywords.html">RungeKuttaFiniteStrain</a></li>
	        <li><a href="RungeKuttaGenericBehaviour-keywords.html">RungeKuttaGenericBehaviour</a></li>
	        <li><a href="RungeKuttaModel-keywords.html">RungeKuttaModel</a></li>
	      </ul>
	    </li>
	    <li><a href="MTest-keywords.html">MTest keywords</a></li>
	    <li><a href="physical-constants.html">Physical constants</a></li>
	    <li><a href="glossary.html">Glossary</a></li>
	    <li><a href="publications.html">Publications</a></li>
	    <li><a href="faq.html">FAQ</a></li>
	    <li><a href="about.html">About</a></li>
	  </ul>
	</li>
	<li><a>Contributing</a>
	  <ul>
	    <li><a href="https://github.com/thelfer/tfel">Access to sources</a></li>
	    <li><a href="contributing.html">Contributing guidelines</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Report bugs</a></li>
	  </ul>
	</li>
	<li><a>Getting Help</a>
	  <ul>
	    <li><a href="search.html">Search on this site</a></li>
	    <li><a href="https://github.com/thelfer/tfel/discussions">Forum</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Bug report</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Feature request</a></li>
	    <li><a href="mailto:tfel-contact@cea.fr">Contact</a></li>
	  </ul>
	</li>
      </ul>
    </header>
<div id="header">
<h1 class="title">Overview of some features of the
<code>TFEL/Math</code> library</h1>
<h2 class="author">Thomas Helfer</h2>
<h3 class="date">21/11/2017</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#sec:tfel_math:math_objects"
id="toc-sec:tfel_math:math_objects"><span
class="toc-section-number">1</span> Mathematical objects</a>
<ul>
<li><a href="#sec:tfel_math:quantities"
id="toc-sec:tfel_math:quantities"><span
class="toc-section-number">1.1</span> Quantities</a></li>
<li><a href="#sec:tfel_math:tensorial_objects"
id="toc-sec:tfel_math:tensorial_objects"><span
class="toc-section-number">1.2</span> A generic framework to build
tensorial-like objects</a></li>
<li><a href="#sec:tfel_math:indexing_policies"
id="toc-sec:tfel_math:indexing_policies"><span
class="toc-section-number">1.3</span> Description of the
<code>IndexingPolicy</code> concept</a></li>
<li><a href="#low-rank-mathematical-objects"
id="toc-low-rank-mathematical-objects"><span
class="toc-section-number">1.4</span> Low rank mathematical
objects</a></li>
<li><a href="#higher-order-objects-defined-as-derivatives"
id="toc-higher-order-objects-defined-as-derivatives"><span
class="toc-section-number">1.5</span> Higher order objects defined as
derivatives</a></li>
<li><a href="#sec:tfel_math:expression_templates"
id="toc-sec:tfel_math:expression_templates"><span
class="toc-section-number">1.6</span> Expressions templates</a></li>
<li><a href="#sec:tfel_math:views" id="toc-sec:tfel_math:views"><span
class="toc-section-number">1.7</span> Views</a></li>
</ul></li>
<li><a href="#sec:tfel_math:non_linear_solvers"
id="toc-sec:tfel_math:non_linear_solvers"><span
class="toc-section-number">2</span> Solvers for fixed size non-linear
systems</a>
<ul>
<li><a href="#the-tinynonlinearsolverbase-class"
id="toc-the-tinynonlinearsolverbase-class"><span
class="toc-section-number">2.1</span> The
<code>TinyNonLinearSolverBase</code> class</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>
<p>This overview of the <code>TFEL/Math</code> library mostly focuses on
two important features:</p>
<ul>
<li>The <code>TFEL/Math</code> library provides a linear algebra engine
with mathematical objects and operations on those objets required to
express the constitutive equations in an efficient and natural manner,
i.e. as close as possible to the mathematical expressions. Section 1 is
devoted to describe this linear algebra engine.</li>
<li>The <code>TFEL/Math</code> library provides efficient and robust
non-linear solvers for small sized problems described in Section 2.</li>
</ul>
<p>This features are described in this document. Other modules of the
library are described in the following pages:</p>
<ul>
<li><a href="tfel-math-data-interpolation.html">data
interpolation</a>,</li>
<li><a href="tfel-math-numerical-integration.html">numerical
integration</a>.</li>
</ul>
<h1 data-number="1" id="sec:tfel_math:math_objects"><span
class="header-section-number">1</span> Mathematical objects</h1>
<p>The mathematical objects provided by the <code>TFEL/Math</code>
library are based on scalar values which can be standard
<code>C++</code> numeric types (<code>float</code>, <code>double</code>
or <code>long double</code>), or so-called quantities, i.e. an object
describing a value with a unit. The latter allows to distinguish
physical quantities such as a strain from a stress and prevent illegal
operations between them. Quantities are described in depth in Section
1.1.</p>
<p>The <code>TFEL/Math</code> library then introduces some mathematical
objects of rank 1, i.e. objects which can be stored in a contiguous
memory location and access by a single index, such as:</p>
<ul>
<li>fixed size vectors (implemented by the <code>tvector</code>
class)</li>
<li>symmetric tensors (implemented by the <code>stensor</code>
class)</li>
<li>unsymmetric tensors (implemented by the <code>tensor</code>
class)</li>
</ul>
<p>Higher order objects are then defined as the derivatives of objects
of lower ranks. For instance, the derivative of a symmetric tensor with
respect to an unsymmetric tensor is implemented by the
<code>t2tost2</code> class. The latter can also be viewed a linear
application between unsymmetric tensor and symmetric tensor or as a
fourth order tensor. In practice, there are four kind of fourth order
tensor defined in the library respectively implemented by the
<code>st2tost2</code>, <code>st2tot2</code>, <code>t2tost2</code>, and
<code>t2tot2</code> classes.</p>
<p>Currently only tensors up to the fourth order are specialized which
allows to provide some specific features.</p>
<p>Higher order tensors may be represented by a generic class which
represent derivatives of two mathematical objects. Currently, the number
of operations allowed by this generic class is rather limited and will
be extended as needed in future versions.</p>
<p>The main concepts behind the implementation of the mathematical
objects are described in Section 1.2.</p>
<h2 data-number="1.1" id="sec:tfel_math:quantities"><span
class="header-section-number">1.1</span> Quantities</h2>
<p>Quantities were introduced in <code>TFEL/Math</code> following ideas
of the book D. Abrahams and A. Gurstovoy <span class="citation"
data-cites="abrahams_cxx_2004">[<a href="#ref-abrahams_cxx_2004"
role="doc-biblioref">1</a>]</span> to allow dimensional analysis at
compile time. Basically, a quantity is the combination of a value and a
unit. The type of the value is called the base type of the quantity.</p>
<p>The unit is encrypted in a type called <code>Unit</code> so that the
<code>C++</code> type-system can be used to detect at compile-time
(without runtime-checks) if operations are legal. According to the
International System of Units (SI), a unit is decomposed along <span
class="math inline">\(7\)</span> basic units which are the mass (kg),
the length (l), the time (s), the electric current (A), the temperature
(K), the luminous intensity (cd) and the amount of substance (mole). To
be able to describe fractional unit, such as the fracture toughness
which is has the unit of a stress times the square root of a length, the
<code>Unit</code> class is parametrized by <span
class="math inline">\(14\)</span> integers. The <code>TFEL/Math</code>
library provides some convenient aliases for the most common units.</p>
<p>The <code>NoUnit</code> unit is a special case where all those
integers are set to 0 for the numerator parts and 1 (by convention) for
the denominator parts.</p>
<h3 data-number="1.1.1" id="the-qt-class"><span
class="header-section-number">1.1.1</span> The <code>qt</code>
class</h3>
<p>A quantity is presented by the <code>qt</code> class which is
parametrized by a class describing the unit and a numeric base type
(generally <code>float</code>, <code>double</code> or
<code>long double</code>) which stores the value of the quantity. By
default, the <code>double</code> type is used. This class can be used as
follows:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> qt<span class="op">&lt;</span>Mass<span class="op">&gt;</span> m1<span class="op">(</span><span class="fl">100.</span><span class="op">);</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> qt<span class="op">&lt;</span>Mass<span class="op">&gt;</span> m2<span class="op">(</span><span class="fl">100.</span><span class="op">);</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> qt<span class="op">&lt;</span>Mass<span class="op">&gt;</span> m3 <span class="op">=</span> m1 <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> m2<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> qt<span class="op">&lt;</span>Acceleration<span class="op">&gt;</span> a<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> qt<span class="op">&lt;</span>Force<span class="op">&gt;</span> f <span class="op">=</span> m1 <span class="op">*</span> a<span class="op">;</span></span></code></pre></div>
<p>The previous code sample illustrates how to declare a new quantity
and how to perform operations on quantities. It also highlights that
those operations can be used in a <code>constexpr</code> context,
i.e. that at compile-time.</p>
<h3 data-number="1.1.2" id="the-qt_ref-and-const_qt_ref-classes"><span
class="header-section-number">1.1.2</span> The <code>qt_ref</code> and
<code>const_qt_ref</code> classes</h3>
<p>The library also provides two wrapper classes called
<code>qt_ref</code> and <code>const_qt_ref</code> which allows to wrap a
value into an object which acts respectively as a mutable or an
immutable quantity, as illustrated in the following code sample:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> eps <span class="op">=</span> <span class="fl">1e-14</span><span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> value <span class="op">=</span> <span class="op">[]</span> <span class="op">()</span><span class="kw">constexpr</span> <span class="op">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">constexpr</span> qt<span class="op">&lt;</span>Mass<span class="op">&gt;</span> m<span class="op">(</span><span class="fl">100.</span><span class="op">);</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a> <span class="kw">constexpr</span> qt<span class="op">&lt;</span>Acceleration<span class="op">&gt;</span> a<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a> <span class="kw">auto</span> vf <span class="op">=</span> <span class="dt">double</span><span class="op">{};</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a> <span class="kw">auto</span> f <span class="op">=</span> qt_ref<span class="op">&lt;</span>Force<span class="op">&gt;(</span>vf<span class="op">);</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a> f <span class="op">=</span> m <span class="op">*</span> a<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a> <span class="cf">return</span> vf<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">}();</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>TFEL_TESTS_STATIC_ASSERT<span class="op">(</span><span class="bu">std::</span>abs<span class="op">(</span>value <span class="op">-</span> <span class="fl">200.</span><span class="op">)</span> <span class="op">&lt;</span> eps<span class="op">);</span></span></code></pre></div>
<p>While a bit contrived, this example shows that the
<code>qt_ref</code> class can also be used in a <code>constexpr</code>
context.</p>
<p>The <code>qt_ref</code> and <code>const_qt_ref</code> classes are
parametrized by two template parameters which describe respectively the
unit and a numeric base type.</p>
<p>The <code>qt_ref</code> and <code>const_qt_ref</code> classes are
essentially used to build views of mathematical objects from a raw
memory area, as described in Section 1.7.</p>
<h3 data-number="1.1.3" id="the-quantity-class"><span
class="header-section-number">1.1.3</span> The <code>Quantity</code>
class</h3>
<p>For the sake of simplicity, the <code>qt</code>, <code>qt_ref</code>
and <code>const_qt_ref</code> were described as classes. This is not
actually the case in the current implementation which defines them
through type aliases to a more general <code>Quantity</code> class which
is parametrized by three template arguments: the unit, the basic numeric
type and a third argument describing how the value associated with the
quantity is handled.</p>
<h3 data-number="1.1.4" id="operations-on-quantities"><span
class="header-section-number">1.1.4</span> Operations on quantities</h3>
<p>Common operations on quantities, such as additions, subtraction,
multiplications, division and negations are supported.</p>
<p>Scaling and multiplication by a standard numeric value works as
expected, as demonstrated by the following code:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> qt<span class="op">&lt;</span>Mass<span class="op">&gt;</span> m<span class="op">(</span><span class="fl">100.</span><span class="op">);</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">// multiplication by a raw numeric type</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> m2 <span class="op">=</span> <span class="fl">2.</span> <span class="op">*</span> m<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">// scaling</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>m2 <span class="op">*=</span> <span class="dv">4</span><span class="op">;</span></span></code></pre></div>
<p>A quantity with unit <code>NoUnit</code> is implicitly convertible to
its base type:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> qt<span class="op">&lt;</span>NoUnit<span class="op">&gt;</span> q<span class="op">(</span><span class="fl">1.2</span><span class="op">);</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">double</span> q_value <span class="op">=</span> q<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="kw">auto</span> cos_q <span class="op">=</span> <span class="bu">std::</span>cos<span class="op">(</span>q<span class="op">);</span></span></code></pre></div>
<p>The latter line shows that standard mathematical functions can be
called directly.</p>
<p>Fractional power of a quantity are supported through the
<code>power</code> function as follows:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// declaration of a stress symmetric tensor</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>stensor<span class="op">&lt;</span><span class="dv">3</span><span class="bu">u</span><span class="op">,</span>qt<span class="op">&lt;</span>Stress<span class="op">&gt;&gt;</span> s<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">// contracted product of s which has the unit</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">// of the square of a stress</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="kw">auto</span> s2 <span class="op">=</span> s<span class="op">|</span>s<span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">// norm of s</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="kw">auto</span> norm <span class="op">=</span> power<span class="op">&lt;</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">&gt;(</span>s2<span class="op">);</span></span></code></pre></div>
<blockquote>
<p><strong>About the <code>power</code> function</strong></p>
<p>The <code>power</code> function is a very convenient function which
takes two template parameters <code>N</code> and <code>D</code> defining
the exponent as the fraction <span class="math inline">\(N/D\)</span>.
The default value of <code>D</code> is <span
class="math inline">\(1\)</span>, so the following syntax is valid:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> v <span class="op">=</span> power<span class="op">&lt;</span><span class="dv">3</span><span class="op">&gt;(</span><span class="dv">12</span><span class="op">);</span></span></code></pre></div>
<p>which computes <span class="math inline">\(12^{3}\)</span>.</p>
<p>The <code>power</code> function is optimised for the following values
of the denominator:</p>
<ul>
<li><span class="math inline">\(1\)</span>: In this case, the
<code>Nth</code> power of the argument is computed using by
multiplications if <span class="math inline">\(N\)</span> is positive.
If <span class="math inline">\(N\)</span> is negative, the
<code>Nth</code> power of the inverse of the argument is computed.</li>
<li><span class="math inline">\(2\)</span>: In this case, the square
root of the <code>Nth</code> power of the argument is computed using the
<code>std::sqrt</code> function.</li>
<li><span class="math inline">\(3\)</span>: In this case, the square
root of the <code>Nth</code> power of the argument is computed using the
<code>std::cbrt</code> function.</li>
</ul>
</blockquote>
<h2 data-number="1.2" id="sec:tfel_math:tensorial_objects"><span
class="header-section-number">1.2</span> A generic framework to build
tensorial-like objects</h2>
<p>This section first introduces the notion of array policy and indexing
policy which describes respectively how data are handled (stored) and
how those data are accessed.</p>
<p>Common objects of rank <span class="math inline">\(1\)</span> are
then defined, including tiny vectors, symmetric tensors and unsymmetric
tensors. Higher order objects are defined recursively as derivative of
objects of lower ranks.</p>
<h3 data-number="1.2.1"
id="description-of-the-arraypolicy-concept"><span
class="header-section-number">1.2.1</span> Description of the
<code>ArrayPolicy</code> concept</h3>
<p>Array policies describes how data are handled and accessed. For the
latter, the description of the access pattern is delegated to an
indexing policy which will be described later in Section 1.3. Thus, this
section mostly focuses on how array policies describe how the data are
handled.</p>
<p>A class matching the <code>ArrayPolicy</code> concept must
provide:</p>
<ul>
<li>An alias to a type called <code>value_type</code> which corresponds
to the logical type hold by the array (see below).</li>
<li>An alias to a type called <code>const_value_type</code> which
corresponds to a constant value to an object of the logical type hold by
the array.</li>
<li>An alias to a type called <code>storage_type</code> which is the
type actually stored in memory.</li>
<li>An alias to a type called <code>reference</code> which is the type
returned by the non-constant access operators of the array. An object of
the <code>reference</code> type must be convertible and assignable to a
<code>value_type</code> object and provide the following operators:
<ul>
<li><code>operator=(const other_type&amp;)</code></li>
<li><code>operator+=(const other_type&amp;)</code></li>
<li><code>operator-=(const other_type&amp;)</code></li>
<li><code>operator*=(const other_type&amp;)</code></li>
<li><code>operator/=(const other_type&amp;)</code></li>
</ul>
where <code>other_type</code> denotes for each operator a type for which
the considered operator in the <code>value_type</code> class is
valid.</li>
<li>An alias to a type called <code>const_reference</code> which is the
type returned by the constant access operators of the array. An object
of the <code>const_reference</code> type must be convertible and
assignable to a <code>value_type</code> object.</li>
<li>A static function called <code>make_const_reference</code> which
turns a constant reference to a <code>storage_type</code> object into a
<code>const_reference</code> object.</li>
<li>A static function called <code>make_reference</code> which turns a
reference to a <code>storage_type</code> object into a
<code>reference</code> object.</li>
<li>An alias type a type called <code>IndexingPolicy</code> which refers
an indexing policy. The <code>IndexingPolicy</code> concept is described
in depth in Section 1.3.</li>
</ul>
<p>It is worth illustrating those concepts in two commonly used
cases:</p>
<ul>
<li>Standard array policies.</li>
<li>Array policies used by views.</li>
</ul>
<h3 data-number="1.2.2" id="standard-array-policies"><span
class="header-section-number">1.2.2</span> Standard array policies</h3>
<p>The <code>StandardArrayPolicy</code> class is based in the following
statements:</p>
<ul>
<li><code>storage_type</code> is the same as
<code>value_type</code>.</li>
<li><code>reference</code> is the same as
<code>value_type&amp;</code>.</li>
<li><code>const_reference</code> is the same as
<code>const value_type&amp;</code>.</li>
<li><code>make_reference</code> is trivial an only returns a const
reference to the stored value.</li>
<li><code>make_const_reference</code> is trivial an only returns an
immutable reference to the stored value.</li>
</ul>
<p>Standard array policies are which are used to implement concrete
mathematical objects such as <code>tvector</code>, <code>tmatrix</code>,
<code>stensor</code>, <code>tensor</code>, etc.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Contrary to view array policies described in the next paragraph, the
<code>storage_type</code> is not restricted to be a basic numeric type
(<code>float</code>, <code>double</code> or
<code>long double</code>).</p>
</blockquote>
<h3 data-number="1.2.3" id="view-array-policies"><span
class="header-section-number">1.2.3</span> View array policies</h3>
<p>Views generally maps a memory location made of basic numeric types
(<code>float</code>, <code>double</code> or <code>long double</code>) to
a mathematical objects.</p>
<p>To support quantities, the type stored (<code>storage_type</code>)
must be distinguished from the logical type of the mapped object
(<code>value_type</code>). The reference type is then a simple wrapper
around a numeric value which acts as the desired quantity.</p>
<p>For example, let us consider the case of a view mapping a stress
symmetric tensor from an array of double precision numbers. In this
case, <code>storage_type</code> is the base type of
<code>value_type</code>, so:</p>
<ul>
<li><code>storage_type</code> is an alias to <code>double</code>.</li>
<li><code>value_type</code> is an alias to
<code>qt&lt;Stress, double&gt;</code>.</li>
<li><code>reference</code> is an alias to
<code>qt_ref&lt;stress, double&gt;</code>.</li>
<li><code>const_reference</code> is an alias to
<code>const_qt_ref&lt;stress, double&gt;</code>.</li>
<li><code>make_reference</code> simply builds a reference for the
address of the stored value. So does
<code>make_const_reference</code>.</li>
</ul>
<p>This mostly describes the implementation of the
<code>ViewArrayPolicy</code> class.</p>
<p>However, those rules only applies when <code>storage_type</code> is a
quantity. Otherwise, i.e. when <code>value_type</code> is a basic
numeric type, the implementation of the <code>ViewArrayPolicy</code>
class is equivalent to the <code>StandardArrayPolicy</code> class.</p>
<h2 data-number="1.3" id="sec:tfel_math:indexing_policies"><span
class="header-section-number">1.3</span> Description of the
<code>IndexingPolicy</code> concept</h2>
<p>A class matching the <code>IndexingPolicy</code> concept must
provide:</p>
<ul>
<li>An alias to a type called <code>size_type</code> to the type used to
index data.</li>
<li>An alias to a type called <code>RowMajorIndexingPolicy</code> which
can be used to import data from raw <code>C</code> pointers.</li>
<li>A static member data called <code>arity</code> of type
<code>size_type</code> which describes the number of indices required to
describe the object.</li>
<li>A static boolean data member called <code>hasFixedSizes</code>. If
this data member is <code>true</code>, the class must be stateless,
i.e. empty.</li>
<li>A static boolean data member called <code>areDataContiguous</code>
which states if the data is continuous</li>
<li>A member function called <code>size</code> which takes no argument
returning the number of data values accessible by the indexing policy.
This member function must be <code>constexpr</code> if
<code>hasFixedSizes</code> is true.</li>
<li>A member function called <code>size</code> which takes a
<code>size_type</code> argument returning range in the given dimension.
This member function must be <code>constexpr</code> if
<code>hasFixedSizes</code> is true.</li>
<li>A member function called <code>getUnderlyingArrayMinimalSize</code>
which returns the minimal size of an array required by the indexing
policy. This member function must be <code>constexpr</code> if
<code>hasFixedSizes</code> is true.</li>
<li>A member function called <code>getIndex</code> which returns the
memory offset of an element of the object with respect to the location
of the first element of the object. The number of argument of this
method must be equal to the <code>arity</code> member. This member
function must be <code>constexpr</code> if <code>hasFixedSizes</code> is
true.</li>
</ul>
<h3 data-number="1.3.1" id="an-example-of-indexing-policy"><span
class="header-section-number">1.3.1</span> An example of indexing
policy</h3>
<figure id="fig:tfel_math:matrix_row_major">
<img src="img/tfel-math/matrix_row_major.svg" style="width:90.0%"
alt="Storage of the elements of a matrix using the row-major format" />
<figcaption>Figure 1: Storage of the elements of a matrix using the
row-major format</figcaption>
</figure>
<p>Let us consider an <span class="math inline">\(N\,\times\,M\)</span>
matrix stored in a contiguous memory location using the row major
format, i.e. all elements of the same row are stored continuously as
depicted on Figure 1. The position of <span
class="math inline">\(i,j\)</span> element from the start of the memory
area is given by <span class="math inline">\(i \, M + j\)</span>.</p>
<p>Let us now consider a view on a <span
class="math inline">\(L\,\times\,K\)</span> submatrix in a which starts
at row <span class="math inline">\(i0\)</span> and column <span
class="math inline">\(j0\)</span>. The position of the <span
class="math inline">\(i,j\)</span> element of the submatrix in the
matrix is also given by <span class="math inline">\(i \, M + j\)</span>
if we start from the first element of the submatrix.</p>
<p>This formula is implemented by the <code>getIndex</code> method of
the <code>FixedSizeRowMajorMatrixIndexingPolicy</code> which is used by
many classes provide by the library, such as <code>tmatrix</code>
(matrices whose size is known at compile time), <code>st2tost2</code>,
<code>t2tot2</code>, etc. and views to those objects in a matrix.</p>
<h3 data-number="1.3.2"
id="higher-order-indexing-policies-for-fixed-size-mathematical-objects"><span
class="header-section-number">1.3.2</span> Higher order indexing
policies for fixed-size mathematical objects</h3>
<p>Let us consider a mathematical object <span
class="math inline">\(o_{3}\)</span> resulting from the derivation of a
mathematical object <span class="math inline">\(o_{1}\)</span> of arity
<span class="math inline">\(a_{1}\)</span> with respect to a
mathematical object <span class="math inline">\(o_{2}\)</span> of arity
<span class="math inline">\(a_{2}\)</span>. <span
class="math inline">\(o_{3}\)</span> has an arity of <span
class="math inline">\(a_{1}+a_{2}\)</span>.</p>
<p>The storage of those objects are described respectively by the
indexing policies <span class="math inline">\(p_{1}\)</span> and <span
class="math inline">\(p_{2}\)</span>. We assume that the object <span
class="math inline">\(o_{1}\)</span> can be stored in a memory area of
size <span class="math inline">\(s_{1}\)</span> and that the object
<span class="math inline">\(o_{2}\)</span> can be stored in a memory
area of size <span class="math inline">\(s_{2}\)</span>. Then the object
<span class="math inline">\(o_{3}\)</span> can be stored in a memory
location <span class="math inline">\(s_{1}\,s_{2}\)</span>.</p>
<p>Then, an indexing policy <span class="math inline">\(p_{3}\)</span>
suitable to describe <span class="math inline">\(o_{3}\)</span> may
compute the position of the derivative of the component <span
class="math inline">\(o_{1}{\left(i_{0},\ldots,i_{a_{1}-1}\right)}\)</span>
with respect to the component <span
class="math inline">\(o_{2}{\left(j_{0},\ldots,j_{a_{2}-1}\right)}\)</span>
is given by:</p>
<p><span class="math display">\[
p_{3}{\left(i_{0},\ldots,i_{a_{1}-1},j_{0},\ldots,j_{a_{2}-1}\right)}=
p_{1}{\left(i_{0},\ldots,i_{a_{1}-1}\right)}\,s_{2}+p_{2}{\left(j_{0},\ldots,j_{a_{2}-1}\right)}
\]</span></p>
<p>This choice is implemented in the
<code>FixedSizeIndexingPoliciesCartesianProduct</code> class which is
used to by the <code>FixedSizeArrayDerivative</code> class to describe
derivatives of two arbitrary mathematical objects.</p>
<h2 data-number="1.4" id="low-rank-mathematical-objects"><span
class="header-section-number">1.4</span> Low rank mathematical
objects</h2>
<p>The library is based on a few low rank mathematical objects:</p>
<ul>
<li><code>tvector</code>: a tiny vector of fixed size. This template
class is parametrized by the size of the vector and the value hold.</li>
<li><code>stensor</code>: a symmetric tensor. This template class is
parametrized by the space dimension and the scalar type.</li>
<li><code>tensor</code>: an unsymmetric tensor. This template class is
parametrized by the space dimension and the scalar type.</li>
</ul>
<p>All those objects are represented by objects of rank one using a
vector-like notations. For example, a <span
class="math inline">\(3D\)</span> symmetric tensor is represented as
follows:</p>
<p><span class="math display">\[
  \underline{s}=
  \begin{pmatrix}
    s_{\,11}\quad
    s_{\,22}\quad
    s_{\,33}\quad
    \sqrt{2}\,s_{\,12}\quad
    \sqrt{2}\,s_{\,13}\quad
    \sqrt{2}\,s_{\,23}
  \end{pmatrix}^{T}
\]</span></p>
<p>This notation has the property that the contracted product of two
symmetric tensors is the scalar product of this vector form (hence the
<span class="math inline">\(\sqrt{2}\)</span>).</p>
<p>In a similar manner, an unsymmetric tensor is represented as follows:
<span class="math display">\[
  \underline{s}=
  \begin{pmatrix}
    s_{\,11}\quad
    s_{\,22}\quad
    s_{\,33}\quad
    s_{\,12}\quad
    s_{\,21}\quad
    s_{\,13}\quad
    s_{\,31}\quad
    s_{\,23}\quad
    s_{\,32}
  \end{pmatrix}^{T}
\]</span></p>
<h2 data-number="1.5"
id="higher-order-objects-defined-as-derivatives"><span
class="header-section-number">1.5</span> Higher order objects defined as
derivatives</h2>
<p>The library provides a generic class called
<code>FixedSizeArrayDerivative</code> which allows to create higher
order objects as being the derivative of two objects of lowest
ranks.</p>
<p>This class is currently very limited but will be extended in future
versions of the library.</p>
<h3 data-number="1.5.1" id="the-case-of-fourth-order-tensors"><span
class="header-section-number">1.5.1</span> The case of fourth order
tensors</h3>
<p>Fourth order tensors can be defined as derivatives of two tensors or
as linear mappings from the second order tensors to second order
tensors.</p>
<p>As there are two kinds of second order tensors (i.e. symmetric and
non-symmetric tensors), there are four kinds of fourth order tensors
defined in the <code>TFEL/Math</code> library, which satisfy the
following concepts:</p>
<ul>
<li><code>ST2toST2Concept</code>: linear mapping from symmetric tensors
to symmetric tensors.</li>
<li><code>ST2toT2Concept</code>: linear mapping from symmetric tensors
to non-symmetric tensors.</li>
<li><code>T2toST2Concept</code>: linear mapping from non-symmetric
tensors to symmetric tensors.</li>
<li><code>T2toT2Concept</code>: linear mapping from non-symmetric
tensors to non-symmetric tensors.</li>
</ul>
<p>An end user will mostly use the following implementations of those
concepts: <code>st2tost2</code>, <code>st2tot2</code>,
<code>t2tost2</code> and <code>t2tot2</code> respectively. Those classes
have the following template arguments:</p>
<ul>
<li>The space dimension (<code>1</code>, <code>2</code> or
<code>3</code>).</li>
<li>The type used to perform the computation.</li>
</ul>
<h3 data-number="1.5.2" id="the-tmatrix-case"><span
class="header-section-number">1.5.2</span> The <code>tmatrix</code>
case</h3>
<p>A fixed size matrix, implemented by the <code>tmatrix</code> class
can be seen as the derivative of a tiny tensor with respect to a tiny
vecor.</p>
<h3 data-number="1.5.3" id="the-derivative_type-metafunction"><span
class="header-section-number">1.5.3</span> The
<code>derivative_type</code> metafunction</h3>
<p>The <code>TFEL/Math</code> library provides a very convenient type
alias called <code>derivative_type</code> which automatically selects
the correct type as the derivative of two objects of fixed sizes. This
alias also works with scalars. This type alias takes quantities into
account if required.</p>
<p>Here are a few examples:</p>
<ul>
<li><code>derivative_type&lt;double, double&gt;</code> is an alias to
<code>double</code>.</li>
<li><code>derivative_type&lt;qt&lt;Stress&gt;, double&gt;</code> is an
alias to <code>qt&lt;Stress&gt;</code>.</li>
<li><code>derivative_type&lt;qt&lt;Stress&gt;, qt&lt;Time&gt;&gt;</code>
is an alias to <code>qt&lt;StrainRate&gt;</code>.</li>
<li><code>derivative_type&lt;tvector&lt;2u, double&gt;, tvector&lt;3u, double&gt;&gt;</code>
is an alias to <code>tmatrix&lt;2u, 3u, double&gt;</code>.</li>
<li><code>derivative_type&lt;stensor&lt;2u, double&gt;, stensor&lt;2u, double&gt;&gt;</code>
is an alias to <code>st2tost2&lt;2u, double&gt;&gt;</code>.</li>
<li><code>derivative_type&lt;stensor&lt;2u, double&gt;, tvector&lt;3u, double&gt;&gt;</code>
is an alias to <code>FixedSizeArray</code>
<code>Derivative&lt;stensor&lt;2u, double&gt;, tvector&lt;3u,   double&gt;&gt;</code>.</li>
</ul>
<h2 data-number="1.6" id="sec:tfel_math:expression_templates"><span
class="header-section-number">1.6</span> Expressions templates</h2>
<p>One may expect that the addition of two vector results in a new
vector. This naive approach may lead to poor performances, due to
temporaries objects and data copying <span class="citation"
data-cites="veldhuizen_techniques_1999">[<a
href="#ref-veldhuizen_techniques_1999"
role="doc-biblioref">2</a>]</span>.</p>
<p>Expression templates is a C++ template metaprogramming technique
which introduces additional classes which represent the actions to be
performed on some objects and lazily delay the execution of those
actions until the result is explicitly requested.</p>
<p>The objects of those classes are placeholders, also called handlers
within the library, that are meant to be assigned to an object whose
type is the expected result of the operation treated.</p>
<p>To illustrate this technique, let us consider the addition of three
vectors <span class="math inline">\(\vec{a}\)</span>, <span
class="math inline">\(\vec{b}\)</span> and <span
class="math inline">\(\vec{c}\)</span> and its assignment to a vector
<span class="math inline">\(\vec{d}\)</span>:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> a <span class="op">+</span> b <span class="op">+</span> c<span class="op">;</span></span></code></pre></div>
<p>The addition of the vectors <span
class="math inline">\(\vec{a}\)</span> and <span
class="math inline">\(\vec{b}\)</span> produces an intermediate object
<span class="math inline">\(\vec{e1}\)</span> of type <code>Expr1</code>
which keeps a reference to those two vectors. Similarly, the addition of
those three vectors defines another object <span
class="math inline">\(\vec{e2}\)</span> of type <code>Expr2</code> which
stands for the addition of <span class="math inline">\(\vec{e1}\)</span>
and the vector <span class="math inline">\(\vec{c}\)</span>.</p>
<figure id="fig:tfel_math:expression_templates">
<img src="img/tfel-math/expression_templates.svg" style="width:50.0%"
alt="Application of the expression templates technique to the addition of three vectors." />
<figcaption>Figure 2: Application of the expression templates technique
to the addition of three vectors.</figcaption>
</figure>
<p>Figure 2 shows how the access operator of <code>e2</code> is
implemented. The assignment of an object of type <code>Expr2</code> to a
vector <code>d</code> is implemented as a standard <code>for</code>
loop:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span><span class="dt">size_type</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">!=</span>d<span class="op">.</span>size<span class="op">();++</span>i<span class="op">){</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  d<span class="op">(</span>i<span class="op">)</span> <span class="op">=</span> e2<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The temporary objects <code>e1</code> and <code>e2</code> are meant
to be eliminated by the compiler optimisation process. Thanks to
function inlining, the compiler is able to produce a code that is
equivalent to what would have been obtained with the following
instructions:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span><span class="dt">size_type</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">!=</span>d<span class="op">.</span>size<span class="op">();++</span>i<span class="op">){</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  d<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> b<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> c<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<blockquote>
<p><strong>About loop unrolling</strong></p>
<p>When dealing with objects whose size is known at compile-time, the
<code>TFEL/Math</code> library also performs an additional optimisation
technique known as <em>loop unrolling</em>. For example, if <span
class="math inline">\(\underline{a}\)</span>, <span
class="math inline">\(\underline{b}\)</span> and <span
class="math inline">\(\underline{c}\)</span> are three <span
class="math inline">\(1D\)</span> symmetric tensors, the code:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> a <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> b<span class="op">;</span></span></code></pre></div>
<p>is equivalent to:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>c<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> a<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> b<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>c<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> a<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> b<span class="op">[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>c<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> a<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> b<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span></code></pre></div>
</blockquote>
<h3 data-number="1.6.1" id="the-eval-function"><span
class="header-section-number">1.6.1</span> The <code>eval</code>
function</h3>
<p>One possible caveat of the expression template technique can be
illustrated by the following example. Let us consider two vectors
<code>a</code> and <code>b</code>:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>a<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>b<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> c <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Here, c[0] evaluates to 3, as expected.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>a<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">// However, at this stage, c[0] evaluates to 4 !</span></span></code></pre></div>
<p>Another caveat is that is sometimes more efficient to evaluate the
result of an operation once and use the result of this evaluation rather
than performing the evaluation of the operation several times.</p>
<p>To avoid those two caveats, the <code>eval</code> function allows the
evaluation of an expression, as follows:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="kw">auto</span> c <span class="op">=</span> eval<span class="op">(</span>a <span class="op">+</span> b<span class="op">);</span></span></code></pre></div>
<h2 data-number="1.7" id="sec:tfel_math:views"><span
class="header-section-number">1.7</span> Views</h2>
<p>Views allows to map memory area to mathematical objets. Two kind of
view are available in <code>TFEL/Math</code>:</p>
<ul>
<li>the <code>View</code> class which assumes a mapping from a
contiguous memory,</li>
<li>the <code>CoalescedView</code> class which allows to give a pointer
for each component of the mapped mathematical object.</li>
</ul>
<blockquote>
<p><strong>Typical usage of views in <code>MFront</code></strong></p>
<p>A typical usage of views is given by the example of the integration
of a behaviour using an implicit scheme. In such a scheme, a non-linear
solver tries to determine the increments <span
class="math inline">\(\Delta\,Y\)</span> of a set of internal state
variables packed in a vector <span class="math inline">\(Y\)</span>
which are the zero of residual denoted <span
class="math inline">\(F\)</span>. The derivative of the residual <span
class="math inline">\(F\)</span> with respect to <span
class="math inline">\(\Delta\,Y\)</span> is called the jacobian and is
denoted <span class="math inline">\(J\)</span>.</p>
<p>If one considers a simple plastic law with isotropic hardening, the
vector of internal state variables typically contains the elastic
strain, a symmetric tensor, and the equivalent plastic strain, a
scalar.</p>
<p>In the general case, the vector of internal state variables, the
residual and the jacobian can be decomposed as follows:</p>
<p><span class="math display">\[
Y=
\begin{pmatrix}
y_{1} \\
\vdots \\
y_{i} \\
\vdots \\
y_{n} \\
\end{pmatrix}
\quad\quad
F=
\begin{pmatrix}
f_{y_{1}} \\
\vdots \\
f_{y_{i}} \\
\vdots \\
f_{y_{n}} \\
\end{pmatrix}
\quad\quad
J = {\displaystyle \frac{\displaystyle \partial F}{\displaystyle
\partial \Delta\,Y}} =
\begin{pmatrix}
  {\displaystyle \frac{\displaystyle \partial f_{y_{1}}}{\displaystyle
\partial \Delta\,y_{1}}} &amp; \ldots &amp; \ldots &amp; \ldots &amp;
\ldots \\
  \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
  \vdots &amp; \vdots &amp; {\displaystyle \frac{\displaystyle \partial
f_{y_{i}}}{\displaystyle \partial \Delta\,y_{j}}} &amp; \vdots &amp;
\vdots \\
  \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
  \ldots &amp; \ldots &amp; \ldots &amp; \ldots &amp; {\displaystyle
\frac{\displaystyle \partial f_{y_{N}}}{\displaystyle \partial
\Delta\,y_{N}}} \\
\end{pmatrix}
\]</span></p>
<p><code>MFront</code> automatically define views to the objects <span
class="math inline">\(y_{i}\)</span>, <span
class="math inline">\(f_{y_{i}}\)</span>, <span
class="math inline">\({\displaystyle \frac{\displaystyle \partial
f_{y_{i}}}{\displaystyle \partial \Delta\,y_{j}}}\)</span> which allows
to compute the residual blocks and the jacobian blocks in a very
intuitive ways using tensorial operations. Hence, the user never
manipulate directly the vectors <span class="math inline">\(Y\)</span>,
<span class="math inline">\(\Delta\,Y\)</span> and <span
class="math inline">\(F\)</span> nor the jacobian matrix <span
class="math inline">\(J\)</span> but views which acts as tensorial
objects.</p>
</blockquote>
<h3 data-number="1.7.1" id="the-map-function"><span
class="header-section-number">1.7.1</span> The <code>map</code>
function</h3>
<p>The <code>map</code> function is a small utility function which
simplifies the creation of views from either raw pointers or from tiny
vectors (i.e. objects of type <code>tvector</code>).</p>
<p>For example, Listing 1 shows how a vector containing the elastic
strain and the equivalent plastic strain can be decomposed by blocks.
This decomposition is illustrated on Figure 3.</p>
<div id="lst:tfel_4.0:view" class="listing cxx">
<p>Listing 1: Usage of the `map` function</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> Y <span class="op">=</span> tvector<span class="op">&lt;</span><span class="dv">7</span><span class="op">,</span> <span class="dt">double</span><span class="op">&gt;{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> eel <span class="op">=</span> map<span class="op">&lt;</span>stensor<span class="op">&lt;</span><span class="dv">3</span><span class="bu">u</span><span class="op">,</span> <span class="dt">double</span><span class="op">&gt;&gt;(</span>Y<span class="op">);</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span><span class="op">&amp;</span> p <span class="op">=</span> Y<span class="op">[</span><span class="dv">6</span><span class="op">];</span></span></code></pre></div>
</div>
<figure id="fig:tfel_4.0:view">
<img src="img/tfel-math/view.svg" style="width:75.0%"
alt="“Exemple of decomposition by blocks of a memory area using views”" />
<figcaption>Figure 3: “Exemple of decomposition by blocks of a memory
area using views”</figcaption>
</figure>
<p>The <code>map</code> function allows to define offset at
compile-time: this allows to checks at compile-time that the memory area
is large enough to store the mapped object when mapping a fixed size
object (i.e. an object whose size is known at compile-time) from a
memory area hold by a tiny vector.</p>
<h3 data-number="1.7.2" id="the-map_array-function"><span
class="header-section-number">1.7.2</span> The <code>map_array</code>
function</h3>
<p>The <code>map_array</code> returns an object which acts like a fixed
size of mathematical objects. It takes one template argument which
describes an arry of of mathematical objects. This template argument is
used to determine the number of object mapped and the kind of object
mapped.</p>
<p>It can be used as follows:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> a <span class="op">=</span> map_array<span class="op">&lt;</span>tvector<span class="op">&lt;</span><span class="dv">2</span><span class="bu">u</span><span class="op">,</span> stensor<span class="op">&lt;</span><span class="dv">2</span><span class="bu">u</span><span class="op">,</span> <span class="dt">double</span><span class="op">&gt;&gt;&gt;(</span>ptr<span class="op">);</span></span></code></pre></div>
<p>where <code>ptr</code> is a pointer to a suitable memory
location.</p>
<h3 data-number="1.7.3" id="the-map_derivative-function"><span
class="header-section-number">1.7.3</span> The
<code>map_derivative</code> function</h3>
<p>The <code>map_derivative</code> function allows to create a view of
the derivative of two math objects in a matrix as illustrated by the
following example which create a view of the object resulting of the
derivation of a symmetric stress tensor with respect to a scalar whose
first element is located in element <span
class="math inline">\(1,1\)</span> of the matrix:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> r <span class="op">=</span> tmatrix<span class="op">&lt;</span><span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">&gt;{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>map_derivative<span class="op">&lt;</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> stensor<span class="op">&lt;</span><span class="dv">2</span><span class="bu">u</span><span class="op">,</span> qt<span class="op">&lt;</span>Stress<span class="op">&gt;&gt;,</span> <span class="dt">double</span><span class="op">&gt;(</span>r<span class="op">)</span> <span class="op">=</span> stensor<span class="op">&lt;</span><span class="dv">2</span><span class="bu">u</span><span class="op">,</span> Stress<span class="op">&gt;::</span>Id<span class="op">();</span></span></code></pre></div>
<p>The result of this operation is the matrix:</p>
<p><span class="math display">\[
\begin{pmatrix}
  0 &amp; 0 &amp; 0 \\
  0 &amp; 1 &amp; 0 \\
  0 &amp; 1 &amp; 0 \\
  0 &amp; 1 &amp; 0 \\
  0 &amp; 0 &amp; 0 \\
\end{pmatrix}
\]</span></p>
<h3 data-number="1.7.4"
id="views-of-tensorial-objects-with-coalescent-memory-access"><span
class="header-section-number">1.7.4</span> Views of tensorial objects
with coalescent memory access</h3>
<p>The <code>View</code> class allows to interpret a contiguous memory
area as a tensorial object. Such views are not efficient on GPUs where
coalescent memory access are preferable. The newly introduced
<code>CoalescedView</code> class offers a solution to this issue.</p>
<p>A coalesced view is initialized by an array of pointers to the
components of the mapped object, as illustrated in the following
snippet:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> values<span class="op">[</span><span class="dv">8</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">40</span><span class="op">};</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>array ptrs<span class="op">{&amp;</span>values<span class="op">[</span><span class="dv">0</span><span class="op">],</span> <span class="op">&amp;</span>values<span class="op">[</span><span class="dv">2</span><span class="op">],</span> <span class="op">&amp;</span>values<span class="op">[</span><span class="dv">4</span><span class="op">],</span> <span class="op">&amp;</span>values<span class="op">[</span><span class="dv">6</span><span class="op">]};</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> s1 <span class="op">=</span> map<span class="op">&lt;</span>stensor<span class="op">&lt;</span><span class="dv">2</span><span class="bu">u</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;&gt;(</span>ptrs<span class="op">);</span></span></code></pre></div>
<p>In this snippet, the components of the symmetric tensor
<code>s1</code> are not stored continuously but each component is
associated to an independent pointer.</p>
<h1 data-number="2" id="sec:tfel_math:non_linear_solvers"><span
class="header-section-number">2</span> Solvers for fixed size non-linear
systems</h1>
<p>The <code>TFEL/Math</code> library provides several non-linear
solvers which are mainly used by <code>MFront</code> implicit schemes.
Those solvers mostly targets systems of small size and focus on
robustness and flexibility. Each solver implements a classical algorithm
by also provides several customisation points which allows to create
many variants of this basic algorithms.</p>
<p>The solvers available are based on the following algorithms:</p>
<ul>
<li>The standard Newton-Raphson algorithm is implemented in the
<code>TinyNewtonRaphsonSolver</code> class. This algorithm is coupled
with a Powell’ dog leg step in the
<code>TinyPowellDogLegNewtonRaphsonSolver</code> class.</li>
<li>The first and second Broyden algorithms, also known respectively as
the good and bad Broyden algorithms are respectively implemented in the
<code>TinyBroydenSolver</code> and <code>TinyBroyden2Solver</code>
classes. The first Broyden algorithm is coupled with a Powell’ dog leg
step in the <code>TinyPowellDogLegBroydenSolver</code> class.</li>
<li>The Levenberg-Marquardt algorithm is implemented in the
<code>TinyLevenbergMarquardtSolver</code> class.</li>
</ul>
<p>Those classes implements the curiously recurring template pattern
(CRTP) to avoid the use of virtual calls <span class="citation"
data-cites="coplien_curiously_1995">[<a
href="#ref-coplien_curiously_1995" role="doc-biblioref">3</a>]</span>.
The derived class must provide a method called
<code>computeResidual</code> which must compute the residual for the
current estimate of the unknowns and, if required by the solver, the
jacobian.</p>
<p>A typical usage of those classes is given by the following
example:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> NewtonRaphsonSolver</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="kw">public</span> tfel<span class="op">::</span>math<span class="op">::</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>          TinyNewtonRaphsonSolver<span class="op">&lt;</span><span class="dv">2</span><span class="bu">u</span><span class="op">,</span> <span class="dt">double</span><span class="op">,</span> NewtonRaphsonSolver<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  NewtonRaphsonSolver<span class="op">()</span> <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">-&gt;</span>zeros <span class="op">=</span> <span class="op">{</span><span class="fl">0.</span><span class="op">,</span> <span class="fl">0.</span><span class="op">};</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">-&gt;</span>epsilon <span class="op">=</span> <span class="fl">1.e-14</span><span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">-&gt;</span>iterMax <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> solve<span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> <span class="kw">this</span><span class="op">-&gt;</span>solveNonLinearSystem<span class="op">();</span> <span class="op">}</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> getCurrentEstimate<span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="kw">this</span><span class="op">-&gt;</span>zeros<span class="op">;</span> <span class="op">}</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> computeResidual<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">double</span> a <span class="op">=</span> <span class="fl">1.</span><span class="op">;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">double</span> b <span class="op">=</span> <span class="fl">10.</span><span class="op">;</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span><span class="op">&amp;</span> x <span class="op">=</span> <span class="kw">this</span><span class="op">-&gt;</span>zeros<span class="op">;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span><span class="op">&amp;</span> f <span class="op">=</span> <span class="kw">this</span><span class="op">-&gt;</span>fzeros<span class="op">;</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span><span class="op">&amp;</span> J <span class="op">=</span> <span class="kw">this</span><span class="op">-&gt;</span>jacobian<span class="op">;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> <span class="op">{</span><span class="dv">1</span> <span class="op">-</span> x<span class="op">(</span><span class="dv">0</span><span class="op">),</span> <span class="dv">100</span> <span class="op">*</span> <span class="op">(</span>x<span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">-</span> x<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">*</span> x<span class="op">(</span><span class="dv">0</span><span class="op">))};</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    J <span class="op">=</span> <span class="op">{-</span><span class="fl">1.</span><span class="op">,</span> <span class="fl">0.</span><span class="op">,</span>  <span class="co">//</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>         <span class="op">-</span><span class="dv">200</span> <span class="op">*</span> x<span class="op">(</span><span class="dv">0</span><span class="op">),</span> <span class="fl">100.</span><span class="op">};</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span>  <span class="co">// end of computeResidual</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="op">};</span>  <span class="co">// end of struct NewtonRaphsonSolver</span></span></code></pre></div>
<p>which solves the non-linear system:</p>
<p><span class="math display">\[
\vec{f}{\left(x,y\right)} =
\begin{pmatrix}
0 \\
0 \\
\end{pmatrix}
\quad\text{with}\quad
\vec{f}{\left(x,y\right)} =
\begin{pmatrix}
1-x \\
10\,{\left(y-x^{2}\right)} \\
\end{pmatrix}
\]</span></p>
<p>whose obvious root is <span
class="math inline">\({\left(1,1\right)}\)</span>.</p>
<p>This previous example shows that:</p>
<ol type="1">
<li>The current estimate of the unknowns is stored in a data member
called <code>zeros</code>.</li>
<li>The residual is stored in a data member called
<code>fzeros</code>.</li>
<li>The jacobian is stored in a data member called
<code>jacobian</code>.</li>
</ol>
<p>Those names have been chosen in the early versions of
<code>MFront</code> and are kept for back-ward compatibility.</p>
<p>This section describes the generic framework used to implement those
algorithms.</p>
<h2 data-number="2.1" id="the-tinynonlinearsolverbase-class"><span
class="header-section-number">2.1</span> The
<code>TinyNonLinearSolverBase</code> class</h2>
<p>All the available solvers are based on the
<code>TinyNonLinearSolverBase</code> which provides two main methods
<code>solveNonLinearSystem</code> and <code>solveNonLinearSystem2</code>
for the end users and many methods that can be overloaded to customize
the behaviour of the algorithm.</p>
<p>In practice, the <code>NewtonRaphsonSolver</code> class presented in
the previous example inherits from <code>TinyNewtonRaphson</code>
<code>Solver&lt;2u, double, NewtonRaphsonSolver&gt;</code> which itself
inherits from
<code>TinyNonLinearSolverBase&lt;2u, double, NewtonRaphsonSolver&gt;</code>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>For the sake of clarity, one template parameter of the
<code>TinyNewtonRaphsonSolver</code> and
<code>TinyNonLinearSolverBase</code> class have been omitted.</p>
<p>This template parameter describes a data structure containing the
so-called workspace of the solver, i.e. all the data members required by
the solver. The default value of this template parameter allocates those
data members on the stack.</p>
</blockquote>
<p>While a bit contrived, this design ensures that all algorithms share
the same customization points, a constraint which is not easy to enforce
when relying on CRTP (compared to standard approach based on virtual
calls).</p>
<p>As a consequence, the <code>TinyNewtonRaphsonSolver</code> class only
implements some methods specific to the Newton-Raphson algorithm while
the global algorithmic structure in handled by the
<code>TinyNonLinearSolverBase</code> class.</p>
<p>More precisely, the <code>TinyNonLinearSolverBase</code> provides a
method called <code>solveNonLinearSystem</code>. This method internally
calls a method called <code>solveNonLinearSystem2</code> which indeed
implements the core of the resolution algorithm. The
<code>solveNonLinearSystem2</code> method is described in depth in
Section 2.1.2.</p>
<p>The point of the <code>solveNonLinearSystem</code> is to handle
failures of the resolution algorithms. The current strategy to handle
those failures is described in depth in Section 2.1.3.</p>
<h3 data-number="2.1.1"
id="some-data-members-of-the-tinynonlinearsolverbase-class"><span
class="header-section-number">2.1.1</span> Some data members of the
<code>TinyNonLinearSolverBase</code> class</h3>
<p>The <code>TinyNonLinearSolverBase</code> class provides the following
data members:</p>
<ul>
<li><code>fzeros</code>: residual vector.</li>
<li><code>zeros</code>: current estimate of the unknowns.</li>
<li><code>delta_zeros</code>: last computed correction.</li>
<li><code>iter</code>: current iteration number.</li>
<li><code>is_delta_zeros_defined</code>: boolean stating if an increment
of the unknowns has already been computed.</li>
<li><code>epsilon</code>: criterion value</li>
<li><code>iterMax</code>: maximum number of iterations.</li>
</ul>
<p>It is worth mentioning that a few variables must be initialized, by
the base class before calling this method, such as:</p>
<ul>
<li>The initial estimate of the unknowns. The method
<code>processNewEstimate</code> must be called must be called one this
initial estimate is known.</li>
<li>The values <code>epsilon</code> and <code>iterMax</code>, as well as
other numerical parameters required by the core algorithm and declared
in derived class.</li>
</ul>
<p>The <code>iter</code> and <code>has_delta_zeros</code> members are
automatically initialized at the beginning of the
<code>solveNonLinearSystem</code> method. This method also calls the
<code>processNewEstimate</code> method.</p>
<h3 data-number="2.1.2"
id="sec:tfel_math:TinyNonLinearSolverBase:solveNonLinearSystem2"><span
class="header-section-number">2.1.2</span> The
<code>solveNonLinearSystem2</code> method</h3>
<p>This method is called internally by the
<code>solveNonLinearSystem</code> method. It could be called directly if
the required initialization are performed beforehand.</p>
<p>The algorithm implemented by <code>solveNonLinearSystem2</code>
method is depicted in Figure 4.</p>
<figure
id="fig:tfel_math:TinyNonLinearSolverBase:solveNonLinearSystem2">
<img src="img/tfel-math/solveNonLinearSystem2.svg" style="width:100.0%"
alt="“Flowchart for the resolution of non linear systems proposed by the solveNonLinearSystem2 of the TinyNonLinearSolverBase class”" />
<figcaption>Figure 4: “Flowchart for the resolution of non linear
systems proposed by the <code>solveNonLinearSystem2</code> of the
<code>TinyNonLinearSolverBase</code> class”</figcaption>
</figure>
<p>The <code>computeNewCorrection</code> is the only method that must be
implemented in the derived class. It totally defines the resolution
algorithm. This method thus has no default implementation.</p>
<p>This flowchart also shows that the <code>solveNonLinearSystem</code>
method has many customization points which either defines the underlying
algorithm and or that can be used to enhance directly affects the
performance and the robustness of the algorithm:</p>
<ul>
<li><code>executeInitialisationTaskBeforeBeginningOfCoreAlgorithm</code>
which is started at the start of the method. The default implementation
does nothing. This method is mostly meant to be used by the derived
class to initialize members specific to the resolution algorithm.</li>
<li><code>computeResidual</code>: is meant to compute the residual for
the current estimate of the unknowns. This method may also compute the
jacobian if required.</li>
<li><code>computeResidualNorm</code> which must computes the norm of the
residual. By default, this method computes the euclidian norm of the
residual. This method.</li>
<li><code>checkConvergence</code> which checks if convergence is
reached. By default, this method checks if the residual norm is lower
than the criterion value <code>epsilon</code>. This method can also be
used to implement active-sets algorithms for non-smooth functions.</li>
<li><code>processNewCorrection</code>: this method meant to set bounds
on some components of the current correction or to implement a line
search along the search direction returned by the
<code>computeNewCorrection</code> method.</li>
<li><code>processNewEstimate</code>: this method is meant to update
variables depending on the current estimate of the unknowns.</li>
<li>By convention, the <code>computeNewCorrection</code> method may use
the following helper methods:
<ul>
<li><code>updateOrCheckJacobian</code>: This method can be used to
compute the jacobian or part of the jacobian numerically. If the
jacobian was computed in <code>computeResidual</code>, this method can
be used to compare it to a numerical approximation.</li>
<li><code>solveLinearSystem</code>: This method can be used to solve a
linear system if required. By default, an LU method with partial
decomposition is used (implemented by the <code>TinyMatrixSolve</code>
class).</li>
</ul></li>
</ul>
<p>The algorithm also provides methods which are meant to display
information about the state of the resolution:</p>
<ul>
<li><code>reportInvalidResidualEvaluation</code> which is called method
when the evaluation of the residual failed or when the norm of the
residual is not finite.</li>
<li><code>reportStandardIteration</code>: which is called once the
residual is known.</li>
</ul>
<p>Note that other methods for reporting the current status of the
algorithm, such as <code>reportFailure</code> and
<code>reportSuccess</code> are also available but are called in the
<code>solveNonLinearMethod</code>.</p>
<blockquote>
<p><strong>Usage in <code>MFront</code></strong></p>
<p>It is worth highlighting how the implicit DSL’s provided by
<code>MFront</code> may override those methods:</p>
<ul>
<li>The <code>computeResidual</code> method first computes the
thermodynamic forces using the code provided by the
<code>@ComputeThermodynamicForces</code> code bock (or
<code>@ComputeStress</code> for mechanical behaviours) and then
evaluates the residual using the code given by the
<code>@Integrator</code> code block and the jacobian if it is computed
analytically.</li>
<li>The <code>updateOrCheckJacobian</code> method is overloaded if:
<ul>
<li>A numerical approximation of the jacobian or blocks of the jacobian
are required.</li>
<li>A comparison of the analytical jacobian to a numerical approximation
is required.</li>
</ul></li>
<li>The <code>checkConvergence</code> method is overloaded to take into
account additional convergence checks defined in the
<code>@AdditionalConvergenceChecks</code> code block. This method can be
used to implement active-sets algorithms or interior points methods for
multi-surface plasticity or the fixed-point method used by the
<code>StandardElastoViscoplasticity</code> brick for porous
viscoplasticity.</li>
<li>The <code>processNewCorrection</code> is used either to set bounds
on some components of the current correction based on the physical
bounds of the variables or to limit the magnitude of the corrections of
some integration variables. See the
<code>setMaximumIncrementValuePerIteration</code> method for integration
variables or the <code>@MaximumIncrementValuePerIteration</code>
keyword.</li>
<li>The <code>processNewEstimate</code> method is overloaded if some
quantities depend on the current estimation of the integration
variables. A typical example is given by the case of porous viscoplastic
behaviours for which the elastic properties depend on the porosity.</li>
</ul>
</blockquote>
<h3 data-number="2.1.3"
id="sec:tfel_math:TinyNonLinearSolverBase:solveNonLinearSystem"><span
class="header-section-number">2.1.3</span> The
<code>solveNonLinearSystem</code> method</h3>
<p>As highlighted by Figure 4, the <code>solveNonLinearSystem2</code>
methods may fail for many reasons. A very common one is that the current
estimate of the unknowns are unphysical, leading to a failure in the
evaluation of the residual.</p>
<p>The <code>solveNonLinearSystem</code> method implements a simple
algorithm which can be seen as a handcrafted line search method which
greatly improve the robustness of the non-linear solvers. When used
correctly, this method may also be used to increase the performances of
the non-linear solvers (i.e. reduce the total number of iterations).</p>
<figure>
<img src="img/tfel-math/solveNonLinearSystem.svg" style="width:100.0%"
alt="“Flowchart for the resolution of non linear systems proposed by the solveNonLinearSystem of the TinyNonLinearSolverBase class”" />
<figcaption aria-hidden="true">“Flowchart for the resolution of non
linear systems proposed by the <code>solveNonLinearSystem</code> of the
<code>TinyNonLinearSolverBase</code> class”</figcaption>
</figure>
<p>The idea of this hand-crafted linesearch is simply to take the last
correction to the unknowns and divide it by two and restart the core
algorithm. In other words, the search direction is leaved unchanged, but
the norm of the correction is reduced. This operation can be repeated
several times to find a suitable estimate of the unknowns.</p>
<p>Of course, this only works a correction is known, i.e. if the
<code>has_delta_zeros</code> flag is <code>true</code>. Otherwise, this
means that the initial guess of the unknowns is incorrect. In this case,
we just divide this initial guess by zero. This choice may seem
arbitrary but does make sense in most cases of <code>MFront</code>
implicit schemes where the unknowns are almost always the increment of
the state variables: if we divide the increments of the state variables,
their estimates at the middle of the time step tends to theirs values at
the beginning of the time step, which is generally physically
acceptable<a href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>.</p>
<blockquote>
<p><strong>Practical importance</strong></p>
<p>While very simple, the strategy described in this section is in
practice extremely powerful and can be used to easily build very robust
and efficient algorithms based on physical considerations. Let us
consider a few example:</p>
<ul>
<li>If one considers a plastic behaviour, one may want to reject a
prediction of the stress which too largely exceeds the current estimate
of the plastic limit.</li>
<li>If one considers a viscoplastic behaviour, one may want to reject a
prediction of the stress which would lead to an unphysical viscoplastic
strain rate. This is particularly useful with viscoplastic behaviour
having an exponential sensitivity to the stress.</li>
<li>If one considers a plastic behaviour yield surface with sharp
corners, such as the approximations of the Mohr-Coulomb criterion given
by Abbo and Sloan <span class="citation"
data-cites="Abbo1995 Nagel2016">[<a href="#ref-Abbo1995"
role="doc-biblioref">4</a>, <a href="#ref-Nagel2016"
role="doc-biblioref">5</a>]</span>, the solver may fail because the flow
direction may oscillate between too iterations. To solve this issue, we
can simply reject iterations that lead to a large change in the flow
direction.</li>
</ul>
<p>The reader may find an example of such algorithms in the case of a
perfect plastic behaviour based on the Hosford stress criterion on this
page of the <code>MFront</code> gallery: <a
href="https://thelfer.github.io/tfel/web/hosford.html"
class="uri">https://thelfer.github.io/tfel/web/hosford.html</a></p>
</blockquote>
<p>An important caveat to this strategy is link to the use of an
active-set method to describe multi-surface plasticity. The active-set
method makes <em>a priori</em> assumptions on which plastic mechanisms
are active and solve the non-linear equations with those assumptions.
After convergence, those assumptions are checked and some mechanisms may
be activated or deactivated and the non-linear solver is restarted. The
activation of a plastic mechanism can lead the
<code>computeResidual</code> method to fail (as described earlier,
rejecting steps leading to a prediction well beyond the current plastic
limit is generally a good strategy). The trouble here is that the last
correction computed by the solver is very small since the algorithm had
converged. Thus, the strategy implemented by the
<code>solveNonLinearSystem</code> method would divide a correction that
is already almost null. To avoid this caveat, <code>MFront</code>
automatically resets the <code>is_delta_zeros_defined</code> member to
<code>false</code>. More precisely, here is the implementation of the
<code>checkConvergence</code> method when the user has defined
additional convergence checks:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> checkConvergence<span class="op">(</span><span class="at">const</span> NumericType error<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> converged <span class="op">=</span> error <span class="op">&lt;</span> <span class="kw">this</span><span class="op">-&gt;</span>epsilon<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> mfront_internals_converged <span class="op">=</span> converged<span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">-&gt;</span>additionalConvergenceChecks<span class="op">(</span>converged<span class="op">,</span> error<span class="op">);</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span><span class="op">((</span>mfront_internals_converged<span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(!</span>converged<span class="op">)){</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">-&gt;</span>is_delta_zeros_defined <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 class="unnumbered" id="references">References</h1>
<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-abrahams_cxx_2004" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div
class="csl-right-inline"><span class="smallcaps">Abrahams</span>, David
and <span class="smallcaps">Gurtovoy</span>, Aleksey. C++ template
metaprogramming: Concepts, tools, and techniques from boost and beyond.
Boston : Addison-Welsley, 2004. ISBN 0321227255 9780321227256. </div>
</div>
<div id="ref-veldhuizen_techniques_1999" class="csl-entry"
role="listitem">
<div class="csl-left-margin">2. </div><div
class="csl-right-inline"><span class="smallcaps">Veldhuizen</span>,
Todd. Techniques for <span>Scientific</span> <span>C</span>++. 1999.
</div>
</div>
<div id="ref-coplien_curiously_1995" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div
class="csl-right-inline"><span class="smallcaps">Coplien</span>, James
O. Curiously recurring template patterns. <em>C++ Report</em>. 1995.
Vol. 7, no. 2, p. 24–27. </div>
</div>
<div id="ref-Abbo1995" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div
class="csl-right-inline"><span class="smallcaps">Abbo</span>, A. J. and
<span class="smallcaps">Sloan</span>, S. W. <span class="nocase">A
smooth hyperbolic approximation to the Mohr-Coulomb yield
criterion</span>. <em>Computers <span>&amp;</span> Structures</em>.
February 1995. Vol. 54, no. 3, p. 427–441. DOI <a
href="https://doi.org/10.1016/0045-7949(94)00339-5">10.1016/0045-7949(94)00339-5</a>.
Available from: <a
href="http://linkinghub.elsevier.com/retrieve/pii/0045794994003395">http://linkinghub.elsevier.com/retrieve/pii/0045794994003395</a></div>
</div>
<div id="ref-Nagel2016" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div><div
class="csl-right-inline"><span class="smallcaps">Nagel</span>, Thomas,
<span class="smallcaps">Minkley</span>, Wolfgang, <span
class="smallcaps">Böttcher</span>, Norbert, <span
class="smallcaps">Naumov</span>, Dmitri, <span
class="smallcaps">Görke</span>, Uwe-Jens and <span
class="smallcaps">Kolditz</span>, Olaf. <span class="nocase">Implicit
numerical integration and consistent linearization of inelastic
constitutive models of rock salt</span>. <em>Computers
<span>&amp;</span> Structures</em>. April 2017. Vol. 182, p. 87–103.
DOI <a
href="https://doi.org/10.1016/j.compstruc.2016.11.010">10.1016/j.compstruc.2016.11.010</a>.
Available from: <a
href="http://www.scopus.com/inward/record.url?eid=2-s2.0-85006482432{\&amp;}partnerID=MN8TOARS http://linkinghub.elsevier.com/retrieve/pii/S0045794916306319">http://www.scopus.com/inward/record.url?eid=2-s2.0-85006482432{\&amp;}partnerID=MN8TOARS
http://linkinghub.elsevier.com/retrieve/pii/S0045794916306319</a></div>
</div>
</div>
<aside id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>This is the reason why, by default, the initial guess of
the unknowns in <code>MFront</code> is simply a null vector. The user
may specify an initial guess for the unknowns using the
<code>@Predictor</code> code block, although this is seldom used.<a
href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-62273823-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
