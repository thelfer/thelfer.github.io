<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-EN" xml:lang="en-EN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Extending the StandardElastoViscoPlasticity brick with a new porous stress criterion</title>
        <meta name="author" content="Thomas Helfer, Jérémy Hure, Mohamed Shokeir" />
            <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <style type="text/css">code{white-space: pre;}</style>
            <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {  background-color: #f8f8f8; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ef2929; } /* Alert */
      code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #204a87; } /* Attribute */
      code span.bn { color: #0000cf; } /* BaseN */
      code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4e9a06; } /* Char */
      code span.cn { color: #8f5902; } /* Constant */
      code span.co { color: #8f5902; font-style: italic; } /* Comment */
      code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
      code span.dt { color: #204a87; } /* DataType */
      code span.dv { color: #0000cf; } /* DecVal */
      code span.er { color: #a40000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #0000cf; } /* Float */
      code span.fu { color: #204a87; font-weight: bold; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
      code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
      code span.ot { color: #8f5902; } /* Other */
      code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
      code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
      code span.ss { color: #4e9a06; } /* SpecialString */
      code span.st { color: #4e9a06; } /* String */
      code span.va { color: #000000; } /* Variable */
      code span.vs { color: #4e9a06; } /* VerbatimString */
      code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
            <link rel="stylesheet" href="css/normalize.css"/>
    <link rel="stylesheet" href="css/main.css"/>
        <script
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
        type="text/javascript"></script>
          </head>
  <body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
        <header>
      <ul id="nav">
	<li><a href="news.html">News</a></li>
	<li><a href="index.html">Overview</a>
	  <ul>
	    <li><a>Domain specific languages</a>
	      <ul>
		<li><a href="material-properties.html">Material properties</a></li>
		<li><a href="behaviours.html">Mechanical behaviours</a></li>
		<li><a href="models.html">Models</a></li>
	      </ul>
            </li>
	    <li><a href="interfaces.html">Available interfaces</a></li>
	    <li><a href="associated-projects.html">Associated projects</a></li>
     	    <li><a>Tools</a>
	      <ul>
	        <li><a href="mfront-doc.html">mfront-doc</a></li>
	        <li><a href="mtest.html">mtest</a></li>
	        <li><a href="mfm.html">mfm</a></li>
	        <li><a href="mfm-test-generator.html">mfm-test-generator</a></li>
	        <li><a href="tfel-check.html">tfel-check</a></li>
	      </ul>
	    </li>
	  </ul>
	</li>
	<li><a>Getting started</a>
	  <ul>
	    <li><a href="https://github.com/thelfer/tfel/">Github repository</a></li>
	    <li><a href="https://github.com/thelfer/tfel/releases">Download</a></li>
	    <li><a href="release-notes.html">Release notes</a>
	      <ul>
		<li><a>Versions 2.0.x</a>
                  <ul>
                    <li><a href="release-notes.html">Versions prior to 2.0.5</a></li>
	 	    <li><a href="release-notes-2.0.5.html">Version 2.0.5</a></li>
                  </ul>
		</li>
		<li><a>Versions 3.0.x</a>
                  <ul>
		    <li><a href="release-notes-3.0.html">Version 3.0.0</a></li>
		    <li><a href="release-notes-3.0.1.html">Version 3.0.1</a></li>
		    <li><a href="release-notes-3.0.2.html">Version 3.0.2</a></li>
		    <li><a href="release-notes-3.0.3.html">Version 3.0.3</a></li>
		    <li><a href="release-notes-3.0.4.html">Version 3.0.4</a></li>
		    <li><a href="release-notes-3.0.5.html">Version 3.0.5</a></li>
		    <li><a href="release-notes-3.0.6.html">Version 3.0.6</a></li>
		    <li><a href="release-notes-3.0.7.html">Version 3.0.7</a></li>
		    <li><a href="release-notes-3.0.8.html">Version 3.0.8</a></li>
		    <li><a href="release-notes-3.0.9.html">Version 3.0.9</a></li>
		    <li><a href="release-notes-3.0.10.html">Version 3.0.10</a></li>
		    <li><a href="release-notes-3.0.11.html">Version 3.0.11</a></li>
		    <li><a href="release-notes-3.0.12.html">Version 3.0.12</a></li>
		    <li><a href="release-notes-3.0.13.html">Version 3.0.13</a></li>
		    <li><a href="release-notes-3.0.14.html">Version 3.0.14</a></li>
		    <li><a href="release-notes-3.0.15.html">Version 3.0.15</a></li>
		    <li><a href="release-notes-3.0.16.html">Version 3.0.16</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.1.x</a>
		  <ul>
		    <li><a href="release-notes-3.1.html">Version 3.1.0</a></li>
		    <li><a href="release-notes-3.1.1.html">Version 3.1.1</a></li>
		    <li><a href="release-notes-3.1.2.html">Version 3.1.2</a></li>
		    <li><a href="release-notes-3.1.3.html">Version 3.1.3</a></li>
		    <li><a href="release-notes-3.1.4.html">Version 3.1.4</a></li>
		    <li><a href="release-notes-3.1.5.html">Version 3.1.5</a></li>
		    <li><a href="release-notes-3.1.6.html">Version 3.1.6</a></li>
		    <li><a href="release-notes-3.1.7.html">Version 3.1.7</a></li>
		    <li><a href="release-notes-3.1.8.html">Version 3.1.8</a></li>
		    <li><a href="release-notes-3.1.9.html">Version 3.1.9</a></li>
		    <li><a href="release-notes-3.1.10.html">Version 3.1.10</a></li>
		    <li><a href="release-notes-3.1.11.html">Version 3.1.11</a></li>
		    <li><a href="release-notes-3.1.12.html">Version 3.1.12</a></li>
		    <li><a href="release-notes-3.1.13.html">Version 3.1.13</a></li>
		    <li><a href="release-notes-3.1.14.html">Version 3.1.14</a></li>
		    <li><a href="release-notes-3.1.15.html">Version 3.1.15</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.2.x</a>
		  <ul>
		    <li><a href="release-notes-3.2.html">Version 3.2.0</a></li>
		    <li><a href="release-notes-3.2.1.html">Version 3.2.1</a></li>
		    <li><a href="release-notes-3.2.2.html">Version 3.2.2</a></li>
		    <li><a href="release-notes-3.2.3.html">Version 3.2.3</a></li>
		    <li><a href="release-notes-3.2.4.html">Version 3.2.4</a></li>
		    <li><a href="release-notes-3.2.5.html">Version 3.2.5</a></li>
		    <li><a href="release-notes-3.2.6.html">Version 3.2.6</a></li>
		    <li><a href="release-notes-3.2.7.html">Version 3.2.7</a></li>
		    <li><a href="release-notes-3.2.8.html">Version 3.2.8</a></li>
		    <li><a href="release-notes-3.2.9.html">Version 3.2.9</a></li>
		    <li><a href="release-notes-3.2.10.html">Version 3.2.10</a></li>
		    <li><a href="release-notes-3.2.11.html">Version 3.2.11</a></li>
		    <li><a href="release-notes-3.2.12.html">Version 3.2.12</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.3.x</a>
		  <ul>
		    <li><a href="release-notes-3.3.html">Version 3.3.0</a></li>
		    <li><a href="release-notes-3.3.1.html">Version 3.3.1</a></li>
		    <li><a href="release-notes-3.3.1.html">Version 3.3.2</a></li>
		    <li><a href="release-notes-3.3.2.html">Version 3.3.2</a></li>
		    <li><a href="release-notes-3.3.3.html">Version 3.3.3</a></li>
		    <li><a href="release-notes-3.3.4.html">Version 3.3.4</a></li>
		    <li><a href="release-notes-3.3.5.html">Version 3.3.5</a></li>
		    <li><a href="release-notes-3.3.6.html">Version 3.3.6</a></li>
		    <li><a href="release-notes-3.3.7.html">Version 3.3.7</a></li>
		  </ul>
		</li>
		<li><a>Versions 3.4.x</a>
		  <ul>
		    <li><a href="release-notes-3.4.html">Version 3.4.0</a></li>
		    <li><a href="release-notes-3.4.1.html">Version 3.4.1</a></li>
		    <li><a href="release-notes-3.4.2.html">Version 3.4.2</a></li>
		    <li><a href="release-notes-3.4.3.html">Version 3.4.3</a></li>
		    <li><a href="release-notes-3.4.4.html">Version 3.4.4</a></li>
		    <li><a href="release-notes-3.4.5.html">Version 3.4.5</a></li>
		    <li><a href="release-notes-3.4.6.html">Version 3.4.6</a></li>
		    <li><a href="release-notes-3.4.7.html">Version 3.4.7</a></li>
		    <li><a href="release-notes-3.4.8.html">Version 3.4.8</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.0.x</a>
		  <ul>
		    <li><a href="release-notes-4.0.html">Version 4.0.0</a></li>
		    <li><a href="release-notes-4.0.1.html">Version 4.0.1</a></li>
		    <li><a href="release-notes-4.0.2.html">Version 4.0.2</a></li>
		    <li><a href="release-notes-4.0.3.html">Version 4.0.3</a></li>
		    <li><a href="release-notes-4.0.4.html">Version 4.0.4</a></li>
		    <li><a href="release-notes-4.0.5.html">Version 4.0.5</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.1.x</a>
		  <ul>
		    <li><a href="release-notes-4.1.html">Version 4.1.0</a></li>
		    <li><a href="release-notes-4.1.1.html">Version 4.1.1</a></li>
		    <li><a href="release-notes-4.1.2.html">Version 4.1.2</a></li>
		    <li><a href="release-notes-4.1.3.html">Version 4.1.3</a></li>
		    <li><a href="release-notes-4.1.4.html">Version 4.1.4</a></li>
		    <li><a href="release-notes-4.1.5.html">Version 4.1.5</a></li>
		  </ul>
		</li>
		<li><a>Versions 4.2.x</a>
		  <ul>
		    <li><a href="release-notes-4.2.html">Version 4.2.0</a></li>
		    <li><a href="release-notes-4.2.1.html">Version 4.2.1</a></li>
		    <li><a href="release-notes-4.2.2.html">Version 4.2.2</a></li>
		    <li><a href="release-notes-4.2.3.html">Version 4.2.3</a></li>
		  </ul>
		</li>
		<li><a>Versions 5.0.x</a>
		  <ul>
		    <li><a href="release-notes-5.0.html">Version 5.0.0</a></li>
		    <li><a href="release-notes-5.0.1.html">Version 5.0.1</a></li>
		    <li><a href="release-notes-5.0.2.html">Version 5.0.2</a></li>
		  </ul>
		</li>
		<li><a>Versions 5.1.x</a>
		  <ul>
		    <li><a href="release-notes-5.1.html">Version 5.1.0</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a href="coverity-scan.html">Coverity scan</a></li>
	    <li><a href="install.html">Installation</a></li>
	  </ul>
	</li>
	<li><a>Documentation</a>
	  <ul>
	    <li><a href="documentations.html">General documentation</a></li>
	    <li><a href="gallery.html">Gallery</a></li>
<!--	    
	    <li><a href="http://tfel.sourceforge.net/doxygen/index.html">Doxygen documentation</a></li>
-->
	    <li><a>Behaviours</a>
	      <ul>
		<li><a href="tutorial.html">Tutorial</a></li>
		<li><a href="implicit-dsl.html">The Implicit DSL</a></li>
		<li><a href="benchmark.html">Benchmark</a></li>
		<li><a href="parameters.html">Parameters</a></li>
		<li><a href="BehaviourBricks.html">Behaviour bricks</a></li>
		<li><a href="interfaces.html">Solver interfaces</a>
		  <ul>
		    <li><a href="castem.html">Cast3M</a></li>
		    <li><a href="amitex.html">AMITEX_FFTP</a></li>
		    <li><a href="aster.html">Code-Aster</a></li>
    		    <li><a href="abaqus.html">Abaqus</a></li>
		    <li><a href="zmat.html">ZeBuLoN</a></li>
   		    <li><a href="calculix.html">CalculiX</a></li>
		    <!-- <li><a >TMFFT</a></li> -->
		    <li><a href="cyrano.html">Cyrano</a></li>
   		    <li><a href="generic-material-property-interface.html">Generic interface for material properties</a></li>
   		    <li><a href="generic-behaviours-interface.html">Generic interface for behaviours</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a>TFEL libraries</a>
	      <ul>
		<li><a href="libraries_usage.html">Usage of the TFEL libraries in C++</a></li>
		<li><a href="tfel-math.html">TFEL/Math</a></li>
		<li><a href="tfel-material.html">TFEL/Material</a></li>
	      </ul>
	    </li>
	    <li><a>Python modules</a>
	      <ul>
		<li><a href="tfel-python.html">TFEL modules</a></li>
		<li><a href="mfront-python.html">mfront module</a></li>
		<li><a href="mtest-python.html">mtest module</a></li>
	      </ul>
	    </li>
	    <li><a>MFront keywords</a>
	      <ul>
	        <li><a href="Default-keywords.html">Default</a></li>
	        <li><a href="DefaultCZM-keywords.html">DefaultCZM</a></li>
	        <li><a href="DefaultFiniteStrain-keywords.html">DefaultFiniteStrain</a></li>
	        <li><a href="DefaultGenericBehaviour-keywords.html">DefaultGenericBehaviour</a></li>
	        <li><a href="DefaultModel-keywords.html">DefaultModel</a></li>
	        <li><a href="Implicit-keywords.html">Implicit</a></li>
	        <li><a href="ImplicitCZM-keywords.html">ImplicitCZM</a></li>
	        <li><a href="ImplicitFiniteStrain-keywords.html">ImplicitFiniteStrain</a></li>
	        <li><a href="ImplicitGenericBehaviour-keywords.html">ImplicitGenericBehaviour</a></li>
	        <li><a href="ImplicitModel-keywords.html">ImplicitModel</a></li>
	        <li><a href="ImplicitII-keywords.html">ImplicitII</a></li>
	        <li><a href="IsotropicMisesCreep-keywords.html">IsotropicMisesCreep</a></li>
	        <li><a href="IsotropicMisesPlasticFlow-keywords.html">IsotropicMisesPlasticFlow</a></li>
	        <li><a href="IsotropicPlasticMisesFlow-keywords.html">IsotropicPlasticMisesFlow</a></li>
	        <li><a href="IsotropicStrainHardeningMisesCreep-keywords.html">IsotropicStrainHardeningMisesCreep</a></li>
	        <li><a href="MaterialLaw-keywords.html">MaterialLaw</a></li>
	        <li><a href="MaterialProperty-keywords.html">MaterialProperty</a></li>
	        <li><a href="Model-keywords.html">Model</a></li>
	        <li><a href="MultipleIsotropicMisesFlows-keywords.html">MultipleIsotropicMisesFlows</a></li>
	        <li><a href="RungeKutta-keywords.html">RungeKutta</a></li>
	        <li><a href="RungeKuttaFiniteStrain-keywords.html">RungeKuttaFiniteStrain</a></li>
	        <li><a href="RungeKuttaGenericBehaviour-keywords.html">RungeKuttaGenericBehaviour</a></li>
	        <li><a href="RungeKuttaModel-keywords.html">RungeKuttaModel</a></li>
	      </ul>
	    </li>
	    <li><a href="MTest-keywords.html">MTest keywords</a></li>
	    <li><a href="physical-constants.html">Physical constants</a></li>
	    <li><a href="glossary.html">Glossary</a></li>
	    <li><a href="publications.html">Publications</a></li>
	    <li><a href="faq.html">FAQ</a></li>
	    <li><a href="about.html">About</a></li>
	  </ul>
	</li>
	<li><a>Contributing</a>
	  <ul>
	    <li><a href="https://github.com/thelfer/tfel">Access to sources</a></li>
	    <li><a href="contributing.html">Contributing guidelines</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Report bugs</a></li>
	  </ul>
	</li>
	<li><a>Getting Help</a>
	  <ul>
	    <li><a href="search.html">Search on this site</a></li>
	    <li><a href="https://github.com/thelfer/tfel/discussions">Forum</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Bug report</a></li>
	    <li><a href="https://github.com/thelfer/tfel/issues">Feature request</a></li>
	    <li><a href="mailto:tfel-contact@cea.fr">Contact</a></li>
	  </ul>
	</li>
      </ul>
    </header>
<div id="header">
<h1 class="title">Extending the
<code>StandardElastoViscoPlasticity</code> brick with a new porous
stress criterion</h1>
<h2 class="author">Thomas Helfer, Jérémy Hure, Mohamed Shokeir</h2>
<h3 class="date">07/2020</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#extending-the-tfelmaterial-library"
id="toc-extending-the-tfelmaterial-library"><span
class="toc-section-number">1</span> Extending the
<code>TFEL/Material</code> library</a>
<ul>
<li><a href="#template-files" id="toc-template-files"><span
class="toc-section-number">1.1</span> Template files</a></li>
<li><a
href="#creating-a-proper-working-directory-for-the-example-of-the-so-called-hollow-sphere-criterion-proposed-by-michel-and-suquet"
id="toc-creating-a-proper-working-directory-for-the-example-of-the-so-called-hollow-sphere-criterion-proposed-by-michel-and-suquet"><span
class="toc-section-number">1.2</span> Creating a proper working
directory for the example of the so-called hollow sphere criterion
proposed by Michel and Suquet</a></li>
<li><a
href="#implementing-the-michel-and-suquet-hollow-sphere-stress-criterion"
id="toc-implementing-the-michel-and-suquet-hollow-sphere-stress-criterion"><span
class="toc-section-number">1.3</span> Implementing the Michel and
Suquet’ hollow sphere stress criterion</a></li>
<li><a href="#testing-the-derivatives-advanced-and-optional"
id="toc-testing-the-derivatives-advanced-and-optional"><span
class="toc-section-number">1.4</span> Testing the derivatives (advanced
and optional)</a></li>
<li><a href="#modifying-the-mfront-implementations"
id="toc-modifying-the-mfront-implementations"><span
class="toc-section-number">1.5</span> Modifying the <code>MFront</code>
implementations</a></li>
</ul></li>
<li><a href="#extending-the-tfelmfront-library"
id="toc-extending-the-tfelmfront-library"><span
class="toc-section-number">2</span> Extending the
<code>TFELMFront</code> library</a>
<ul>
<li><a href="#updating-the-working-directory"
id="toc-updating-the-working-directory"><span
class="toc-section-number">2.1</span> Updating the working
directory</a></li>
<li><a href="#adding-the-stress-criterion-options"
id="toc-adding-the-stress-criterion-options"><span
class="toc-section-number">2.2</span> Adding the stress criterion
options</a></li>
<li><a href="#compilation-of-the-mfront-plugin"
id="toc-compilation-of-the-mfront-plugin"><span
class="toc-section-number">2.3</span> Compilation of the
<code>MFront</code> plugin</a></li>
<li><a href="#testing-the-plugin" id="toc-testing-the-plugin"><span
class="toc-section-number">2.4</span> Testing the plugin</a></li>
</ul></li>
<li><a href="#applications-to-uranimum-dioxyde-viscoplastic-behaviours"
id="toc-applications-to-uranimum-dioxyde-viscoplastic-behaviours"><span
class="toc-section-number">3</span> Applications to uranimum dioxyde
viscoplastic behaviours</a>
<ul>
<li><a href="#implementation-of-salvo-viscoplastic-behaviour"
id="toc-implementation-of-salvo-viscoplastic-behaviour"><span
class="toc-section-number">3.1</span> Implementation of Salvo’
viscoplastic behaviour</a></li>
<li><a
href="#coupling-of-the-salvo-viscoplastic-behaviour-with-the-ddif2-damage-law"
id="toc-coupling-of-the-salvo-viscoplastic-behaviour-with-the-ddif2-damage-law"><span
class="toc-section-number">3.2</span> Coupling of the Salvo’
viscoplastic behaviour with the <code>DDIF2</code> damage law</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>
<p>This document gives some insights on how a user may extend the
<code>StandardElastoViscoPlasticity</code> brick by adding a new stress
criterion coupled with porosity evolution.</p>
<p>The <code>StandardElastoViscoPlasticity</code> brick is fully
described <a
href="StandardElastoViscoPlasticityBrick.html">here</a>.</p>
<p>Introducing a new porous stress criterion in the
<code>StandardElastoViscoPlasticity</code> brick has two main steps:</p>
<ul>
<li>Extending the <code>TFEL/Material</code> library.</li>
<li>Extending the <code>TFELMFront</code> library.</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>This tutorial only covers <em>isotropic</em> stress criteria.
Orthotropic stress criteria requires to take care of the orthotropic
axes convention.</p>
<p>See the documentation of the <code>@OrthotropicBehaviour</code>
keyword for details:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mfront</span> <span class="at">--help-keyword</span><span class="op">=</span>Implicit:@OrthotropicBehaviour</span></code></pre></div>
</blockquote>
<p>Those steps are illustrated by the implementation so-called hollow
sphere criterion proposed by Michel and Suquet which describe the
macroscopic viscoplasticty of a porous material by the following law
(see <span class="citation" data-cites="michel_constitutive_1992">[<a
href="#ref-michel_constitutive_1992"
role="doc-biblioref">1</a>]</span>):</p>
<p>The viscoplastic strain rate is defined by:</p>
<p><span class="math display">\[
\underline{\dot{\varepsilon}}^{\mathrm{vp}}=\dot{\varepsilon}_{0}\,{\left({{\displaystyle
\frac{\displaystyle \sigma_{\mathrm{eq}}^{MS}}{\displaystyle
\sigma_{0}}}}\right)}^{E}\,\underline{n}^{MS}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\dot{\varepsilon}_{0}\)</span> is a
reference strain rate which shall be identified.</li>
<li><span class="math inline">\(\sigma_{0}\)</span> is a reference
stress used to normalise the stress.</li>
<li><span class="math inline">\(E\)</span> is the Norton exponent.</li>
</ul>
<p>The stress criterion <span
class="math inline">\(\sigma_{\mathrm{eq}}^{MS}\)</span> is defined
by:</p>
<p><span class="math display">\[
\sigma_{\mathrm{eq}}^{MS}=\sqrt{{{\displaystyle \frac{\displaystyle
9}{\displaystyle
4}}}\,A{\left(f\right)}\,p^{2}+B{\left(f\right)}\,\sigma_{\mathrm{eq}}^{2}}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(p\)</span> is the hydrostatic pressure
(<span class="math inline">\(p={{\displaystyle \frac{\displaystyle
1}{\displaystyle
3}}}{\mathrm{tr}{\left(\underline{\sigma}\right)}}\)</span>).</li>
<li><span class="math inline">\(\sigma_{\mathrm{eq}}\)</span> is the von
Mises stress.</li>
<li><span
class="math inline">\(A{\left(f\right)}={\left(n\,{\left(f^{-1/n}-1\right)}\right)}^{\frac{-2\,n}{n+1}}\)</span></li>
<li><span
class="math inline">\(B{\left(f\right)}={\left(1+{{\displaystyle
\frac{\displaystyle 2}{\displaystyle
3}}}\,f\right)}\,{\left(1-f\right)}^{\frac{-2\,n}{n+1}}\)</span></li>
<li><span class="math inline">\(n\)</span> is the Norton exponent of the
matrix</li>
</ul>
<p>This flow is associated, to the flow direction is given by:</p>
<p><span class="math display">\[
\underline{n}^{MS}={\displaystyle \frac{\displaystyle \partial
\sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial \underline{\sigma}}}
\]</span></p>
<blockquote>
<p><strong>Implicit schemes</strong></p>
<p>This document assumes that the reader has prior knowledge on how the
integrate a behaviour using an implicit scheme with
<code>MFront</code>.</p>
<p>Appropriate introductory materials are given in the <a
href="gallery.html">gallery</a>.</p>
</blockquote>
<h1 data-number="1" id="extending-the-tfelmaterial-library"><span
class="header-section-number">1</span> Extending the
<code>TFEL/Material</code> library</h1>
<h2 data-number="1.1" id="template-files"><span
class="header-section-number">1.1</span> Template files</h2>
<p>We recommend that you use the following template files:</p>
<ul>
<li><a
href="cxx/include/TFEL/Material/PorousStressCriterionTemplate.hxx"><code>PorousStressCriterionTemplate.hxx</code></a></li>
<li><a
href="cxx/include/TFEL/Material/PorousStressCriterionTemplate.ixx"><code>PorousStressCriterionTemplate.ixx</code></a></li>
<li><a
href="mfront/PorousStressCriterionTest.mfront"><code>PorousStressCriterionTest.mfront</code></a></li>
<li><a
href="mfront/PorousStressCriterionTest_NumericalJacobian.mfront"><code>PorousStressCriterionTest_NumericalJacobian.mfront</code></a></li>
</ul>
<p>The first file declares:</p>
<ul>
<li>A set of aliases</li>
<li>A data structure holding the structure associated with the
criterion.</li>
<li>Three functions which allows the computation of:
<ul>
<li>The value of the stress criterion for the given stress state.</li>
<li>The value of the stress criterion and its first derivative for the
given stress state.</li>
<li>The value of the stress criterion and its first and second
derivatives for the given stress state.</li>
</ul></li>
</ul>
<p>The second file give a skeleton required to implement those three
functions.</p>
<p>Implementing a new stress criterion boils down to the following
steps:</p>
<ol type="1">
<li>Rename those file to explicitly indicate the name of the stress
criterion.</li>
<li>Replace the following strings by the appropriate values as described
below:</li>
</ol>
<ul>
<li><code>__Author__</code></li>
<li><code>__Date__</code></li>
<li><code>__PorousStressCriterionName__</code></li>
<li><code>__STRESS_CRITERION_NAME__</code></li>
</ul>
<ol start="3" type="1">
<li>Implement the three previous functions</li>
<li>Test your implementation in <code>MFront</code> and
<code>MTest</code> (or your favorite solver).</li>
</ol>
<h2 data-number="1.2"
id="creating-a-proper-working-directory-for-the-example-of-the-so-called-hollow-sphere-criterion-proposed-by-michel-and-suquet"><span
class="header-section-number">1.2</span> Creating a proper working
directory for the example of the so-called hollow sphere criterion
proposed by Michel and Suquet</h2>
<p>In this paragraph, we detail Steps 1 and 2. for the case of the
so-called hollow sphere criterion proposed by Michel and Suquet
criterion (see <span class="citation"
data-cites="michel_constitutive_1992">[<a
href="#ref-michel_constitutive_1992" role="doc-biblioref">1</a>]</span>)
which will be used as an illustrative example throughout this document.
We describe all those steps in details and finally gives a shell script
that automates the whole process for <code>LiNuX</code> users. When
providing command line examples, we assume that the shell is
<code>bash</code>.</p>
<p>The header files <code>PorousStressCriterionTemplate.hxx</code> and
<code>PorousStressCriterionTemplate.ixx</code> are placed in a
subdirectory called <code>include/TFEL/Material</code> and renamed
respectively
<code>MichelAndSuquet1992HollowSphereTestStressCriterionTest.hxx</code>
and
<code>MichelAndSuquet1992HollowPorousStressCriterionTest.ixx</code>.</p>
<p>The <code>MFront</code> template files must be copied in the working
directory and renamed appropriatly.</p>
<p>This can be done by taping the following commands in the terminal
(under <code>LiNuX</code> or <code>Mac Os</code>):</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> include/TFEL/Material</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> tests/test1</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mv PorousStressCriterionTemplate.hxx <span class="dt">\</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>     include/TFEL/Material/MichelAndSuquet1992HollowSphereTestStressCriterion.hxx</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mv PorousStressCriterionTemplate.ixx <span class="dt">\</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>     include/TFEL/Material/MichelAndSuquet1992HollowSphereTestStressCriterion.ixx</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mv PorousStressCriterionTest.mfront <span class="dt">\</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>     tests/test1/MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mv PorousStressCriterionTest_NumericalJacobian.mfront <span class="dt">\</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>     tests/test1/MichelAndSuquet1992HollowSphereTestViscoPlasticity_NumericalJacobian.mfront</span></code></pre></div>
<p>The working directory is thus organized as follows:</p>
<p><img
src="img/ExtendingStandardElastoViscoPlasticityBrick-PorousStressCriterion-tree.png"
style="width:100.0%" /></p>
<p>In all those files, we now replace</p>
<ul>
<li><code>__Author__</code> by
<code>Thomas Helfer, Jérémy Hure, Mohamed Shokeir</code></li>
<li><code>__Date__</code> by <code>20/07/2020</code></li>
<li><code>__StressCriterionName__</code> by
<code>MichelAndSuquet1992HollowSphereTest</code></li>
<li><code>__STRESS_CRITERION_NAME__</code> by
<code>MICHEL_SUQUET_1992_HOLLOW_SPHERE_TEST</code></li>
</ul>
<p>You may use your favourite text-editor to do this or use the
following command (for <code>LiNuX</code> users) :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> <span class="va">$(</span><span class="fu">find</span> . <span class="at">-type</span> f<span class="va">)</span><span class="kw">;</span>                                                <span class="dt">\</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> <span class="fu">sed</span> <span class="at">-i</span>                                                                  <span class="dt">\</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> <span class="st">&#39;s|__Author__|Thomas Helfer, Jérémy Hure, Mohamed Shokeir|g;&#39;</span>         <span class="dt">\</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> <span class="st">&#39;s|__Date__|24/03/2020|g;&#39;</span>                                            <span class="dt">\</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> <span class="st">&#39;s|__StressCriterionName__|MichelAndSuquet1992HollowSphereTest|g;&#39;</span>                        <span class="dt">\</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> <span class="st">&#39;s|__STRESS_CRITERION_NAME__|MICHEL_SUQUET_1992_HOLLOW_SPHERE_TEST|g&#39;</span> <span class="va">$f</span> <span class="kw">;</span> <span class="dt">\</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>All those steps are summarized in the following script, which can be
downloaded <a href="scripts/generate-porous.sh">here</a>.</p>
<p>In conclusion, a recommended for starting the development of the a
new stress criterion is to download the previous script, modify
appropriately the first lines to match your need and run it.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>At this stage, you shall already be able to verify that the provided
<code>MFront</code> implementations barely compiles by typing in the
<code>tests/test1</code> directory:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mfront</span> <span class="at">-I</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include <span class="at">--obuild</span> <span class="dt">\</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">--interface</span><span class="op">=</span>generic        <span class="dt">\</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>       MichelAndSuquet1992HollowSphereTestPerfectPlasticity.mfront</span></code></pre></div>
<p>Note the <code>-I $(pwd)/../../include</code> flags which allows
<code>MFront</code> to find the header files implementing the stress
criterion (In <code>bash</code>, <code>$(pwd)</code> return the current
directory).</p>
</blockquote>
<h2 data-number="1.3"
id="implementing-the-michel-and-suquet-hollow-sphere-stress-criterion"><span
class="header-section-number">1.3</span> Implementing the Michel and
Suquet’ hollow sphere stress criterion</h2>
<p>In this paragraph, we detail all the steps required to implement the
Michel and Suquet’ hollow sphere stress criterion. In a new directory,
we just follow the steps given by the previous paragraph:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://thelfer.github.io/tfel/web/scripts/generate-porous.sh</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x generate-porous.sh</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./generate-porous.sh</span></span></code></pre></div>
<h3 data-number="1.3.1"
id="modifying-the-michelandsuquet1992hollowsphereteststresscriterionparameters-data-structure"><span
class="header-section-number">1.3.1</span> Modifying the
<code>MichelAndSuquet1992HollowSphereTestStressCriterionParameters</code>
data structure</h3>
<p>The
<code>MichelAndSuquet1992HollowSphereTestStressCriterionParameters</code>
data structure, declared in
<code>MichelAndSuquet1992HollowSphereTestStressCriterion.hxx</code>,
must contain the values of the Norton exponent of the matrix <span
class="math inline">\(n\)</span>.</p>
<p>In the implementation, we will also need to define two small
values:</p>
<ul>
<li><code>feps</code>, which will be used to tell if the porosity is
closed to its physical bounds, <span class="math inline">\(0\)</span>
and <span class="math inline">\(1\)</span>.</li>
<li><code>feps2</code>, which will be used to regularise the derivative
<span class="math inline">\({\displaystyle \frac{\displaystyle \partial
A}{\displaystyle \partial f}}\)</span> as described below.</li>
</ul>
<p>We modify it as follows:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> StressStensor<span class="op">&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">//! a simple alias</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> real <span class="op">=</span> MichelAndSuquet1992HollowSphereTestBaseType<span class="op">&lt;</span>StressStensor<span class="op">&gt;;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">//! </span><span class="an">\brief</span><span class="co"> </span><span class="an">\f$</span><span class="co">n</span><span class="an">\f$</span><span class="co"> is the Norton exponent of the matrix</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  real n<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">//! </span><span class="an">\brief</span><span class="co"> </span><span class="an">\f$</span><span class="co">feps</span><span class="an">\f$</span><span class="co"> is a small numerical parameter</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  real feps <span class="op">=</span> real<span class="op">(</span><span class="fl">1e-14</span><span class="op">);</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">//! </span><span class="an">\brief</span><span class="co"> </span><span class="an">\f$</span><span class="co">feps</span><span class="an">\f$</span><span class="co"> is a small numerical parameter</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  real feps2 <span class="op">=</span> real<span class="op">(</span><span class="fl">1e-5</span><span class="op">);</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span>  <span class="co">// end of struct MichelAndSuquet1992HollowSphereTestStressCriterionParameters</span></span></code></pre></div>
<p>This is the only modification of the
<code>MichelAndSuquet1992HollowSphereTestStressCriterion.hxx</code>
file.</p>
<h3 data-number="1.3.2"
id="include-tfelmathgeneralieee754.hxx-header"><span
class="header-section-number">1.3.2</span> Include
<code>TFEL/Math/General/IEEE754.hxx</code> header</h3>
<p>The <code>TFEL/Math/General/IEEE754.hxx</code> header reimplements a
set of standard functions which does not work as expected under
<code>gcc</code> when the <code>-ffast-math</code> flag is used.</p>
<p>The header must be included at the top of the
<code>MichelAndSuquet1992HollowSphereTestStressCriterion.ixx</code> file
as follows:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;TFEL/Math/General/IEEE754.hxx&quot;</span></span></code></pre></div>
<h3 data-number="1.3.3"
id="implementing-the-output-stream-operator-for-the-michelandsuquet1992hollowsphereteststresscriterionparameters-data-structure"><span
class="header-section-number">1.3.3</span> Implementing the output
stream operator for the
<code>MichelAndSuquet1992HollowSphereTestStressCriterionParameters</code>
data structure</h3>
<p>The output stream operator must now be implemented in the
<code>MichelAndSuquet1992HollowSphereTestStressCriterion.ixx</code>
file:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> StressStensor<span class="op">&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>ostream <span class="op">&amp;</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="bu">std::</span>ostream <span class="op">&amp;</span>os<span class="op">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters<span class="op">&lt;</span>StressStensor<span class="op">&gt;</span> <span class="op">&amp;</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  os <span class="op">&lt;&lt;</span> <span class="st">&quot;{n: &quot;</span> <span class="op">&lt;&lt;</span> p<span class="op">.</span>n <span class="op">&lt;&lt;</span> <span class="st">&quot;, feps: &quot;</span> <span class="op">&lt;&lt;</span> p<span class="op">.</span>feps <span class="op">&lt;&lt;</span> <span class="st">&quot;, feps2: &quot;</span> <span class="op">&lt;&lt;</span> p<span class="op">.</span>feps2 <span class="op">&lt;&lt;</span> <span class="st">&quot;}&quot;</span><span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> os<span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// end of operator&lt;&lt;</span></span></code></pre></div>
<p>This operator is useful when compiling <code>MFront</code> files in
<code>debug</code> mode.</p>
<h3 data-number="1.3.4"
id="implementing-the-computemichelandsuquet1992hollowsphereteststress-function"><span
class="header-section-number">1.3.4</span> Implementing the
<code>computeMichelAndSuquet1992HollowSphereTestStress</code>
function</h3>
<p>The <code>computeMichelAndSuquet1992HollowSphereTestStress</code>
function is implemented in the
<code>MichelAndSuquet1992HollowSphereTestStressCriterion.ixx</code>
file.</p>
<p>The main difficulty is the computation of <span
class="math inline">\(A{\left(f\right)}\)</span> when the porosity ends
toward <span class="math inline">\(0\)</span>. The limit is well
defined, but the intermediate expression <span
class="math inline">\(f^{-1/n}\)</span> is undefined. To avoid this
issue, we will use the following approximated expression:</p>
<p><span class="math display">\[
A_{\varepsilon}{\left(f\right)}={\left(n\,{\left(A_{0}{\left(f\right)}-1\right)}\right)}^{\frac{-2\,n}{n+1}}\quad\text{with}\quad
A_{0}{\left(f\right)}=
\left\{
\begin{aligned}
{\left(n\,{\left({\left({{\displaystyle \frac{\displaystyle
f+f_{\varepsilon}}{\displaystyle
2}}}\right)}^{-1/n}-1\right)}\right)}^{\frac{-2\,n}{n+1}}&amp;\quad\text{if}\quad&amp;f\leq
f_{\varepsilon}\\
{\left(n\,{\left(f^{-1/n}-1\right)}\right)}^{\frac{-2\,n}{n+1}}&amp;\quad\text{if}\quad&amp;f&gt;
f_{\varepsilon}
\end{aligned}
\right.
\]</span></p>
<p>With this expression, this implementation is straightforward:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> StressStensor<span class="op">&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>MichelAndSuquet1992HollowSphereTestStressType<span class="op">&lt;</span>StressStensor<span class="op">&gt;</span> computeMichelAndSuquet1992HollowSphereTestStress<span class="op">(</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> StressStensor<span class="op">&amp;</span> sig<span class="op">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestPorosityType<span class="op">&lt;</span>StressStensor<span class="op">&gt;</span> f<span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters<span class="op">&lt;</span>StressStensor<span class="op">&gt;&amp;</span> p<span class="op">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressType<span class="op">&lt;</span>StressStensor<span class="op">&gt;</span> seps<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// a simple alias to the underlying numeric type</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> real <span class="op">=</span> MichelAndSuquet1992HollowSphereTestBaseType<span class="op">&lt;</span>StressStensor<span class="op">&gt;;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_3_2 <span class="op">=</span> real<span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_9_4 <span class="op">=</span> real<span class="op">(</span><span class="dv">9</span><span class="op">)</span> <span class="op">/</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> s <span class="op">=</span> deviator<span class="op">(</span>s<span class="op">);</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> s2 <span class="op">=</span> cste_3_2 <span class="op">*</span> <span class="op">(</span>s <span class="op">|</span> s<span class="op">);</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> pr <span class="op">=</span> trace<span class="op">(</span>sig<span class="op">)</span> <span class="op">/</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> n <span class="op">=</span> p<span class="op">.</span>n<span class="op">;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> is_zero <span class="op">=</span> tfel<span class="op">::</span>math<span class="op">::</span>ieee754<span class="op">::</span>fpclassify<span class="op">(</span>f<span class="op">)</span> <span class="op">==</span> FP_ZERO<span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> A0 <span class="op">=</span> f <span class="op">&lt;</span> p<span class="op">.</span>feps <span class="op">?</span> pow<span class="op">((</span>f <span class="op">+</span> p<span class="op">.</span>feps<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> n<span class="op">)</span> <span class="op">:</span> pow<span class="op">(</span>f<span class="op">,</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> n<span class="op">);</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> A <span class="op">=</span> is_zero <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> pow<span class="op">(</span>n <span class="op">*</span> <span class="op">(</span>A0 <span class="op">-</span> <span class="dv">1</span><span class="op">),</span> <span class="op">-</span><span class="dv">2</span> <span class="op">*</span> n <span class="op">/</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> B <span class="op">=</span> <span class="op">(</span><span class="dv">1</span> <span class="op">+</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> f<span class="op">)</span> <span class="op">/</span> <span class="dv">3</span><span class="op">)</span> <span class="op">*</span> pow<span class="op">(</span><span class="dv">1</span> <span class="op">-</span> f<span class="op">,</span> <span class="op">-</span><span class="dv">2</span> <span class="op">*</span> n <span class="op">/</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">std::</span>sqrt<span class="op">(</span>cste_9_4 <span class="op">*</span> A <span class="op">*</span> pr <span class="op">*</span> pr <span class="op">+</span> B <span class="op">*</span> s2<span class="op">);</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">// end of computeMichelAndSuquet1992HollowSphereTestYieldStress</span></span></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>It is worth trying to recompile the <code>MFront</code> file at this
stage to see if one did not introduce any error in the <code>C++</code>
code.</p>
</blockquote>
<h3 data-number="1.3.5"
id="implementing-the-computemichelandsuquet1992hollowsphereteststressnormal-function"><span
class="header-section-number">1.3.5</span> Implementing the
<code>computeMichelAndSuquet1992HollowSphereTestStressNormal</code>
function</h3>
<p>This function computes the equivalent stress, its normal and its
derivative with respect to the porosity.</p>
<p>The expression of the normal is:</p>
<p><span class="math display">\[
\begin{aligned}
\underline{n}^{MS} &amp;= {\displaystyle \frac{\displaystyle \partial
\sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial \underline{\sigma}}} =
{\displaystyle \frac{\displaystyle \partial
\sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial p}}\,{\displaystyle
\frac{\displaystyle \partial p}{\displaystyle \partial
\underline{\sigma}}}+
{\displaystyle \frac{\displaystyle \partial
\sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial
\sigma_{\mathrm{eq}}}}\,{\displaystyle \frac{\displaystyle \partial
\sigma_{\mathrm{eq}}}{\displaystyle \partial \underline{\sigma}}}\\
&amp;={{\displaystyle \frac{\displaystyle 3}{\displaystyle
2\,\sigma_{\mathrm{eq}}^{MS}}}}\,{\left({{\displaystyle
\frac{\displaystyle 1}{\displaystyle
2}}}\,A\,p\,\underline{I}+B\,\underline{s}\right)}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\underline{s}\)</span> is the
deviatoric part of the stress.</p>
<p>The expression of <span class="math inline">\({\displaystyle
\frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle
\partial f}}\)</span> is given by:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial
\sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial f}}={{\displaystyle
\frac{\displaystyle 1}{\displaystyle
\sigma_{\mathrm{eq}}^{MS}}}}{\left({{\displaystyle \frac{\displaystyle
9}{\displaystyle 8}}}\,p^{2}\,{\displaystyle \frac{\displaystyle
\partial A}{\displaystyle \partial f}}+{{\displaystyle
\frac{\displaystyle 1}{\displaystyle
2}}}\,\sigma_{\mathrm{eq}}^{2}\,{\displaystyle \frac{\displaystyle
\partial B}{\displaystyle \partial f}}\right)}
\]</span></p>
<p>The expression of <span class="math inline">\({\displaystyle
\frac{\displaystyle \partial A}{\displaystyle \partial f}}\)</span> can
be computed straightforwardly:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial A}{\displaystyle \partial
f}}={{\displaystyle \frac{\displaystyle
2\,A_{0}{\left(f\right)}}{\displaystyle
f\,{\left(A_{0}{\left(f\right)}-1\right)}\,{\left(n+1\right)}}}}\,A{\left(f\right)}
\]</span></p>
<p>However, this derivative tends to infinity when the porosity tends to
zero. The following approximated expression will be used in
practice:</p>
<p><span class="math display">\[
{\left({\displaystyle \frac{\displaystyle \partial A}{\displaystyle
\partial f}}\right)}_{\varepsilon}={{\displaystyle \frac{\displaystyle
2\,A_{0}{\left(f\right)}}{\displaystyle
{\left(f+f_{\varepsilon_{2}}\right)}\,{\left(A_{0}{\left(f\right)}-1\right)}\,{\left(n+1\right)}}}}\,A{\left(f\right)}
\]</span></p>
<p>Let us decompose <span
class="math inline">\(B{\left(f\right)}\)</span> as the product of two
terms:</p>
<p><span class="math display">\[
B{\left(f\right)}=B_{1}{\left(f\right)}\,B_{2}{\left(f\right)}
\]</span></p>
<p>with:</p>
<p>f- <span
class="math inline">\(B_{1}{\left(f\right)}=1+{{\displaystyle
\frac{\displaystyle 2}{\displaystyle 3}}}\,f\)</span> - <span
class="math inline">\(B_{2}{\left(f\right)}={\left(1-f\right)}^{\frac{-2\,n}{n+1}}\)</span></p>
<p>The derivative <span class="math inline">\({\displaystyle
\frac{\displaystyle \partial B}{\displaystyle \partial f}}\)</span> is
thus:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial B}{\displaystyle \partial
f}}=B_{2}{\left(f\right)}\,{\displaystyle \frac{\displaystyle \partial
B_{1}}{\displaystyle \partial f}}+B_{1}{\left(f\right)}\,{\displaystyle
\frac{\displaystyle \partial B_{2}}{\displaystyle \partial f}}
\]</span></p>
<p>with:</p>
<ul>
<li><span class="math inline">\({\displaystyle \frac{\displaystyle
\partial B_{1}}{\displaystyle \partial f}}={{\displaystyle
\frac{\displaystyle 2}{\displaystyle 3}}}\)</span></li>
<li><span class="math inline">\({\displaystyle \frac{\displaystyle
\partial B_{2}}{\displaystyle \partial f}}={{\displaystyle
\frac{\displaystyle 2\,n}{\displaystyle
{\left(1-f\right)}\,{\left(n+1\right)}}}}\,B_{2}{\left(f\right)}\)</span></li>
</ul>
<p>This expression introduces the inverse of the equivalent stress which
may lead to numerical troubles. To avoid those issues, a numerical
threshold is introduced in the computation of the inverse in our
implementation:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> StressStensor<span class="op">&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>tuple<span class="op">&lt;</span>MichelAndSuquet1992HollowSphereTestStressType<span class="op">&lt;</span>StressStensor<span class="op">&gt;,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>           MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>           MichelAndSuquet1992HollowSphereTestStressDerivativeWithRespectToPorosityType<span class="op">&lt;</span>StressStensor<span class="op">&gt;&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>computeMichelAndSuquet1992HollowSphereTestStressNormal<span class="op">(</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> StressStensor <span class="op">&amp;</span> sig<span class="op">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestPorosityType<span class="op">&lt;</span>StressStensor<span class="op">&gt;</span> f<span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters<span class="op">&lt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        StressStensor<span class="op">&gt;</span> <span class="op">&amp;</span> p<span class="op">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressType<span class="op">&lt;</span>StressStensor<span class="op">&gt;</span> seps<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> real <span class="op">=</span> MichelAndSuquet1992HollowSphereTestBaseType<span class="op">&lt;</span>StressStensor<span class="op">&gt;;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> id <span class="op">=</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;::</span>Id<span class="op">();</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_2_3 <span class="op">=</span> real<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">/</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_3_2 <span class="op">=</span> real<span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_9_4 <span class="op">=</span> real<span class="op">(</span><span class="dv">9</span><span class="op">)</span> <span class="op">/</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> s <span class="op">=</span> deviator<span class="op">(</span>sig<span class="op">);</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> s2 <span class="op">=</span> cste_3_2 <span class="op">*</span> <span class="op">(</span>s <span class="op">|</span> s<span class="op">);</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> pr <span class="op">=</span> trace<span class="op">(</span>sig<span class="op">)</span> <span class="op">/</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> n <span class="op">=</span> p<span class="op">.</span>n<span class="op">;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> d <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> f<span class="op">;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> inv_d <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="bu">std::</span>max<span class="op">(</span>d<span class="op">,</span> p<span class="op">.</span>feps<span class="op">);</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> is_zero <span class="op">=</span> tfel<span class="op">::</span>math<span class="op">::</span>ieee754<span class="op">::</span>fpclassify<span class="op">(</span>f<span class="op">)</span> <span class="op">==</span> FP_ZERO<span class="op">;</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> A0 <span class="op">=</span> f <span class="op">&lt;</span> p<span class="op">.</span>feps <span class="op">?</span> pow<span class="op">((</span>f <span class="op">+</span> p<span class="op">.</span>feps<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> n<span class="op">)</span> <span class="op">:</span> pow<span class="op">(</span>f<span class="op">,</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> n<span class="op">);</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> A <span class="op">=</span> is_zero <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> pow<span class="op">(</span>n <span class="op">*</span> <span class="op">(</span>A0 <span class="op">-</span> <span class="dv">1</span><span class="op">),</span> <span class="op">-</span><span class="dv">2</span> <span class="op">*</span> n <span class="op">/</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> B1 <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> cste_2_3 <span class="op">*</span> f<span class="op">;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> B2 <span class="op">=</span> pow<span class="op">(</span><span class="dv">1</span> <span class="op">-</span> f<span class="op">,</span> <span class="op">-</span><span class="dv">2</span> <span class="op">*</span> n <span class="op">/</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> B <span class="op">=</span> B1 <span class="op">*</span> B2<span class="op">;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> seq <span class="op">=</span> <span class="bu">std::</span>sqrt<span class="op">(</span>cste_9_4 <span class="op">*</span> A <span class="op">*</span> pr <span class="op">*</span> pr <span class="op">+</span> B <span class="op">*</span> s2<span class="op">);</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> iseq <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="op">(</span><span class="bu">std::</span>max<span class="op">(</span>seq<span class="op">,</span> seps<span class="op">));</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dseq_dsig <span class="op">=</span> cste_3_2 <span class="op">*</span> iseq <span class="op">*</span> <span class="op">((</span>A <span class="op">*</span> pr <span class="op">/</span> <span class="dv">2</span><span class="op">)</span> <span class="op">*</span> id <span class="op">+</span> B <span class="op">*</span> s<span class="op">);</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dA_df <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> A <span class="op">*</span> A0 <span class="op">/</span> <span class="op">(</span><span class="bu">std::</span>max<span class="op">(</span>f<span class="op">,</span> p<span class="op">.</span>feps2<span class="op">)</span> <span class="op">*</span> <span class="op">(</span>A0 <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dB1_df <span class="op">=</span> cste_2_3<span class="op">;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dB2_df <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> n <span class="op">*</span> B2 <span class="op">*</span> inv_d <span class="op">/</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dB_df <span class="op">=</span> B1 <span class="op">*</span> dB2_df <span class="op">+</span> B2 <span class="op">*</span> dB1_df<span class="op">;</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dseq_df <span class="op">=</span> <span class="op">(</span>cste_9_4 <span class="op">*</span> pr <span class="op">*</span> pr <span class="op">*</span> dA_df <span class="op">+</span> s2 <span class="op">*</span> dB_df<span class="op">)</span> <span class="op">*</span> <span class="op">(</span>iseq <span class="op">/</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">{</span>seq<span class="op">,</span> dseq_dsig<span class="op">,</span> dseq_df<span class="op">};</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">// end of computeMichelAndSuquet1992HollowSphereTestStressNormal</span></span></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>At this stage, the <code>MFront</code> implementation based on a
numerical jacobian could be fully functional if one modifies the
<code>@InitLocalVarialbes</code> block to initialize the parameters of
stress criterion.</p>
</blockquote>
<h3 data-number="1.3.6"
id="implementing-the-computemichelandsuquet1992hollowsphereteststresssecondderivative-function"><span
class="header-section-number">1.3.6</span> Implementing the
<code>computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative</code>
function</h3>
<p>This function computes:</p>
<ul>
<li>the equivalent stress <span
class="math inline">\(\sigma_{\mathrm{eq}}^{MS}\)</span>,</li>
<li>the normal <span
class="math inline">\(\underline{n}^{MS}={\displaystyle
\frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle
\partial \underline{\sigma}}}\)</span></li>
<li>the derivative of the equivalent stress with respect to the porosity
<span class="math inline">\({\displaystyle \frac{\displaystyle \partial
\sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial f}}\)</span></li>
<li>the derivative of the normal with respect to the stress <span
class="math inline">\({\displaystyle \frac{\displaystyle \partial
\underline{n}^{MS}}{\displaystyle \partial \sigma}}\)</span>.</li>
<li>the derivative of the normal with respect to the porosity <span
class="math inline">\({\displaystyle \frac{\displaystyle \partial
\underline{n}^{MS}}{\displaystyle \partial f}}\)</span>.</li>
</ul>
<p>Let us write the normal as:</p>
<p><span class="math display">\[
\underline{n}^{MS}={{\displaystyle \frac{\displaystyle 1}{\displaystyle
\sigma_{\mathrm{eq}}^{MS}}}}\,\underline{C}
\]</span></p>
<p>with <span class="math inline">\(\underline{C}={{\displaystyle
\frac{\displaystyle 3}{\displaystyle 2}}}\,{\left({{\displaystyle
\frac{\displaystyle 1}{\displaystyle
2}}}\,A\,p\,\underline{I}+B\,\underline{s}\right)}\)</span></p>
<p>The expression of the derivative of the normal with respect to the
stress is then:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial
\underline{n}^{MS}}{\displaystyle \partial \sigma}}=
{{\displaystyle \frac{\displaystyle 1}{\displaystyle
\sigma_{\mathrm{eq}}^{MS}}}}\,{\left({\displaystyle \frac{\displaystyle
\partial \underline{C}}{\displaystyle \partial
\underline{\sigma}}}-\underline{n}^{MS}\,\otimes\,\underline{n}^{MS}\right)}
\]</span></p>
<p>with <span class="math inline">\({\displaystyle \frac{\displaystyle
\partial \underline{C}}{\displaystyle \partial
\underline{\sigma}}}={{\displaystyle \frac{\displaystyle
1}{\displaystyle
4}}}\,A\,\underline{I}\,\otimes\,\underline{I}+{{\displaystyle
\frac{\displaystyle 3}{\displaystyle
2}}}\,B\,{\left(\underline{\underline{\mathbf{I}}}-\underline{I}\,\otimes\,\underline{I}\right)}\)</span></p>
<p>The expression of the derivative of the normal with respect to the
stress can be computed as follows:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial
\underline{n}^{MS}}{\displaystyle \partial f}}=
{{\displaystyle \frac{\displaystyle 1}{\displaystyle
\sigma_{\mathrm{eq}}^{MS}}}}\,{\left({\displaystyle \frac{\displaystyle
\partial \underline{C}}{\displaystyle \partial f}}-{\displaystyle
\frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle
\partial f}}\,\underline{n}^{MS}\right)}
\]</span></p>
<p>with <span class="math inline">\({\displaystyle \frac{\displaystyle
\partial C}{\displaystyle \partial f}}={{\displaystyle
\frac{\displaystyle 3}{\displaystyle 2}}}\,{\left({{\displaystyle
\frac{\displaystyle 1}{\displaystyle 2}}}\,{\displaystyle
\frac{\displaystyle \partial A}{\displaystyle \partial
f}}\,p\,\underline{I}+{\displaystyle \frac{\displaystyle \partial
B}{\displaystyle \partial f}}\,\underline{s}\right)}\)</span></p>
<p>The implementation of the
<code>computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative</code>
function is then:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> StressStensor<span class="op">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>tuple<span class="op">&lt;</span>MichelAndSuquet1992HollowSphereTestStressType<span class="op">&lt;</span>StressStensor<span class="op">&gt;,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>           MichelAndSuquet1992HollowSphereTestStressDerivativeWithRespectToPorosityType<span class="op">&lt;</span>StressStensor<span class="op">&gt;,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>           MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType<span class="op">&lt;</span>StressStensor<span class="op">&gt;,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>           MichelAndSuquet1992HollowSphereTestNormalDerivativeWithRespectToPorosityType<span class="op">&lt;</span>StressStensor<span class="op">&gt;&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative<span class="op">(</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> StressStensor<span class="op">&amp;</span> sig<span class="op">,</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestPorosityType<span class="op">&lt;</span>StressStensor<span class="op">&gt;</span> f<span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters<span class="op">&lt;</span>StressStensor<span class="op">&gt;&amp;</span> p<span class="op">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressType<span class="op">&lt;</span>StressStensor<span class="op">&gt;</span> seps<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> N <span class="op">=</span> tfel<span class="op">::</span>math<span class="op">::</span>StensorTraits<span class="op">&lt;</span>StressStensor<span class="op">&gt;::</span>dime<span class="op">;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> real <span class="op">=</span> MichelAndSuquet1992HollowSphereTestBaseType<span class="op">&lt;</span>StressStensor<span class="op">&gt;;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> normal <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> Stensor4 <span class="op">=</span> tfel<span class="op">::</span>math<span class="op">::</span>st2tost2<span class="op">&lt;</span>N<span class="op">,</span> real<span class="op">&gt;;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> id <span class="op">=</span> normal<span class="op">::</span>Id<span class="op">();</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_2_3 <span class="op">=</span> real<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">/</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_3_2 <span class="op">=</span> real<span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_9_4 <span class="op">=</span> real<span class="op">(</span><span class="dv">9</span><span class="op">)</span> <span class="op">/</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> s <span class="op">=</span> deviator<span class="op">(</span>sig<span class="op">);</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> s2 <span class="op">=</span> cste_3_2 <span class="op">*</span> <span class="op">(</span>s <span class="op">|</span> s<span class="op">);</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> pr <span class="op">=</span> trace<span class="op">(</span>sig<span class="op">)</span> <span class="op">/</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> n <span class="op">=</span> p<span class="op">.</span>n<span class="op">;</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> d <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> f<span class="op">;</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> inv_d <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="bu">std::</span>max<span class="op">(</span>d<span class="op">,</span> p<span class="op">.</span>feps<span class="op">);</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> is_zero <span class="op">=</span> tfel<span class="op">::</span>math<span class="op">::</span>ieee754<span class="op">::</span>fpclassify<span class="op">(</span>f<span class="op">)</span> <span class="op">==</span> FP_ZERO<span class="op">;</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> A0 <span class="op">=</span> f <span class="op">&lt;</span> p<span class="op">.</span>feps <span class="op">?</span> pow<span class="op">((</span>f <span class="op">+</span> p<span class="op">.</span>feps<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> n<span class="op">)</span> <span class="op">:</span> pow<span class="op">(</span>f<span class="op">,</span> <span class="op">-</span><span class="dv">1</span> <span class="op">/</span> n<span class="op">);</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> A <span class="op">=</span> is_zero <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> pow<span class="op">(</span>n <span class="op">*</span> <span class="op">(</span>A0 <span class="op">-</span> <span class="dv">1</span><span class="op">),</span> <span class="op">-</span><span class="dv">2</span> <span class="op">*</span> n <span class="op">/</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> B1 <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> cste_2_3 <span class="op">*</span> f<span class="op">;</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> B2 <span class="op">=</span> pow<span class="op">(</span><span class="dv">1</span> <span class="op">-</span> f<span class="op">,</span> <span class="op">-</span><span class="dv">2</span> <span class="op">*</span> n <span class="op">/</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> B <span class="op">=</span> B1 <span class="op">*</span> B2<span class="op">;</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> seq <span class="op">=</span> <span class="bu">std::</span>sqrt<span class="op">(</span>cste_9_4 <span class="op">*</span> A <span class="op">*</span> pr <span class="op">*</span> pr <span class="op">+</span> B <span class="op">*</span> s2<span class="op">);</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">// derivatives with respect to the stress</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> iseq <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="op">(</span><span class="bu">std::</span>max<span class="op">(</span>seq<span class="op">,</span> seps<span class="op">));</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> C <span class="op">=</span> cste_3_2 <span class="op">*</span> <span class="op">((</span>A <span class="op">*</span> pr <span class="op">/</span> <span class="dv">2</span><span class="op">)</span> <span class="op">*</span> id <span class="op">+</span> B <span class="op">*</span> s<span class="op">);</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dseq_dsig <span class="op">=</span> iseq <span class="op">*</span> C<span class="op">;</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dC_dsig <span class="op">=</span> cste_3_2 <span class="op">*</span> <span class="op">((</span>A <span class="op">/</span> <span class="dv">6</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span>id <span class="op">^</span> id<span class="op">)</span> <span class="op">+</span> B <span class="op">*</span> Stensor4<span class="op">::</span>K<span class="op">());</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> d2seq_dsigdsig <span class="op">=</span> iseq <span class="op">*</span> <span class="op">(</span>dC_dsig <span class="op">-</span> <span class="op">(</span>dseq_dsig <span class="op">^</span> dseq_dsig<span class="op">));</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// derivatives with respect to the porosity</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dA_df <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> A <span class="op">*</span> A0 <span class="op">/</span> <span class="op">(</span><span class="bu">std::</span>max<span class="op">(</span>f<span class="op">,</span> p<span class="op">.</span>feps2<span class="op">)</span> <span class="op">*</span> <span class="op">(</span>A0 <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dB1_df <span class="op">=</span> cste_2_3<span class="op">;</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dB2_df <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> n <span class="op">*</span> inv_d <span class="op">*</span> B2 <span class="op">/</span> <span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dB_df <span class="op">=</span> B1 <span class="op">*</span> dB2_df <span class="op">+</span> B2 <span class="op">*</span> dB1_df<span class="op">;</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dseq_df <span class="op">=</span> <span class="op">(</span>cste_9_4 <span class="op">*</span> pr <span class="op">*</span> pr <span class="op">*</span> dA_df <span class="op">+</span> s2 <span class="op">*</span> dB_df<span class="op">)</span> <span class="op">*</span> <span class="op">(</span>iseq <span class="op">/</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">// derivative with respect to the porosity and the stress</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> dC_df <span class="op">=</span> cste_3_2 <span class="op">*</span> <span class="op">(</span>pr <span class="op">*</span> dA_df <span class="op">/</span> <span class="dv">2</span> <span class="op">*</span> id <span class="op">+</span> dB_df <span class="op">*</span> s<span class="op">);</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> d2seq_dsigdf <span class="op">=</span> iseq <span class="op">*</span> dC_df <span class="op">-</span> iseq <span class="op">*</span> dseq_df <span class="op">*</span> dseq_dsig<span class="op">;</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">{</span>seq<span class="op">,</span> dseq_dsig<span class="op">,</span> dseq_df<span class="op">,</span> d2seq_dsigdsig<span class="op">,</span> d2seq_dsigdf<span class="op">};</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">// end of computeMichelAndSuquet1992HollowSphereTestSecondDerivative</span></span></code></pre></div>
<h2 data-number="1.4"
id="testing-the-derivatives-advanced-and-optional"><span
class="header-section-number">1.4</span> Testing the derivatives
(advanced and optional)</h2>
<p>At this stage, one may compare the values returned by
<code>computeMichelAndSuquet1992HollowSphereTestSecondDerivative</code>
to numerical approximations using a simple <code>C++</code> file.</p>
<p>We thus create a file called <code>test.cxx</code> the
<code>tests/test1</code> directory. Here is its content:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;TFEL/Math/Stensor/StensorConceptIO.hxx&quot;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;TFEL/Math/ST2toST2/ST2toST2ConceptIO.hxx&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;TFEL/Material/MichelAndSuquet1992HollowSphereTestStressCriterion.hxx&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdlib&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> <span class="kw">namespace</span> tfel<span class="op">::</span>material<span class="op">;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> <span class="kw">namespace</span> tfel<span class="op">::</span>math<span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> stress <span class="op">=</span> <span class="dt">double</span><span class="op">;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> StressStensor <span class="op">=</span> stensor<span class="op">&lt;</span><span class="dv">3</span><span class="bu">u</span><span class="op">,</span> <span class="dt">double</span><span class="op">&gt;;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> seps <span class="op">=</span> <span class="fl">1e-12</span> <span class="op">*</span> <span class="fl">200e9</span><span class="op">;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  MichelAndSuquet1992HollowSphereTestStressCriterionParameters<span class="op">&lt;</span>StressStensor<span class="op">&gt;</span> params<span class="op">;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span>n <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  StressStensor sig <span class="op">=</span> <span class="op">{</span><span class="fl">20e6</span><span class="op">,</span> <span class="fl">0.</span><span class="op">,</span> <span class="fl">0.</span><span class="op">,</span> <span class="fl">0.</span><span class="op">,</span> <span class="fl">0.</span><span class="op">,</span> <span class="fl">0.</span><span class="op">};</span>  <span class="co">// value of the stress</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> f <span class="op">=</span> <span class="fl">1e-2</span><span class="op">;</span>                             <span class="co">// value of the porosity</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Testing the derivatives with respect to the stress</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> seq <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> n <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dseq_df <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dn_ds <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dn_df <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>tie<span class="op">(</span>seq<span class="op">,</span> n<span class="op">,</span> dseq_df<span class="op">,</span> dn_ds<span class="op">,</span> dn_df<span class="op">)</span> <span class="op">=</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>      computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative<span class="op">(</span>sig<span class="op">,</span> f<span class="op">,</span> params<span class="op">,</span> seps<span class="op">);</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> nn <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dn <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">short</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">!=</span> <span class="dv">6</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> sig_p <span class="op">=</span> sig<span class="op">;</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    sig_p<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> <span class="fl">1e-8</span> <span class="op">*</span> <span class="fl">20e6</span><span class="op">;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> seq_p <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> n_p <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> dseq_df_p <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> dn_ds_p <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> dn_df_p <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>tie<span class="op">(</span>seq_p<span class="op">,</span> n_p<span class="op">,</span> dseq_df_p<span class="op">,</span> dn_ds_p<span class="op">,</span> dn_df_p<span class="op">)</span> <span class="op">=</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>        computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative<span class="op">(</span>sig_p<span class="op">,</span> f<span class="op">,</span> params<span class="op">,</span> seps<span class="op">);</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> sig_m <span class="op">=</span> sig<span class="op">;</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    sig_m<span class="op">[</span>i<span class="op">]</span> <span class="op">-=</span> <span class="fl">1e-8</span> <span class="op">*</span> <span class="fl">20e6</span><span class="op">;</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> seq_m <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> n_m <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> dseq_df_m <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> dn_ds_m <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> dn_df_m <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>tie<span class="op">(</span>seq_m<span class="op">,</span> n_m<span class="op">,</span> dseq_df_m<span class="op">,</span> dn_ds_m<span class="op">,</span> dn_df_m<span class="op">)</span> <span class="op">=</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>        computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative<span class="op">(</span>sig_m<span class="op">,</span> f<span class="op">,</span> params<span class="op">,</span> seps<span class="op">);</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    nn<span class="op">(</span>i<span class="op">)</span> <span class="op">=</span> <span class="op">(</span>seq_p <span class="op">-</span> seq_m<span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2e-8</span> <span class="op">*</span> <span class="fl">20e6</span><span class="op">);</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">short</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">!=</span> <span class="dv">6</span><span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>      dn<span class="op">(</span>j<span class="op">,</span> i<span class="op">)</span> <span class="op">=</span> <span class="op">(</span>n_p<span class="op">[</span>j<span class="op">]</span> <span class="op">-</span> n_m<span class="op">[</span>j<span class="op">])</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2e-8</span> <span class="op">*</span> <span class="fl">20e6</span><span class="op">);</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;analytical normal: &quot;</span> <span class="op">&lt;&lt;</span> n <span class="op">&lt;&lt;</span> <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;numerical normal: &quot;</span> <span class="op">&lt;&lt;</span> nn <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Analytical derivative of the normal with respect to stress:</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">&lt;&lt;</span> dn_ds <span class="op">&lt;&lt;</span> <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Numerical derivative of the normal with respect to stress:</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">&lt;&lt;</span> dn <span class="op">&lt;&lt;</span> <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Difference:</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">&lt;&lt;</span> <span class="op">(</span>dn <span class="op">-</span> dn_ds<span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Testing the derivatives with respect to the porosity</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> seq_p <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> n_p <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dseq_df_p <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dn_ds_p <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dn_df_p <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>tie<span class="op">(</span>seq_p<span class="op">,</span> n_p<span class="op">,</span> dseq_df_p<span class="op">,</span> dn_ds_p<span class="op">,</span> dn_df_p<span class="op">)</span> <span class="op">=</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>      computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative<span class="op">(</span>sig<span class="op">,</span> f <span class="op">+</span> <span class="fl">1e-8</span><span class="op">,</span> params<span class="op">,</span> seps<span class="op">);</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> seq_m <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> n_m <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dseq_df_m <span class="op">=</span> stress<span class="op">{};</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dn_ds_m <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> dn_df_m <span class="op">=</span> MichelAndSuquet1992HollowSphereTestStressNormalType<span class="op">&lt;</span>StressStensor<span class="op">&gt;{};</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>tie<span class="op">(</span>seq_m<span class="op">,</span> n_m<span class="op">,</span> dseq_df_m<span class="op">,</span> dn_ds_m<span class="op">,</span> dn_df_m<span class="op">)</span> <span class="op">=</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>      computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative<span class="op">(</span>sig<span class="op">,</span> f <span class="op">-</span> <span class="fl">1e-8</span><span class="op">,</span> params<span class="op">,</span> seps<span class="op">);</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Analitical derivative of the equivalent stress with respect to the porosity: &quot;</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;&lt;</span> dseq_df <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Numerical derivative of the equivalent stress with respect to the porosity: &quot;</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;&lt;</span> <span class="op">(</span>seq_p <span class="op">-</span> seq_m<span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2e-8</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Analytical derivative of the normal with respect to the porosity: &quot;</span> <span class="op">&lt;&lt;</span> dn_df <span class="op">&lt;&lt;</span> <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Numerical derivative of the normal with respect to the porosity: &quot;</span> <span class="op">&lt;&lt;</span> <span class="op">(</span>n_p <span class="op">-</span> n_m<span class="op">)</span> <span class="op">/</span> <span class="fl">2e-8</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> EXIT_SUCCESS<span class="op">;</span></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This file can be computed as follows:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> g++ <span class="at">-I</span> ../../include/ test.cxx <span class="at">-o</span> test <span class="dt">\</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">`</span><span class="ex">tfel-config</span> <span class="at">--includes</span> <span class="at">--libs</span> <span class="at">--material</span> <span class="at">--compiler-flags</span> <span class="at">--cppflags</span> <span class="at">--oflags</span> <span class="at">--warning</span><span class="kw">`</span></span></code></pre></div>
<p>where the utility <code>tfel-config</code> have been used to get the
appropriated compiler flags, paths to the headers and libraries of the
<code>TFEL</code> project.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="er">$</span> <span class="op">./</span>test </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Testing the derivatives with respect to the stress</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>analytical normal<span class="op">:</span> <span class="op">[</span> <span class="fl">1.0171</span> <span class="op">-</span><span class="fl">0.494272</span> <span class="op">-</span><span class="fl">0.494272</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="op">]</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>numerical normal<span class="op">:</span> <span class="op">[</span> <span class="fl">1.0171</span> <span class="op">-</span><span class="fl">0.494272</span> <span class="op">-</span><span class="fl">0.494272</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="op">]</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>Analytical derivative of the normal with respect to stress<span class="op">:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="op">[[</span><span class="dv">6</span><span class="er">.14937e</span><span class="op">-</span><span class="dv">25</span><span class="op">,-</span><span class="dv">3</span><span class="er">.62157e</span><span class="op">-</span><span class="dv">24</span><span class="op">,-</span><span class="dv">3</span><span class="er">.62157e</span><span class="op">-</span><span class="dv">24</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[-</span><span class="dv">3</span><span class="er">.62157e</span><span class="op">-</span><span class="dv">24</span><span class="op">,</span><span class="dv">3</span><span class="er">.88453e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,-</span><span class="dv">3</span><span class="er">.67234e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[-</span><span class="dv">3</span><span class="er">.62157e</span><span class="op">-</span><span class="dv">24</span><span class="op">,-</span><span class="dv">3</span><span class="er">.67234e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">3</span><span class="er">.88453e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">7</span><span class="er">.55687e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">7</span><span class="er">.55687e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">7</span><span class="er">.55687e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">]]</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>Numerical derivative of the normal with respect to stress<span class="op">:</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="op">[[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[-</span><span class="dv">1</span><span class="er">.38778e</span><span class="op">-</span><span class="dv">16</span><span class="op">,</span><span class="dv">3</span><span class="er">.88453e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,-</span><span class="dv">3</span><span class="er">.67234e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[-</span><span class="dv">1</span><span class="er">.38778e</span><span class="op">-</span><span class="dv">16</span><span class="op">,-</span><span class="dv">3</span><span class="er">.67234e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">3</span><span class="er">.88453e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">7</span><span class="er">.55687e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">7</span><span class="er">.55687e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">7</span><span class="er">.55687e</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">]]</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>Difference<span class="op">:</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="op">[[-</span><span class="dv">6</span><span class="er">.14937e</span><span class="op">-</span><span class="dv">25</span><span class="op">,</span><span class="dv">3</span><span class="er">.62157e</span><span class="op">-</span><span class="dv">24</span><span class="op">,</span><span class="dv">3</span><span class="er">.62157e</span><span class="op">-</span><span class="dv">24</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[-</span><span class="dv">1</span><span class="er">.38778e</span><span class="op">-</span><span class="dv">16</span><span class="op">,-</span><span class="dv">2</span><span class="er">.87601e</span><span class="op">-</span><span class="dv">17</span><span class="op">,-</span><span class="dv">1</span><span class="er">.66944e</span><span class="op">-</span><span class="dv">16</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[-</span><span class="dv">1</span><span class="er">.38778e</span><span class="op">-</span><span class="dv">16</span><span class="op">,-</span><span class="dv">1</span><span class="er">.66944e</span><span class="op">-</span><span class="dv">16</span><span class="op">,-</span><span class="dv">2</span><span class="er">.87601e</span><span class="op">-</span><span class="dv">17</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="er">.32349e</span><span class="op">-</span><span class="dv">23</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="er">.32349e</span><span class="op">-</span><span class="dv">23</span><span class="op">,</span><span class="dv">0</span><span class="op">]</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="op">[</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="er">.32349e</span><span class="op">-</span><span class="dv">23</span><span class="op">]]</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>Testing the derivatives with respect to the porosity</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>Analitical derivative of the equivalent stress with respect to the porosity<span class="op">:</span> <span class="fl">2.95999e+07</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>Numerical derivative of the equivalent stress with respect to the porosity<span class="op">:</span> <span class="fl">2.95999e+07</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>Analytical derivative of the normal with respect to the porosity<span class="op">:[</span> <span class="fl">1.47999</span> <span class="op">-</span><span class="fl">0.0357341</span> <span class="op">-</span><span class="fl">0.0357341</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="op">]</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>Numerical derivative of the normal with respect to the porosity<span class="op">:[</span> <span class="fl">1.47999</span> <span class="op">-</span><span class="fl">0.0357341</span> <span class="op">-</span><span class="fl">0.0357341</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="op">]</span></span></code></pre></div>
<h2 data-number="1.5" id="modifying-the-mfront-implementations"><span
class="header-section-number">1.5</span> Modifying the
<code>MFront</code> implementations</h2>
<p>At this stage, the provided <code>MFront</code> implementations are
almost working.</p>
<h3 data-number="1.5.1" id="parameters"><span
class="header-section-number">1.5.1</span> Parameters</h3>
<p>First, we define three parameters:</p>
<ul>
<li><code>s0</code>, the reference stress.</li>
<li><code>de0</code>, the reference strain rate.</li>
<li><code>E</code>, is the Norton exponent of the matrix.</li>
</ul>
<div class="sourceCode" id="cb15"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter stress s0 <span class="op">=</span> <span class="fl">50e6</span><span class="op">;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>s0<span class="op">.</span>setEntryName<span class="op">(</span><span class="st">&quot;NortonReferenceStress&quot;</span><span class="op">);</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter strainrate de0 <span class="op">=</span> <span class="fl">1e-4</span><span class="op">;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>de0<span class="op">.</span>setEntryName<span class="op">(</span><span class="st">&quot;NortonReferenceStrainRate&quot;</span><span class="op">);</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter real E <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>E<span class="op">.</span>setEntryName<span class="op">(</span><span class="st">&quot;MatrixNortonExponent&quot;</span><span class="op">);</span></span></code></pre></div>
<p>The Norton exponent is then passed to <code>params</code> data
structure before the behaviour integration.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>InitLocalVariables <span class="op">{</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// initialize the stress criterion parameter</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span>n <span class="op">=</span> E<span class="op">;</span></span></code></pre></div>
<p>We could also define a parameter for <code>feps</code>, but the
default value is sufficient.</p>
<h3 data-number="1.5.2" id="definition-of-the-flow-rule"><span
class="header-section-number">1.5.2</span> Definition of the flow
rule</h3>
<p>The residual associated with the viscoplastic strain is:</p>
<p><span class="math display">\[
\begin{aligned}
f_{\underline{\varepsilon}^{\mathrm{vp}}}
&amp;=\Delta\,\underline{\varepsilon}^{\mathrm{vp}}-\Delta\,t\,\dot{\varepsilon}_{0}\,{\left({{\displaystyle
\frac{\displaystyle
{\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle
\sigma_{0}}}}\right)}^{E}\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}
&amp;=\Delta\,\underline{\varepsilon}^{\mathrm{vp}}-\Delta\,t\,v^{p}\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}
\end{aligned}
\]</span></p>
<p>with <span
class="math inline">\(v^{p}=\dot{\varepsilon}_{0}\,{\left({{\displaystyle
\frac{\displaystyle
{\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle
\sigma_{0}}}}\right)}^{n}\)</span></p>
<p>The jacobian blocks associated with this residual are:</p>
<p><span class="math display">\[
\begin{aligned}
{\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{vp}}}}{\displaystyle \partial
\Delta\,\underline{\varepsilon}^{\mathrm{el}}}}&amp;=
-v^{p}\,\Delta\,t\,
\left[
  E\,{{\displaystyle \frac{\displaystyle 1}{\displaystyle
{\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}}}\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}\,\otimes\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}+
  {\displaystyle \frac{\displaystyle \partial
\underline{n}^{MS}}{\displaystyle \partial \underline{\sigma}}}
\right]
\,\colon\,{\displaystyle \frac{\displaystyle \partial
\underline{\sigma}}{\displaystyle \partial
\Delta\,\underline{\varepsilon}^{\mathrm{el}}}}\\
&amp;=
-\theta\,v^{p}\,\Delta\,t\,
\left[
  E\,{{\displaystyle \frac{\displaystyle 1}{\displaystyle
{\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}}}\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}\,\otimes\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}+
  {\displaystyle \frac{\displaystyle \partial
\underline{n}^{MS}}{\displaystyle \partial \underline{\sigma}}}
\right]
\,\colon\,{\left.\underline{\underline{\mathbf{D}}}\right|_{t+\theta\,\Delta\,t}}\\
{\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{vp}}}}{\displaystyle \partial
\Delta\,p}}&amp;=\underline{\underline{\mathbf{I}}}\\
{\displaystyle \frac{\displaystyle \partial
f_{\underline{\varepsilon}^{\mathrm{vp}}}}{\displaystyle \partial
\Delta\,f}}&amp;=
-\theta\,v^{p}\,\Delta\,t\,
\left[
E\,{{\displaystyle \frac{\displaystyle 1}{\displaystyle
{\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}}}\,{\displaystyle
\frac{\displaystyle \partial
{\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle
\partial f}}\,\underline{n}^{MS}+
{\displaystyle \frac{\displaystyle \partial
{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle
\partial f}}
\right]
\end{aligned}
\]</span></p>
<p>Those implicit equations and derivatives may readily be implemented
as follows:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> iseq <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> max<span class="op">(</span>seq<span class="op">,</span> seps<span class="op">);</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> vp <span class="op">=</span> de0 <span class="op">*</span> pow<span class="op">(</span>seq <span class="op">/</span> s0<span class="op">,</span> E<span class="op">);</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  fevp <span class="op">-=</span> dt <span class="op">*</span> vp <span class="op">*</span> n<span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  dfevp_ddeel <span class="op">=</span> <span class="op">-</span>theta <span class="op">*</span> vp <span class="op">*</span> dt <span class="op">*</span> <span class="op">(</span>E <span class="op">*</span> iseq <span class="op">*</span> <span class="op">(</span>n <span class="op">^</span> n<span class="op">)</span> <span class="op">+</span> dn_ds<span class="op">)</span> <span class="op">*</span> D<span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  dfevp_ddf <span class="op">=</span> <span class="op">-</span>theta <span class="op">*</span> vp <span class="op">*</span> dt <span class="op">*</span> <span class="op">(</span>E <span class="op">*</span> iseq <span class="op">*</span> dseq_df <span class="op">*</span> n <span class="op">+</span> dn_df<span class="op">);</span></span></code></pre></div>
<h3 data-number="1.5.3" id="testing"><span
class="header-section-number">1.5.3</span> Testing</h3>
<p>At this stage, your implementations are fully functional. Go in the
<code>tests/test1</code> subdirectory and compile the examples with:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront <span class="at">-I</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include <span class="at">--obuild</span> <span class="at">--interface</span><span class="op">=</span>generic <span class="dt">\</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>         MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront              <span class="dt">\</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>         MichelAndSuquet1992HollowSphereTestViscoPlasticity_NumericalJacobian.mfront</span></code></pre></div>
<p>One may test it under a simple tensile test:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Author Thomas Helfer<span class="op">;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Date <span class="dv">28</span><span class="op">/</span><span class="bn">07</span><span class="op">/</span><span class="dv">2018</span><span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>PredictionPolicy <span class="ch">&#39;L</span><span class="er">inearPrediction</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>MaximumNumberOfSubSteps <span class="dv">1</span><span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Behaviour<span class="op">&lt;</span>generic<span class="op">&gt;</span> <span class="ch">&#39;s</span><span class="er">rc/libBehaviour.so</span><span class="ch">&#39;</span> <span class="ch">&#39;M</span><span class="er">ichelAndSuquet1992HollowSphereTestViscoPlasticity</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Real <span class="ch">&#39;y</span><span class="er">oung</span><span class="ch">&#39;</span> <span class="fl">200e9</span><span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Real <span class="ch">&#39;n</span><span class="er">u</span><span class="ch">&#39;</span> <span class="fl">0.3</span><span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Real <span class="ch">&#39;s</span><span class="er">xx</span><span class="ch">&#39;</span> <span class="fl">50e6</span><span class="op">;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>ImposedStress <span class="ch">&#39;S</span><span class="er">XX</span><span class="ch">&#39;</span> <span class="ch">&#39;s</span><span class="er">xx</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Initial value of the elastic strain</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Real <span class="ch">&#39;E</span><span class="er">ELXX0</span><span class="ch">&#39;</span> <span class="ch">&#39;s</span><span class="er">xx/young</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Real <span class="ch">&#39;E</span><span class="er">ELZZ0</span><span class="ch">&#39;</span> <span class="ch">&#39;-</span><span class="er">nu*EELXX0</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>InternalStateVariable <span class="ch">&#39;E</span><span class="er">lasticStrain</span><span class="ch">&#39;</span> <span class="op">{</span><span class="ch">&#39;E</span><span class="er">ELXX0</span><span class="ch">&#39;</span><span class="op">,</span><span class="ch">&#39;E</span><span class="er">ELZZ0</span><span class="ch">&#39;</span><span class="op">,</span><span class="ch">&#39;E</span><span class="er">ELZZ0</span><span class="ch">&#39;</span><span class="op">,</span><span class="fl">0.</span><span class="op">,</span><span class="fl">0.</span><span class="op">,</span><span class="fl">0.</span><span class="op">};</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Initial value of the total strain</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Strain <span class="op">{</span><span class="ch">&#39;E</span><span class="er">ELXX0</span><span class="ch">&#39;</span><span class="op">,</span><span class="ch">&#39;E</span><span class="er">ELZZ0</span><span class="ch">&#39;</span><span class="op">,</span><span class="ch">&#39;E</span><span class="er">ELZZ0</span><span class="ch">&#39;</span><span class="op">,</span><span class="fl">0.</span><span class="op">,</span><span class="fl">0.</span><span class="op">,</span><span class="fl">0.</span><span class="op">};</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Initial value of the total stresses</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Stress <span class="op">{</span><span class="ch">&#39;s</span><span class="er">xx</span><span class="ch">&#39;</span><span class="op">,</span><span class="fl">0.</span><span class="op">,</span><span class="fl">0.</span><span class="op">,</span><span class="fl">0.</span><span class="op">,</span><span class="fl">0.</span><span class="op">,</span><span class="fl">0.</span><span class="op">};</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co">//@InternalStateVariable &#39;Porosity&#39; 0.01;</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>ExternalStateVariable <span class="ch">&#39;T</span><span class="er">emperature</span><span class="ch">&#39;</span> <span class="fl">293.15</span><span class="op">;</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Times <span class="op">{</span><span class="fl">0.</span><span class="op">,</span><span class="dv">3600</span> in <span class="dv">20</span><span class="op">};</span></span></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>The numerical jacobian version fails (residual stagnation) if the
initial porosity is null with this time discretization. The main reason
is that the centered finite difference used to evaluate the jacobian
numerically is wrong when bounds are imposed to some state variables
(i.e. the pertubated porosity can’t be negative).</p>
<p>In the numerical jacobian case, one solution is to allow
sub-steppings.</p>
</blockquote>
<p>This test allows checking that:</p>
<ul>
<li>The results are correct.</li>
<li>The jacobian of the implicit system is properly computed. One may
check its value against a numerical jacobian as follows:</li>
</ul>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront <span class="at">-I</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include <span class="at">--obuild</span> <span class="at">--interface</span><span class="op">=</span>generic <span class="dt">\</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>         MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront              <span class="dt">\</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">--@CompareToNumericalJacobian</span><span class="op">=</span>true             <span class="dt">\</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">--@PerturbationValueForNumericalJacobianComputation</span><span class="op">=</span>1.e-8</span></code></pre></div>
<ul>
<li>The convergence of the implicit algorithm is quadratic (one may
compile the <code>MFront</code> file using the <code>--debug</code> flag
as follows:</li>
</ul>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mfront <span class="at">-I</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include <span class="at">--obuild</span> <span class="at">--interface</span><span class="op">=</span>generic <span class="dt">\</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>         MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront <span class="at">--debug</span></span></code></pre></div>
<ul>
<li>The convergence of <code>MTest</code> is quadratic, i.e. that the
consistent tangent operator is correct (this is just another way of
checking if the jacobian of the implicit system is correct):</li>
</ul>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mtest MichelAndSuquet1992HollowSphereTestViscoPlasticity.mtest                   <span class="dt">\</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">--@CompareToNumericalTangentOperator</span><span class="op">=</span>true          <span class="dt">\</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">--@NumericalTangentOperatorPerturbationValue</span><span class="op">=</span>1.e-8 <span class="dt">\</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">--@TangentOperatorComparisonCriterium</span><span class="op">=</span>1</span></code></pre></div>
<h1 data-number="2" id="extending-the-tfelmfront-library"><span
class="header-section-number">2</span> Extending the
<code>TFELMFront</code> library</h1>
<h2 data-number="2.1" id="updating-the-working-directory"><span
class="header-section-number">2.1</span> Updating the working
directory</h2>
<p>We recommend that you use the following template files:</p>
<ul>
<li><a
href="cxx/mfront/include/MFront/BehaviourBrick/PorousStressCriterionTemplate.hxx"><code>PorousStressCriterionTemplate.hxx</code></a>.
Beware that this file is not the same as the one used in the first part
of this document.</li>
<li><a
href="cxx/mfront/src/PorousStressCriterionTemplate.cxx"><code>PorousStressCriterionTemplate.cxx</code></a></li>
</ul>
<p>The first file must be copied in a directory called
<code>mfront/include/MFront/BehaviourBrick</code> and the second one in
a directory called <code>mfront/src</code> subdirectory. Both must be
renamed appropriately.</p>
<p>The working directory must now have the following structure:</p>
<p><img
src="img/ExtendingStandardElastoViscoPlasticityBrick-PorousStressCriterion-tree-2.png"
style="width:100.0%" /></p>
<p>As in the first part of this document, <code>__Author__</code>,
<code>__Date__</code>, <code>__StressCriterionName__</code> and
<code>__STRESS_CRITERION_NAME__</code> must be replaced by the
appropriate values.</p>
<h2 data-number="2.2" id="adding-the-stress-criterion-options"><span
class="header-section-number">2.2</span> Adding the stress criterion
options</h2>
<p>In our case, the <code>getOptions</code> method must be implemented
to declare the <code>n</code> material coefficient:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>vector<span class="op">&lt;</span>OptionDescription<span class="op">&gt;</span> MichelAndSuquet1992HollowSphereTestStressCriterion<span class="op">::</span>getOptions<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> opts <span class="op">=</span> PorousStressCriterionBase<span class="op">::</span>getOptions<span class="op">();</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  opts<span class="op">.</span>emplace_back<span class="op">(</span><span class="st">&quot;n&quot;</span><span class="op">,</span> <span class="st">&quot;Norton exponent of the matrix&quot;</span><span class="op">,</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                    OptionDescription<span class="op">::</span>MATERIALPROPERTY<span class="op">);</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> opts<span class="op">;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// end of MichelAndSuquet1992HollowSphereTestStressCriterion::getOptions()</span></span></code></pre></div>
<p>The <code>getPorosityEffectOnEquivalentPlasticStrain</code> method
must be modified. But default, its returns the
<code>STANDARD_POROSITY_CORRECTION_ON_EQUIVALENT_PLASTIC_STRAIN</code>
value which would define define the increment of the viscoplastic strain
as:</p>
<p><span class="math display">\[
\Delta\,\underline{\varepsilon}^{\mathrm{vp}}=
{\left(1-f\right)}\,\Delta\,p\,\underline{n}
\]</span></p>
<p>In the case of the stress criterion discussed in this tutorial, this
<span class="math inline">\(1-f\)</span> correction shall not be taken
into account. Hence, the correct implementation for this method is:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>StressCriterion<span class="op">::</span>PorosityEffectOnFlowRule</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>MichelAndSuquet1992HollowSphereTestStressCriterion<span class="op">::</span>getPorosityEffectOnEquivalentPlasticStrain<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> StressCriterion<span class="op">::</span>NO_POROSITY_EFFECT_ON_EQUIVALENT_PLASTIC_STRAIN<span class="op">;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">// end of MichelAndSuquet1992HollowSphereTestStressCriterion::getPorosityEffectOnEquivalentPlasticStrain()</span></span></code></pre></div>
<h2 data-number="2.3" id="compilation-of-the-mfront-plugin"><span
class="header-section-number">2.3</span> Compilation of the
<code>MFront</code> plugin</h2>
<blockquote>
<p><strong>Note</strong></p>
<p>This paragraph assumes that you are working under a standard
<code>LiNuX</code> environment. In particular, we assume that you use
<code>g++</code> as your <code>C++</code> compiler. This can easily be
changed to match your needs.</p>
</blockquote>
<p>The
<code>MichelAndSuquet1992HollowSphereTestStressCriterion.cxx</code> can
now be compiled in a plugin as follows. Go in the
<code>mfront/src</code> directory and type:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> g++ <span class="at">-I</span> ../include/ <span class="kw">`</span><span class="ex">tfel-config</span> <span class="at">--includes</span> <span class="kw">`</span>            <span class="dt">\</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">`</span><span class="ex">tfel-config</span> <span class="at">--oflags</span> <span class="at">--cppflags</span> <span class="at">--compiler-flags</span><span class="kw">`</span>  <span class="dt">\</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">-DMFRONT_ADITIONNAL_LIBRARY</span>                         <span class="dt">\</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">`</span><span class="ex">tfel-config</span> <span class="at">--libs</span><span class="kw">`</span> <span class="at">-lTFELMFront</span>                   <span class="dt">\</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">--shared</span> <span class="at">-fPIC</span> MichelAndSuquet1992HollowSphereTestStressCriterion.cxx         <span class="dt">\</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">-o</span> libAdditionalStressCriteria.so</span></code></pre></div>
<p>The calls to <code>tfel-config</code> allows retrieving the paths to
the <code>TFEL</code> headers and libraries. The
<code>MFRONT_ADITIONNAL_LIBRARY</code> flag activate a portion of the
source file whose only purpose is to register the
<code>MichelAndSuquet1992HollowSphereTest</code> stress criterion in an
abstract factory.</p>
<h2 data-number="2.4" id="testing-the-plugin"><span
class="header-section-number">2.4</span> Testing the plugin</h2>
<p>To test the plugin, go in the <code>tests/test2</code> directory.</p>
<p>Create a file
<code>MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront</code>
with the following content:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>DSL Implicit<span class="op">;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Behaviour MichelAndSuquet1992HollowSphereTestViscoPlasticity<span class="op">;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Author Thomas Helfer<span class="op">,</span> Jérémy Hure<span class="op">,</span> Mohamed Shokeir<span class="op">;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Date <span class="dv">25</span> <span class="op">/</span> <span class="bn">03</span> <span class="op">/</span> <span class="dv">2020</span><span class="op">;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Description <span class="op">{</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Algorithm NewtonRaphson<span class="op">;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Epsilon <span class="fl">1.e-14</span><span class="op">;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Theta <span class="dv">1</span><span class="op">;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>ModellingHypotheses<span class="op">{</span><span class="st">&quot;.+&quot;</span><span class="op">};</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Brick StandardElastoViscoPlasticity<span class="op">{</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  stress_potential <span class="op">:</span> <span class="st">&quot;Hooke&quot;</span> <span class="op">{</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    young_modulus <span class="op">:</span> <span class="fl">200e9</span><span class="op">,</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    poisson_ratio <span class="op">:</span> <span class="fl">0.3</span><span class="op">},</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  inelastic_flow <span class="op">:</span> <span class="st">&quot;Norton&quot;</span> <span class="op">{</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    criterion <span class="op">:</span> <span class="st">&quot;MichelAndSuquet1992HollowSphereTest&quot;</span> <span class="op">{</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>      n <span class="op">:</span> <span class="dv">8</span><span class="op">},</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    n<span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    K<span class="op">:</span> <span class="fl">50e6</span><span class="op">,</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    A<span class="op">:</span> <span class="fl">1.e-4</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>Here, we see that the Norton exponent has to be repeated twice:</p>
<ul>
<li>one for the definition of the stress criterion.</li>
<li>one for the definition of the Norton flow.</li>
</ul>
<p>This is due to the structure, i.e. the abstractions, used by the
brick which considers that the inelastic flow has now knowledge of the
stress criterion.</p>
</blockquote>
<p>This file can be compiled as follows:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> MFRONT_ADDITIONAL_LIBRARIES=../../mfront/src/libAdditionalStressCriteria.so <span class="dt">\</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  mfront <span class="at">-I</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include/ <span class="at">--obuild</span> <span class="at">--interface</span><span class="op">=</span>generic                <span class="dt">\</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront</span></code></pre></div>
<p>This implementation can be checked with the same <code>MTest</code>
file than in the first part of this tutorial.</p>
<h1 data-number="3"
id="applications-to-uranimum-dioxyde-viscoplastic-behaviours"><span
class="header-section-number">3</span> Applications to uranimum dioxyde
viscoplastic behaviours</h1>
<h2 data-number="3.1"
id="implementation-of-salvo-viscoplastic-behaviour"><span
class="header-section-number">3.1</span> Implementation of Salvo’
viscoplastic behaviour</h2>
<p>This behaviour has been described in <span class="citation"
data-cites="salvo_experimental_2015-1">[<a
href="#ref-salvo_experimental_2015-1"
role="doc-biblioref">2</a>]</span>.</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>DSL Implicit<span class="op">;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Behaviour Salvo2015ViscoplasticBehaviour<span class="op">;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Material UO2<span class="op">;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Author Thomas Helfer<span class="op">,</span> Jérémy Hure<span class="op">,</span> Mohamed Shokeir<span class="op">;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Date <span class="dv">25</span> <span class="op">/</span> <span class="bn">03</span> <span class="op">/</span> <span class="dv">2020</span><span class="op">;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Description <span class="op">{</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Salvo, Maxime, Jérôme Sercombe, Thomas Helfer, Philippe Sornay, and Thierry Désoyer. &quot;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Experimental Characterization and Modeling of UO2 Grain Boundary Cracking at High &quot;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Temperatures and High Strain Rates.&quot;</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Journal of Nuclear Materials 460 (May 2015): 184–99.&quot;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://doi.org/10.1016/j.jnucmat.2015.02.018.&quot;</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>StrainMeasure Hencky<span class="op">;</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Algorithm NewtonRaphson<span class="op">;</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Epsilon <span class="fl">1.e-14</span><span class="op">;</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Theta <span class="dv">1</span><span class="op">;</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">//! Reference stress</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter stress s0 <span class="op">=</span> <span class="fl">5e6</span><span class="op">;</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">//! Activation temperature</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co">// This temperature is equal to the activation energy (482 kJ/mol/K)</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">// divided by the ideal gas constant.</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter temperature Ta <span class="op">=</span> <span class="fl">57971.27513059395</span><span class="op">;</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co">//! Reference strain rate</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter strainrate de0 <span class="op">=</span> <span class="fl">29.130</span><span class="op">;</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>ModellingHypotheses<span class="op">{</span><span class="st">&quot;.+&quot;</span><span class="op">};</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Brick StandardElastoViscoPlasticity<span class="op">{</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  stress_potential <span class="op">:</span> <span class="st">&quot;Hooke&quot;</span> <span class="op">{</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    young_modulus <span class="op">:</span> <span class="st">&quot;UO2_YoungModulus.mfront&quot;</span><span class="op">,</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    poisson_ratio <span class="op">:</span> <span class="st">&quot;UO2_PoissonRatio.mfront&quot;</span><span class="op">},</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  inelastic_flow <span class="op">:</span> <span class="st">&quot;HyperbolicSine&quot;</span> <span class="op">{</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    criterion <span class="op">:</span> <span class="st">&quot;MichelAndSuquet1992HollowSphereTest&quot;</span> <span class="op">{</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>      n <span class="op">:</span> <span class="dv">6</span><span class="op">},</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    K<span class="op">:</span> <span class="st">&quot;s0&quot;</span><span class="op">,</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    A<span class="op">:</span> <span class="st">&quot;de0 * exp(-Ta/T)&quot;</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>This implementation has been proposed as an example of how the brick
can be used in practice. This implementation barely compiles at this
stage and shall be carefully verified before any usage in a fuel
performance code.</p>
</blockquote>
<h2 data-number="3.2"
id="coupling-of-the-salvo-viscoplastic-behaviour-with-the-ddif2-damage-law"><span
class="header-section-number">3.2</span> Coupling of the Salvo’
viscoplastic behaviour with the <code>DDIF2</code> damage law</h2>
<p>The <code>DDIF2</code> damage law is currently the standard damage
law used in <code>CEA</code>’ fuel performance codes (see <span
class="citation"
data-cites="michel_3d_2008 michel_3d_2016 michel_new_2017">[<a
href="#ref-michel_3d_2008" role="doc-biblioref">3</a>–<a
href="#ref-michel_new_2017" role="doc-biblioref">5</a>]</span> for a
complete description). Coupling of the Salvo’ viscoplastic behaviour
with the <code>DDIF2</code> damage law boils downs to replacing the
<code>Hooke</code> stress potential with the <code>DDIF2</code> stress
potential, as follows:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>DSL Implicit<span class="op">;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Behaviour DDIF2Salvo2015ViscoplasticBehaviour<span class="op">;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Material UO2<span class="op">;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Author Thomas Helfer<span class="op">,</span> Jérémy Hure<span class="op">,</span> Mohamed Shokeir<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Date <span class="dv">25</span> <span class="op">/</span> <span class="bn">03</span> <span class="op">/</span> <span class="dv">2020</span><span class="op">;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Description <span class="op">{</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Salvo, Maxime, Jérôme Sercombe, Thomas Helfer, Philippe Sornay, and Thierry Désoyer. &quot;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Experimental Characterization and Modeling of UO2 Grain Boundary Cracking at High &quot;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Temperatures and High Strain Rates.&quot;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Journal of Nuclear Materials 460 (May 2015): 184–99.&quot;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://doi.org/10.1016/j.jnucmat.2015.02.018.&quot;</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>StrainMeasure Hencky<span class="op">;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Algorithm NewtonRaphson<span class="op">;</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Epsilon <span class="fl">1.e-14</span><span class="op">;</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Theta <span class="dv">1</span><span class="op">;</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">//! Reference stress</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter stress s0 <span class="op">=</span> <span class="fl">5e6</span><span class="op">;</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">//! Activation temperature</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">// This temperature is equal to the activation energy (482 kJ/mol/K)</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co">// divided by the ideal gas constant.</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter temperature Ta <span class="op">=</span> <span class="fl">57971.27513059395</span><span class="op">;</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co">//! Reference strain rate</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Parameter strainrate de0 <span class="op">=</span> <span class="fl">29.130</span><span class="op">;</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>ModellingHypotheses<span class="op">{</span><span class="st">&quot;.+&quot;</span><span class="op">};</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="er">@</span>Brick StandardElastoViscoPlasticity<span class="op">{</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  stress_potential <span class="op">:</span> <span class="st">&quot;DDIF2&quot;</span> <span class="op">{</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    young_modulus <span class="op">:</span> <span class="st">&quot;UO2_YoungModulus.mfront&quot;</span><span class="op">,</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    poisson_ratio <span class="op">:</span> <span class="st">&quot;UO2_PoissonRatio.mfront&quot;</span><span class="op">,</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    fracture_stress <span class="op">:</span> <span class="st">&quot;UO2_ElasticLimit.mfront&quot;</span><span class="op">,</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    fracture_energy <span class="op">:</span> <span class="st">&quot;UO2_FractureEnergy.mfront&quot;</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>  <span class="op">},</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>  inelastic_flow <span class="op">:</span> <span class="st">&quot;HyperbolicSine&quot;</span> <span class="op">{</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    criterion <span class="op">:</span> <span class="st">&quot;MichelAndSuquet1992HollowSphereTest&quot;</span> <span class="op">{</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>      n <span class="op">:</span> <span class="dv">6</span><span class="op">},</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    K<span class="op">:</span> <span class="st">&quot;s0&quot;</span><span class="op">,</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    A<span class="op">:</span> <span class="st">&quot;de0 * exp(-Ta/T)&quot;</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h1 class="unnumbered" id="references">References</h1>
<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-michel_constitutive_1992" class="csl-entry"
role="listitem">
<div class="csl-left-margin">1. </div><div
class="csl-right-inline"><span class="smallcaps">Michel</span>, J. C.
and <span class="smallcaps">Suquet</span>, P. The constitutive law of
nonlinear viscous and porous materials. <em>Journal of the Mechanics and
Physics of Solids</em>. 1 May 1992. Vol. 40, no. 4, p. 783–812. DOI <a
href="https://doi.org/10.1016/0022-5096(92)90004-L">10.1016/0022-5096(92)90004-L</a>.
Available from: <a
href="http://www.sciencedirect.com/science/article/pii/002250969290004L">http://www.sciencedirect.com/science/article/pii/002250969290004L</a></div>
</div>
<div id="ref-salvo_experimental_2015-1" class="csl-entry"
role="listitem">
<div class="csl-left-margin">2. </div><div
class="csl-right-inline"><span class="smallcaps">Salvo</span>, Maxime,
<span class="smallcaps">Sercombe</span>, Jérôme, <span
class="smallcaps">Ménard</span>, Jean-Claude, <span
class="smallcaps">Julien</span>, Jérôme, <span
class="smallcaps">Helfer</span>, Thomas and <span
class="smallcaps">Désoyer</span>, Thierry. Experimental characterization
and modelling of <span>UO</span>2 behavior at high temperatures and high
strain rates. <em>Journal of Nuclear Materials</em>. January 2015.
Vol. 456, p. 54–67. DOI <a
href="https://doi.org/10.1016/j.jnucmat.2014.09.024">10.1016/j.jnucmat.2014.09.024</a>.
Available from: <a
href="http://www.sciencedirect.com/science/article/pii/S002231151400614X">http://www.sciencedirect.com/science/article/pii/S002231151400614X</a></div>
</div>
<div id="ref-michel_3d_2008" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div
class="csl-right-inline"><span class="smallcaps">Michel</span>, Bruno,
<span class="smallcaps">Sercombe</span>, Jérôme, <span
class="smallcaps">Thouvenin</span>, Gilles and <span
class="smallcaps">Chatelet</span>, Rémy. 3D fuel cracking modelling in
pellet cladding mechanical interaction. <em>Engineering Fracture
Mechanics</em>. July 2008. Vol. 75, no. 11, p. 3581–3598. DOI <a
href="https://doi.org/10.1016/j.engfracmech.2006.12.014">10.1016/j.engfracmech.2006.12.014</a>.
Available from: <a
href="http://www.sciencedirect.com/science/article/pii/S0013794406004759">http://www.sciencedirect.com/science/article/pii/S0013794406004759</a></div>
</div>
<div id="ref-michel_3d_2016" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div
class="csl-right-inline"><span class="smallcaps">Michel</span>, Bruno,
<span class="smallcaps">Helfer</span>, Thomas, <span
class="smallcaps">Ramière</span>, Isabelle and <span
class="smallcaps">Esnoul</span>, Coralie. 3D continuum damage approach
for simulation of crack initiation and growth in ceramic materials.
<em>Key Engineering Materials</em>. 2016. Vol. 713. DOI <a
href="https://doi.org/10.4028/www.scientific.net/KEM.713.155">10.4028/www.scientific.net/KEM.713.155</a>.
</div>
</div>
<div id="ref-michel_new_2017" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div><div
class="csl-right-inline"><span class="smallcaps">Michel</span>, B.,
<span class="smallcaps">Helfer</span>, T., <span
class="smallcaps">Ramière</span>, I. and <span
class="smallcaps">Esnoul</span>, C. A new numerical methodology for
simulation of unstable crack growth in time independent brittle
materials. <em>Engineering Fracture Mechanics</em>. 12 August 2017.
DOI <a
href="https://doi.org/10.1016/j.engfracmech.2017.08.009">10.1016/j.engfracmech.2017.08.009</a>.
Available from: <a
href="http://www.sciencedirect.com/science/article/pii/S001379441630412X">http://www.sciencedirect.com/science/article/pii/S001379441630412X</a></div>
</div>
</div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-62273823-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
